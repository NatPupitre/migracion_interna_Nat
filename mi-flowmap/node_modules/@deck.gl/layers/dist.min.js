"use strict";var deck=(()=>{var Zv=Object.create;var kr=Object.defineProperty;var Yv=Object.getOwnPropertyDescriptor;var Kv=Object.getOwnPropertyNames;var Jv=Object.getPrototypeOf,qv=Object.prototype.hasOwnProperty;var F=(e,r)=>()=>(r||e((r={exports:{}}).exports,r),r.exports),ba=(e,r)=>{for(var t in r)kr(e,t,{get:r[t],enumerable:!0})},Er=(e,r,t,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Kv(r))!qv.call(e,i)&&i!==t&&kr(e,i,{get:()=>r[i],enumerable:!(n=Yv(r,i))||n.enumerable});return e},ze=(e,r,t)=>(Er(e,r,"default"),t&&Er(t,r,"default")),v=(e,r,t)=>(t=e!=null?Zv(Jv(e)):{},Er(r||!e||!e.__esModule?kr(t,"default",{value:e,enumerable:!0}):t,e)),Xv=e=>Er(kr({},"__esModule",{value:!0}),e);var H=F((my,wa)=>{wa.exports=globalThis.deck});var j=F((xy,Sa)=>{function Qv(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Sa.exports=Qv});var B=F((Py,Ca)=>{function Oa(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ed(e,r,t){return r&&Oa(e.prototype,r),t&&Oa(e,t),e}Ca.exports=ed});var be=F((by,Ma)=>{function td(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}Ma.exports=td});var Y=F((wy,ui)=>{function li(e){return ui.exports=li=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},li(e)}ui.exports=li});var Aa=F((_y,La)=>{var rd=Y();function nd(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=rd(e),e!==null););return e}La.exports=nd});var ne=F((Sy,zr)=>{var id=Aa();function Rr(e,r,t){return typeof Reflect<"u"&&Reflect.get?zr.exports=Rr=Reflect.get:zr.exports=Rr=function(i,o,a){var s=id(i,o);if(s){var l=Object.getOwnPropertyDescriptor(s,o);return l.get?l.get.call(a):l.value}},Rr(e,r,t||e)}zr.exports=Rr});var Ta=F((Oy,ci)=>{function fi(e,r){return ci.exports=fi=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},fi(e,r)}ci.exports=fi});var J=F((Cy,Ia)=>{var od=Ta();function ad(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&od(e,r)}Ia.exports=ad});var se=F((My,Dr)=>{function Fr(e){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Dr.exports=Fr=function(t){return typeof t}:Dr.exports=Fr=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Fr(e)}Dr.exports=Fr});var q=F((Ly,Ea)=>{var sd=se(),ld=be();function ud(e,r){return r&&(sd(r)==="object"||typeof r=="function")?r:ld(e)}Ea.exports=ud});var N=F((Ay,ka)=>{function fd(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}ka.exports=fd});var ie=F((Ty,Ra)=>{Ra.exports=globalThis.luma});var Ha=F((Fy,Va)=>{function dd(e){if(Array.isArray(e))return e}Va.exports=dd});var Za=F((Dy,$a)=>{function gd(e,r){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]"){var t=[],n=!0,i=!1,o=void 0;try{for(var a=e[Symbol.iterator](),s;!(n=(s=a.next()).done)&&(t.push(s.value),!(r&&t.length===r));n=!0);}catch(l){i=!0,o=l}finally{try{!n&&a.return!=null&&a.return()}finally{if(i)throw o}}return t}}$a.exports=gd});var Ka=F((jy,Ya)=>{function hd(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}Ya.exports=hd});var Br=F((Ny,Ja)=>{var md=Ha(),yd=Za(),xd=Ka();function Pd(e,r){return md(e)||yd(e,r)||xd()}Ja.exports=Pd});var Se=F((Gx,Ts)=>{function As(e,r,t,n,i,o,a){try{var s=e[o](a),l=s.value}catch(u){t(u);return}s.done?r(l):Promise.resolve(l).then(n,i)}function jd(e){return function(){var r=this,t=arguments;return new Promise(function(n,i){var o=e.apply(r,t);function a(l){As(o,n,i,a,s,"next",l)}function s(l){As(o,n,i,a,s,"throw",l)}a(void 0)})}}Ts.exports=jd});var Es=F((Vx,Ei)=>{var Is=function(e){"use strict";var r=Object.prototype,t=r.hasOwnProperty,n,i=typeof Symbol=="function"?Symbol:{},o=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function l(S,w,C,A){var M=w&&w.prototype instanceof m?w:m,U=Object.create(M.prototype),G=new E(A||[]);return U._invoke=T(S,C,G),U}e.wrap=l;function u(S,w,C){try{return{type:"normal",arg:S.call(w,C)}}catch(A){return{type:"throw",arg:A}}}var f="suspendedStart",c="suspendedYield",p="executing",d="completed",g={};function m(){}function y(){}function x(){}var _={};_[o]=function(){return this};var h=Object.getPrototypeOf,P=h&&h(h(D([])));P&&P!==r&&t.call(P,o)&&(_=P);var b=x.prototype=m.prototype=Object.create(_);y.prototype=b.constructor=x,x.constructor=y,x[s]=y.displayName="GeneratorFunction";function O(S){["next","throw","return"].forEach(function(w){S[w]=function(C){return this._invoke(w,C)}})}e.isGeneratorFunction=function(S){var w=typeof S=="function"&&S.constructor;return w?w===y||(w.displayName||w.name)==="GeneratorFunction":!1},e.mark=function(S){return Object.setPrototypeOf?Object.setPrototypeOf(S,x):(S.__proto__=x,s in S||(S[s]="GeneratorFunction")),S.prototype=Object.create(b),S},e.awrap=function(S){return{__await:S}};function L(S){function w(M,U,G,X){var te=u(S[M],S,U);if(te.type==="throw")X(te.arg);else{var re=te.arg,Te=re.value;return Te&&typeof Te=="object"&&t.call(Te,"__await")?Promise.resolve(Te.__await).then(function(pe){w("next",pe,G,X)},function(pe){w("throw",pe,G,X)}):Promise.resolve(Te).then(function(pe){re.value=pe,G(re)},function(pe){return w("throw",pe,G,X)})}}var C;function A(M,U){function G(){return new Promise(function(X,te){w(M,U,X,te)})}return C=C?C.then(G,G):G()}this._invoke=A}O(L.prototype),L.prototype[a]=function(){return this},e.AsyncIterator=L,e.async=function(S,w,C,A){var M=new L(l(S,w,C,A));return e.isGeneratorFunction(w)?M:M.next().then(function(U){return U.done?U.value:M.next()})};function T(S,w,C){var A=f;return function(U,G){if(A===p)throw new Error("Generator is already running");if(A===d){if(U==="throw")throw G;return k()}for(C.method=U,C.arg=G;;){var X=C.delegate;if(X){var te=R(X,C);if(te){if(te===g)continue;return te}}if(C.method==="next")C.sent=C._sent=C.arg;else if(C.method==="throw"){if(A===f)throw A=d,C.arg;C.dispatchException(C.arg)}else C.method==="return"&&C.abrupt("return",C.arg);A=p;var re=u(S,w,C);if(re.type==="normal"){if(A=C.done?d:c,re.arg===g)continue;return{value:re.arg,done:C.done}}else re.type==="throw"&&(A=d,C.method="throw",C.arg=re.arg)}}}function R(S,w){var C=S.iterator[w.method];if(C===n){if(w.delegate=null,w.method==="throw"){if(S.iterator.return&&(w.method="return",w.arg=n,R(S,w),w.method==="throw"))return g;w.method="throw",w.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var A=u(C,S.iterator,w.arg);if(A.type==="throw")return w.method="throw",w.arg=A.arg,w.delegate=null,g;var M=A.arg;if(!M)return w.method="throw",w.arg=new TypeError("iterator result is not an object"),w.delegate=null,g;if(M.done)w[S.resultName]=M.value,w.next=S.nextLoc,w.method!=="return"&&(w.method="next",w.arg=n);else return M;return w.delegate=null,g}O(b),b[s]="Generator",b[o]=function(){return this},b.toString=function(){return"[object Generator]"};function W(S){var w={tryLoc:S[0]};1 in S&&(w.catchLoc=S[1]),2 in S&&(w.finallyLoc=S[2],w.afterLoc=S[3]),this.tryEntries.push(w)}function z(S){var w=S.completion||{};w.type="normal",delete w.arg,S.completion=w}function E(S){this.tryEntries=[{tryLoc:"root"}],S.forEach(W,this),this.reset(!0)}e.keys=function(S){var w=[];for(var C in S)w.push(C);return w.reverse(),function A(){for(;w.length;){var M=w.pop();if(M in S)return A.value=M,A.done=!1,A}return A.done=!0,A}};function D(S){if(S){var w=S[o];if(w)return w.call(S);if(typeof S.next=="function")return S;if(!isNaN(S.length)){var C=-1,A=function M(){for(;++C<S.length;)if(t.call(S,C))return M.value=S[C],M.done=!1,M;return M.value=n,M.done=!0,M};return A.next=A}}return{next:k}}e.values=D;function k(){return{value:n,done:!0}}return E.prototype={constructor:E,reset:function(S){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(z),!S)for(var w in this)w.charAt(0)==="t"&&t.call(this,w)&&!isNaN(+w.slice(1))&&(this[w]=n)},stop:function(){this.done=!0;var S=this.tryEntries[0],w=S.completion;if(w.type==="throw")throw w.arg;return this.rval},dispatchException:function(S){if(this.done)throw S;var w=this;function C(te,re){return U.type="throw",U.arg=S,w.next=te,re&&(w.method="next",w.arg=n),!!re}for(var A=this.tryEntries.length-1;A>=0;--A){var M=this.tryEntries[A],U=M.completion;if(M.tryLoc==="root")return C("end");if(M.tryLoc<=this.prev){var G=t.call(M,"catchLoc"),X=t.call(M,"finallyLoc");if(G&&X){if(this.prev<M.catchLoc)return C(M.catchLoc,!0);if(this.prev<M.finallyLoc)return C(M.finallyLoc)}else if(G){if(this.prev<M.catchLoc)return C(M.catchLoc,!0)}else if(X){if(this.prev<M.finallyLoc)return C(M.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(S,w){for(var C=this.tryEntries.length-1;C>=0;--C){var A=this.tryEntries[C];if(A.tryLoc<=this.prev&&t.call(A,"finallyLoc")&&this.prev<A.finallyLoc){var M=A;break}}M&&(S==="break"||S==="continue")&&M.tryLoc<=w&&w<=M.finallyLoc&&(M=null);var U=M?M.completion:{};return U.type=S,U.arg=w,M?(this.method="next",this.next=M.finallyLoc,g):this.complete(U)},complete:function(S,w){if(S.type==="throw")throw S.arg;return S.type==="break"||S.type==="continue"?this.next=S.arg:S.type==="return"?(this.rval=this.arg=S.arg,this.method="return",this.next="end"):S.type==="normal"&&w&&(this.next=w),g},finish:function(S){for(var w=this.tryEntries.length-1;w>=0;--w){var C=this.tryEntries[w];if(C.finallyLoc===S)return this.complete(C.completion,C.afterLoc),z(C),g}},catch:function(S){for(var w=this.tryEntries.length-1;w>=0;--w){var C=this.tryEntries[w];if(C.tryLoc===S){var A=C.completion;if(A.type==="throw"){var M=A.arg;z(C)}return M}}throw new Error("illegal catch attempt")},delegateYield:function(S,w,C){return this.delegate={iterator:D(S),resultName:w,nextLoc:C},this.method==="next"&&(this.arg=n),g}},e}(typeof Ei=="object"?Ei.exports:{});try{regeneratorRuntime=Is}catch{Function("r","regeneratorRuntime = r")(Is)}});var oe=F((Hx,ks)=>{ks.exports=Es()});var Ni=F((L1,ul)=>{function Kd(e){var r;if(typeof Symbol<"u"&&(Symbol.asyncIterator&&(r=e[Symbol.asyncIterator],r!=null)||Symbol.iterator&&(r=e[Symbol.iterator],r!=null)))return r.call(e);throw new TypeError("Object is not async iterable")}ul.exports=Kd});var Yi=F((G1,cl)=>{function Qd(e){this.wrapped=e}cl.exports=Qd});var Ki=F((V1,pl)=>{var eg=Yi();function tg(e){return new eg(e)}pl.exports=tg});var dl=F((H1,vl)=>{var rg=Yi();function Kt(e){var r,t;function n(a,s){return new Promise(function(l,u){var f={key:a,arg:s,resolve:l,reject:u,next:null};t?t=t.next=f:(r=t=f,i(a,s))})}function i(a,s){try{var l=e[a](s),u=l.value,f=u instanceof rg;Promise.resolve(f?u.wrapped:u).then(function(c){if(f){i(a==="return"?"return":"next",c);return}o(l.done?"return":"normal",c)},function(c){i("throw",c)})}catch(c){o("throw",c)}}function o(a,s){switch(a){case"return":r.resolve({value:s,done:!0});break;case"throw":r.reject(s);break;default:r.resolve({value:s,done:!1});break}r=r.next,r?i(r.key,r.arg):t=null}this._invoke=n,typeof e.return!="function"&&(this.return=void 0)}typeof Symbol=="function"&&Symbol.asyncIterator&&(Kt.prototype[Symbol.asyncIterator]=function(){return this});Kt.prototype.next=function(e){return this._invoke("next",e)};Kt.prototype.throw=function(e){return this._invoke("throw",e)};Kt.prototype.return=function(e){return this._invoke("return",e)};vl.exports=Kt});var Ji=F(($1,gl)=>{var ng=dl();function ig(e){return function(){return new ng(e.apply(this,arguments))}}gl.exports=ig});var xl=F(()=>{});var Al=F((OP,Ll)=>{function yg(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}Ll.exports=yg});var Il=F((CP,Tl)=>{function xg(e){if(Symbol.iterator in Object(e)||Object.prototype.toString.call(e)==="[object Arguments]")return Array.from(e)}Tl.exports=xg});var kl=F((MP,El)=>{function Pg(){throw new TypeError("Invalid attempt to spread non-iterable instance")}El.exports=Pg});var sn=F((LP,Rl)=>{var bg=Al(),wg=Il(),_g=kl();function Sg(e){return bg(e)||wg(e)||_g()}Rl.exports=Sg});var Uc=F((E_,sa)=>{"use strict";sa.exports=Nn;sa.exports.default=Nn;function Nn(e,r,t){t=t||2;var n=r&&r.length,i=n?r[0]*t:e.length,o=Nc(e,0,i,t,!0),a=[];if(!o||o.next===o.prev)return a;var s,l,u,f,c,p,d;if(n&&(o=im(e,r,o,t)),e.length>80*t){s=u=e[0],l=f=e[1];for(var g=t;g<i;g+=t)c=e[g],p=e[g+1],c<s&&(s=c),p<l&&(l=p),c>u&&(u=c),p>f&&(f=p);d=Math.max(u-s,f-l),d=d!==0?32767/d:0}return mr(o,a,t,s,l,d,0),a}function Nc(e,r,t,n,i){var o,a;if(i===aa(e,r,t,n)>0)for(o=r;o<t;o+=n)a=jc(o,e[o],e[o+1],a);else for(o=t-n;o>=r;o-=n)a=jc(o,e[o],e[o+1],a);return a&&Wn(a,a.next)&&(xr(a),a=a.next),a}function rt(e,r){if(!e)return e;r||(r=e);var t=e,n;do if(n=!1,!t.steiner&&(Wn(t,t.next)||Z(t.prev,t,t.next)===0)){if(xr(t),t=r=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==r);return r}function mr(e,r,t,n,i,o,a){if(e){!a&&o&&um(e,n,i,o);for(var s=e,l,u;e.prev!==e.next;){if(l=e.prev,u=e.next,o?tm(e,n,i,o):em(e)){r.push(l.i/t|0),r.push(e.i/t|0),r.push(u.i/t|0),xr(e),e=u.next,s=u.next;continue}if(e=u,e===s){a?a===1?(e=rm(rt(e),r,t),mr(e,r,t,n,i,o,2)):a===2&&nm(e,r,t,n,i,o):mr(rt(e),r,t,n,i,o,1);break}}}}function em(e){var r=e.prev,t=e,n=e.next;if(Z(r,t,n)>=0)return!1;for(var i=r.x,o=t.x,a=n.x,s=r.y,l=t.y,u=n.y,f=i<o?i<a?i:a:o<a?o:a,c=s<l?s<u?s:u:l<u?l:u,p=i>o?i>a?i:a:o>a?o:a,d=s>l?s>u?s:u:l>u?l:u,g=n.next;g!==r;){if(g.x>=f&&g.x<=p&&g.y>=c&&g.y<=d&&_t(i,s,o,l,a,u,g.x,g.y)&&Z(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function tm(e,r,t,n){var i=e.prev,o=e,a=e.next;if(Z(i,o,a)>=0)return!1;for(var s=i.x,l=o.x,u=a.x,f=i.y,c=o.y,p=a.y,d=s<l?s<u?s:u:l<u?l:u,g=f<c?f<p?f:p:c<p?c:p,m=s>l?s>u?s:u:l>u?l:u,y=f>c?f>p?f:p:c>p?c:p,x=ia(d,g,r,t,n),_=ia(m,y,r,t,n),h=e.prevZ,P=e.nextZ;h&&h.z>=x&&P&&P.z<=_;){if(h.x>=d&&h.x<=m&&h.y>=g&&h.y<=y&&h!==i&&h!==a&&_t(s,f,l,c,u,p,h.x,h.y)&&Z(h.prev,h,h.next)>=0||(h=h.prevZ,P.x>=d&&P.x<=m&&P.y>=g&&P.y<=y&&P!==i&&P!==a&&_t(s,f,l,c,u,p,P.x,P.y)&&Z(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;h&&h.z>=x;){if(h.x>=d&&h.x<=m&&h.y>=g&&h.y<=y&&h!==i&&h!==a&&_t(s,f,l,c,u,p,h.x,h.y)&&Z(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;P&&P.z<=_;){if(P.x>=d&&P.x<=m&&P.y>=g&&P.y<=y&&P!==i&&P!==a&&_t(s,f,l,c,u,p,P.x,P.y)&&Z(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function rm(e,r,t){var n=e;do{var i=n.prev,o=n.next.next;!Wn(i,o)&&Wc(i,n,n.next,o)&&yr(i,o)&&yr(o,i)&&(r.push(i.i/t|0),r.push(n.i/t|0),r.push(o.i/t|0),xr(n),xr(n.next),n=e=o),n=n.next}while(n!==e);return rt(n)}function nm(e,r,t,n,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&pm(a,s)){var l=Bc(a,s);a=rt(a,a.next),l=rt(l,l.next),mr(a,r,t,n,i,o,0),mr(l,r,t,n,i,o,0);return}s=s.next}a=a.next}while(a!==e)}function im(e,r,t,n){var i=[],o,a,s,l,u;for(o=0,a=r.length;o<a;o++)s=r[o]*n,l=o<a-1?r[o+1]*n:e.length,u=Nc(e,s,l,n,!1),u===u.next&&(u.steiner=!0),i.push(cm(u));for(i.sort(om),o=0;o<i.length;o++)t=am(i[o],t);return t}function om(e,r){return e.x-r.x}function am(e,r){var t=sm(e,r);if(!t)return r;var n=Bc(t,e);return rt(n,n.next),rt(t,t.next)}function sm(e,r){var t=r,n=e.x,i=e.y,o=-1/0,a;do{if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){var s=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(s<=n&&s>o&&(o=s,a=t.x<t.next.x?t:t.next,s===n))return a}t=t.next}while(t!==r);if(!a)return null;var l=a,u=a.x,f=a.y,c=1/0,p;t=a;do n>=t.x&&t.x>=u&&n!==t.x&&_t(i<f?n:o,i,u,f,i<f?o:n,i,t.x,t.y)&&(p=Math.abs(i-t.y)/(n-t.x),yr(t,e)&&(p<c||p===c&&(t.x>a.x||t.x===a.x&&lm(a,t)))&&(a=t,c=p)),t=t.next;while(t!==l);return a}function lm(e,r){return Z(e.prev,e,r.prev)<0&&Z(r.next,e,e.next)<0}function um(e,r,t,n){var i=e;do i.z===0&&(i.z=ia(i.x,i.y,r,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,fm(i)}function fm(e){var r,t,n,i,o,a,s,l,u=1;do{for(t=e,e=null,o=null,a=0;t;){for(a++,n=t,s=0,r=0;r<u&&(s++,n=n.nextZ,!!n);r++);for(l=u;s>0||l>0&&n;)s!==0&&(l===0||!n||t.z<=n.z)?(i=t,t=t.nextZ,s--):(i=n,n=n.nextZ,l--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;t=n}o.nextZ=null,u*=2}while(a>1);return e}function ia(e,r,t,n,i){return e=(e-t)*i|0,r=(r-n)*i|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e|r<<1}function cm(e){var r=e,t=e;do(r.x<t.x||r.x===t.x&&r.y<t.y)&&(t=r),r=r.next;while(r!==e);return t}function _t(e,r,t,n,i,o,a,s){return(i-a)*(r-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(t-a)*(r-s)&&(t-a)*(o-s)>=(i-a)*(n-s)}function pm(e,r){return e.next.i!==r.i&&e.prev.i!==r.i&&!vm(e,r)&&(yr(e,r)&&yr(r,e)&&dm(e,r)&&(Z(e.prev,e,r.prev)||Z(e,r.prev,r))||Wn(e,r)&&Z(e.prev,e,e.next)>0&&Z(r.prev,r,r.next)>0)}function Z(e,r,t){return(r.y-e.y)*(t.x-r.x)-(r.x-e.x)*(t.y-r.y)}function Wn(e,r){return e.x===r.x&&e.y===r.y}function Wc(e,r,t,n){var i=jn(Z(e,r,t)),o=jn(Z(e,r,n)),a=jn(Z(t,n,e)),s=jn(Z(t,n,r));return!!(i!==o&&a!==s||i===0&&Dn(e,t,r)||o===0&&Dn(e,n,r)||a===0&&Dn(t,e,n)||s===0&&Dn(t,r,n))}function Dn(e,r,t){return r.x<=Math.max(e.x,t.x)&&r.x>=Math.min(e.x,t.x)&&r.y<=Math.max(e.y,t.y)&&r.y>=Math.min(e.y,t.y)}function jn(e){return e>0?1:e<0?-1:0}function vm(e,r){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==r.i&&t.next.i!==r.i&&Wc(t,t.next,e,r))return!0;t=t.next}while(t!==e);return!1}function yr(e,r){return Z(e.prev,e,e.next)<0?Z(e,r,e.next)>=0&&Z(e,e.prev,r)>=0:Z(e,r,e.prev)<0||Z(e,e.next,r)<0}function dm(e,r){var t=e,n=!1,i=(e.x+r.x)/2,o=(e.y+r.y)/2;do t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==e);return n}function Bc(e,r){var t=new oa(e.i,e.x,e.y),n=new oa(r.i,r.x,r.y),i=e.next,o=r.prev;return e.next=r,r.prev=e,t.next=i,i.prev=t,n.next=t,t.prev=n,o.next=n,n.prev=o,n}function jc(e,r,t,n){var i=new oa(e,r,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function xr(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function oa(e,r,t){this.i=e,this.x=r,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}Nn.deviation=function(e,r,t,n){var i=r&&r.length,o=i?r[0]*t:e.length,a=Math.abs(aa(e,0,o,t));if(i)for(var s=0,l=r.length;s<l;s++){var u=r[s]*t,f=s<l-1?r[s+1]*t:e.length;a-=Math.abs(aa(e,u,f,t))}var c=0;for(s=0;s<n.length;s+=3){var p=n[s]*t,d=n[s+1]*t,g=n[s+2]*t;c+=Math.abs((e[p]-e[g])*(e[d+1]-e[p+1])-(e[p]-e[d])*(e[g+1]-e[p+1]))}return a===0&&c===0?0:Math.abs((c-a)/a)};function aa(e,r,t,n){for(var i=0,o=r,a=t-n;o<t;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}Nn.flatten=function(e){for(var r=e[0][0].length,t={vertices:[],holes:[],dimensions:r},n=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<r;a++)t.vertices.push(e[i][o][a]);i>0&&(n+=e[i-1].length,t.holes.push(n))}return t}});var Cp=F((X_,Op)=>{function Rm(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,o;for(o=0;o<n.length;o++)i=n[o],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}Op.exports=Rm});var Lp=F((Q_,Mp)=>{var zm=Cp();function Fm(e,r){if(e==null)return{};var t=zm(e,r),n,i;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}Mp.exports=Fm});var Ir={};ba(Ir,{ArcLayer:()=>Wr,BitmapLayer:()=>Qr,ColumnLayer:()=>bt,GeoJsonLayer:()=>oi,GridCellLayer:()=>kn,IconLayer:()=>We,LineLayer:()=>wn,PathLayer:()=>$e,PointCloudLayer:()=>On,PolygonLayer:()=>Yn,ScatterplotLayer:()=>xt,SolidPolygonLayer:()=>Ye,TextLayer:()=>It,_MultiIconLayer:()=>Lt,_TextBackgroundLayer:()=>At});var Pe={},_a=v(H());ze(Pe,v(H()));if(!_a.Layer)throw new Error("@deck.gl/core is not found");ze(Ir,Pe);var Na=v(j()),Wa=v(B()),Ba=v(be()),pi=v(ne()),Ua=v(J()),Ga=v(q()),Rt=v(Y()),zt=v(N()),Fe=v(H()),Nr=v(ie());var za=`#define SHADER_NAME arc-layer-vertex-shader

attribute vec3 positions;
attribute vec4 instanceSourceColors;
attribute vec4 instanceTargetColors;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceTargetPositions64Low;
attribute vec3 instancePickingColors;
attribute float instanceWidths;
attribute float instanceHeights;
attribute float instanceTilts;

uniform bool greatCircle;
uniform bool useShortestPath;
uniform float numSegments;
uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

float paraboloid(float distance, float sourceZ, float targetZ, float ratio) {

  float deltaZ = targetZ - sourceZ;
  float dh = distance * instanceHeights;
  if (dh == 0.0) {
    return sourceZ + deltaZ * ratio;
  }
  float unitZ = deltaZ / dh;
  float p2 = unitZ * unitZ + 1.0;
  float dir = step(deltaZ, 0.0);
  float z0 = mix(sourceZ, targetZ, dir);
  float r = mix(ratio, 1.0 - ratio, dir);
  return sqrt(r * (p2 - r)) * dh + z0;
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));
}

vec3 interpolateFlat(vec3 source, vec3 target, float segmentRatio) {
  float distance = length(source.xy - target.xy);
  float z = paraboloid(distance, source.z, target.z, segmentRatio);

  float tiltAngle = radians(instanceTilts);
  vec2 tiltDirection = normalize(target.xy - source.xy);
  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * z * sin(tiltAngle);

  return vec3(
    mix(source.xy, target.xy, segmentRatio) + tilt,
    z * cos(tiltAngle)
  );
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 sourceRadians = radians(source);
  vec2 targetRadians = radians(target);
  vec2 sin_half_delta = sin((sourceRadians - targetRadians) / 2.0);
  vec2 shd_sq = sin_half_delta * sin_half_delta;

  float a = shd_sq.y + cos(sourceRadians.y) * cos(targetRadians.y) * shd_sq.x;
  return 2.0 * asin(sqrt(a));
}

vec3 interpolateGreatCircle(vec3 source, vec3 target, vec3 source3D, vec3 target3D, float angularDist, float t) {
  vec2 lngLat;
  if(abs(angularDist - PI) < 0.001) {
    lngLat = (1.0 - t) * source.xy + t * target.xy;
  } else {
    float a = sin((1.0 - t) * angularDist);
    float b = sin(t * angularDist);
    vec3 p = source3D.yxz * a + target3D.yxz * b;
    lngLat = degrees(vec2(atan(p.y, -p.x), atan(p.z, length(p.xy))));
  }

  float z = paraboloid(angularDist * EARTH_RADIUS, source.z, target.z, t);

  return vec3(lngLat, z);
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  float segmentIndex = positions.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float prevSegmentRatio = getSegmentRatio(max(0.0, segmentIndex - 1.0));
  float nextSegmentRatio = getSegmentRatio(min(numSegments - 1.0, segmentIndex + 1.0));
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  isValid = 1.0;

  uv = vec2(segmentRatio, positions.y);
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;

  vec4 curr;
  vec4 next;
  vec3 source;
  vec3 target;

  if ((greatCircle || project_uProjectionMode == PROJECTION_MODE_GLOBE) && project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    source = project_globe_(vec3(instanceSourcePositions.xy, 0.0));
    target = project_globe_(vec3(instanceTargetPositions.xy, 0.0));
    float angularDist = getAngularDist(instanceSourcePositions.xy, instanceTargetPositions.xy);

    vec3 prevPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, prevSegmentRatio);
    vec3 currPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, segmentRatio);
    vec3 nextPos = interpolateGreatCircle(instanceSourcePositions, instanceTargetPositions, source, target, angularDist, nextSegmentRatio);

    if (abs(currPos.x - prevPos.x) > 180.0) {
      indexDir = -1.0;
      isValid = 0.0;
    } else if (abs(currPos.x - nextPos.x) > 180.0) {
      indexDir = 1.0;
      isValid = 0.0;
    }
    nextPos = indexDir < 0.0 ? prevPos : nextPos;
    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;

    if (isValid == 0.0) {
      nextPos.x += nextPos.x > 0.0 ? -360.0 : 360.0;
      float t = ((currPos.x > 0.0 ? 180.0 : -180.0) - currPos.x) / (nextPos.x - currPos.x);
      currPos = mix(currPos, nextPos, t);
      segmentRatio = mix(segmentRatio, nextSegmentRatio, t);
    }

    vec3 currPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, segmentRatio);
    vec3 nextPos64Low = mix(instanceSourcePositions64Low, instanceTargetPositions64Low, nextSegmentRatio);
  
    curr = project_position_to_clipspace(currPos, currPos64Low, vec3(0.0), geometry.position);
    next = project_position_to_clipspace(nextPos, nextPos64Low, vec3(0.0));
  
  } else {
    vec3 source_world = instanceSourcePositions;
    vec3 target_world = instanceTargetPositions;
    if (useShortestPath) {
      source_world.x = mod(source_world.x + 180., 360.0) - 180.;
      target_world.x = mod(target_world.x + 180., 360.0) - 180.;

      float deltaLng = target_world.x - source_world.x;
      if (deltaLng > 180.) target_world.x -= 360.;
      if (deltaLng < -180.) source_world.x -= 360.;
    }
    source = project_position(source_world, instanceSourcePositions64Low);
    target = project_position(target_world, instanceTargetPositions64Low);
    float antiMeridianX = 0.0;

    if (useShortestPath) {
      if (project_uProjectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
        antiMeridianX = -(project_uCoordinateOrigin.x + 180.) / 360. * TILE_SIZE;
      }
      float thresholdRatio = (antiMeridianX - source.x) / (target.x - source.x);

      if (prevSegmentRatio <= thresholdRatio && nextSegmentRatio > thresholdRatio) {
        isValid = 0.0;
        indexDir = sign(segmentRatio - thresholdRatio);
        segmentRatio = thresholdRatio;
      }
    }

    nextSegmentRatio = indexDir < 0.0 ? prevSegmentRatio : nextSegmentRatio;
    vec3 currPos = interpolateFlat(source, target, segmentRatio);
    vec3 nextPos = interpolateFlat(source, target, nextSegmentRatio);

    if (useShortestPath) {
      if (nextPos.x < antiMeridianX) {
        currPos.x += TILE_SIZE;
        nextPos.x += TILE_SIZE;
      }
    }

    curr = project_common_position_to_clipspace(vec4(currPos, 1.0));
    next = project_common_position_to_clipspace(vec4(nextPos, 1.0));
    geometry.position = vec4(currPos, 1.0);
  }
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(curr, geometry);
  gl_Position = curr + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);

  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio);
  vColor = vec4(color.rgb, color.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Fa=`#define SHADER_NAME arc-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;
varying float isValid;

void main(void) {
  if (isValid == 0.0) {
    discard;
  }

  gl_FragColor = vColor;
  geometry.uv = uv;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Da(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ja(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Da(Object(t),!0).forEach(function(n){(0,zt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Da(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function cd(e){var r=pd();return function(){var n=(0,Rt.default)(e),i;if(r){var o=(0,Rt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Ga.default)(this,i)}}function pd(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var jr=[0,0,0,255],vd={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getSourceColor:{type:"accessor",value:jr},getTargetColor:{type:"accessor",value:jr},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},greatCircle:!1,widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},Wr=function(e){(0,Ua.default)(t,e);var r=cd(t);function t(){var n;(0,Na.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,zt.default)((0,Ba.default)(n),"state",void 0),n}return(0,Wa.default)(t,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,pi.default)((0,Rt.default)(t.prototype),"getShaders",this).call(this,{vs:za,fs:Fa,modules:[Fe.project32,Fe.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceSourceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getSourceColor",defaultValue:jr},instanceTargetColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getTargetColor",defaultValue:jr},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(i){if((0,pi.default)((0,Rt.default)(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.widthUnits,l=a.widthScale,u=a.widthMinPixels,f=a.widthMaxPixels,c=a.greatCircle,p=a.wrapLongitude;this.state.model.setUniforms(o).setUniforms({greatCircle:c,widthUnits:Fe.UNIT[s],widthScale:l,widthMinPixels:u,widthMaxPixels:f,useShortestPath:p}).draw()}},{key:"_getModel",value:function(i){for(var o=[],a=50,s=0;s<a;s++)o=o.concat([s,1,0,s,-1,0]);var l=new Nr.Model(i,ja(ja({},this.getShaders()),{},{id:this.props.id,geometry:new Nr.Geometry({drawMode:5,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}));return l.setUniforms({numSegments:a}),l}}]),t}(Fe.Layer);(0,zt.default)(Wr,"layerName","ArcLayer");(0,zt.default)(Wr,"defaultProps",vd);var bs=v(Br()),ws=v(j()),_s=v(B()),Ss=v(be()),Ii=v(ne()),Os=v(J()),Cs=v(q()),Ut=v(Y()),Gt=v(N()),he=v(H()),Xr=v(ie());function at(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function vi(e){if(Array.isArray(e))return at(e)}function di(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Ft(e,r){if(e){if(typeof e=="string")return at(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return at(e,r)}}function gi(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function st(e){return vi(e)||di(e)||Ft(e)||gi()}function hi(e){if(Array.isArray(e))return e}function mi(e,r){var t=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n=[],i=!0,o=!1,a,s;try{for(t=t.call(e);!(i=(a=t.next()).done)&&(n.push(a.value),!(r&&n.length===r));i=!0);}catch(l){o=!0,s=l}finally{try{!i&&t.return!=null&&t.return()}finally{if(o)throw s}}return n}}function yi(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Q(e,r){return hi(e)||mi(e,r)||Ft(e,r)||yi()}function xi(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function qa(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Pi(e,r,t){return r&&qa(e.prototype,r),t&&qa(e,t),e}function V(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var K=1e-6,we=typeof Float32Array<"u"?Float32Array:Array;var u0=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});function bd(){var e=new we(4);return we!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Qa(e,r,t){return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e}function es(e,r,t){var n=r[0],i=r[1],o=r[2],a=r[3];return e[0]=t[0]*n+t[4]*i+t[8]*o+t[12]*a,e[1]=t[1]*n+t[5]*i+t[9]*o+t[13]*a,e[2]=t[2]*n+t[6]*i+t[10]*o+t[14]*a,e[3]=t[3]*n+t[7]*i+t[11]*o+t[15]*a,e}var f0=function(){var e=bd();return function(r,t,n,i,o,a){var s,l;for(t||(t=4),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],e[3]=r[s+3],o(e,e,a),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2],r[s+3]=e[3];return r}}();function lt(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function De(e,r){var t=es([],r,e);return Qa(t,t,1/t[3]),t}function Dt(e,r,t){return e<r?r:e>t?t:e}function wd(e){return Math.log(e)*Math.LOG2E}var Gr=Math.log2||wd;function ts(e,r){var t=r[0],n=r[1],i=r[2],o=r[3],a=r[4],s=r[5],l=r[6],u=r[7],f=r[8],c=r[9],p=r[10],d=r[11],g=r[12],m=r[13],y=r[14],x=r[15],_=t*s-n*a,h=t*l-i*a,P=t*u-o*a,b=n*l-i*s,O=n*u-o*s,L=i*u-o*l,T=f*m-c*g,R=f*y-p*g,W=f*x-d*g,z=c*y-p*m,E=c*x-d*m,D=p*x-d*y,k=_*D-h*E+P*z+b*W-O*R+L*T;return k?(k=1/k,e[0]=(s*D-l*E+u*z)*k,e[1]=(i*E-n*D-o*z)*k,e[2]=(m*L-y*O+x*b)*k,e[3]=(p*O-c*L-d*b)*k,e[4]=(l*W-a*D-u*R)*k,e[5]=(t*D-i*W+o*R)*k,e[6]=(y*P-g*L-x*h)*k,e[7]=(f*L-p*P+d*h)*k,e[8]=(a*E-s*W+u*T)*k,e[9]=(n*W-t*E-o*T)*k,e[10]=(g*O-m*P+x*_)*k,e[11]=(c*P-f*O-d*_)*k,e[12]=(s*R-a*z-l*T)*k,e[13]=(t*z-n*R+i*T)*k,e[14]=(m*h-g*b-y*_)*k,e[15]=(f*b-c*h+p*_)*k,e):null}function Vr(e,r,t){var n=r[0],i=r[1],o=r[2],a=r[3],s=r[4],l=r[5],u=r[6],f=r[7],c=r[8],p=r[9],d=r[10],g=r[11],m=r[12],y=r[13],x=r[14],_=r[15],h=t[0],P=t[1],b=t[2],O=t[3];return e[0]=h*n+P*s+b*c+O*m,e[1]=h*i+P*l+b*p+O*y,e[2]=h*o+P*u+b*d+O*x,e[3]=h*a+P*f+b*g+O*_,h=t[4],P=t[5],b=t[6],O=t[7],e[4]=h*n+P*s+b*c+O*m,e[5]=h*i+P*l+b*p+O*y,e[6]=h*o+P*u+b*d+O*x,e[7]=h*a+P*f+b*g+O*_,h=t[8],P=t[9],b=t[10],O=t[11],e[8]=h*n+P*s+b*c+O*m,e[9]=h*i+P*l+b*p+O*y,e[10]=h*o+P*u+b*d+O*x,e[11]=h*a+P*f+b*g+O*_,h=t[12],P=t[13],b=t[14],O=t[15],e[12]=h*n+P*s+b*c+O*m,e[13]=h*i+P*l+b*p+O*y,e[14]=h*o+P*u+b*d+O*x,e[15]=h*a+P*f+b*g+O*_,e}function jt(e,r,t){var n=t[0],i=t[1],o=t[2],a,s,l,u,f,c,p,d,g,m,y,x;return r===e?(e[12]=r[0]*n+r[4]*i+r[8]*o+r[12],e[13]=r[1]*n+r[5]*i+r[9]*o+r[13],e[14]=r[2]*n+r[6]*i+r[10]*o+r[14],e[15]=r[3]*n+r[7]*i+r[11]*o+r[15]):(a=r[0],s=r[1],l=r[2],u=r[3],f=r[4],c=r[5],p=r[6],d=r[7],g=r[8],m=r[9],y=r[10],x=r[11],e[0]=a,e[1]=s,e[2]=l,e[3]=u,e[4]=f,e[5]=c,e[6]=p,e[7]=d,e[8]=g,e[9]=m,e[10]=y,e[11]=x,e[12]=a*n+f*i+g*o+r[12],e[13]=s*n+c*i+m*o+r[13],e[14]=l*n+p*i+y*o+r[14],e[15]=u*n+d*i+x*o+r[15]),e}function Hr(e,r,t){var n=t[0],i=t[1],o=t[2];return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*i,e[5]=r[5]*i,e[6]=r[6]*i,e[7]=r[7]*i,e[8]=r[8]*o,e[9]=r[9]*o,e[10]=r[10]*o,e[11]=r[11]*o,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function rs(e,r,t){var n=Math.sin(t),i=Math.cos(t),o=r[4],a=r[5],s=r[6],l=r[7],u=r[8],f=r[9],c=r[10],p=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=o*i+u*n,e[5]=a*i+f*n,e[6]=s*i+c*n,e[7]=l*i+p*n,e[8]=u*i-o*n,e[9]=f*i-a*n,e[10]=c*i-s*n,e[11]=p*i-l*n,e}function ns(e,r,t){var n=Math.sin(t),i=Math.cos(t),o=r[0],a=r[1],s=r[2],l=r[3],u=r[4],f=r[5],c=r[6],p=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=o*i+u*n,e[1]=a*i+f*n,e[2]=s*i+c*n,e[3]=l*i+p*n,e[4]=u*i-o*n,e[5]=f*i-a*n,e[6]=c*i-s*n,e[7]=p*i-l*n,e}function _d(e,r,t,n,i){var o=1/Math.tan(r/2),a;return e[0]=o/t,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,i!=null&&i!==1/0?(a=1/(n-i),e[10]=(i+n)*a,e[14]=2*i*n*a):(e[10]=-1,e[14]=-2*n),e}var is=_d;function bi(e,r){var t=e[0],n=e[1],i=e[2],o=e[3],a=e[4],s=e[5],l=e[6],u=e[7],f=e[8],c=e[9],p=e[10],d=e[11],g=e[12],m=e[13],y=e[14],x=e[15],_=r[0],h=r[1],P=r[2],b=r[3],O=r[4],L=r[5],T=r[6],R=r[7],W=r[8],z=r[9],E=r[10],D=r[11],k=r[12],S=r[13],w=r[14],C=r[15];return Math.abs(t-_)<=K*Math.max(1,Math.abs(t),Math.abs(_))&&Math.abs(n-h)<=K*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-P)<=K*Math.max(1,Math.abs(i),Math.abs(P))&&Math.abs(o-b)<=K*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-O)<=K*Math.max(1,Math.abs(a),Math.abs(O))&&Math.abs(s-L)<=K*Math.max(1,Math.abs(s),Math.abs(L))&&Math.abs(l-T)<=K*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(u-R)<=K*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(f-W)<=K*Math.max(1,Math.abs(f),Math.abs(W))&&Math.abs(c-z)<=K*Math.max(1,Math.abs(c),Math.abs(z))&&Math.abs(p-E)<=K*Math.max(1,Math.abs(p),Math.abs(E))&&Math.abs(d-D)<=K*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(g-k)<=K*Math.max(1,Math.abs(g),Math.abs(k))&&Math.abs(m-S)<=K*Math.max(1,Math.abs(m),Math.abs(S))&&Math.abs(y-w)<=K*Math.max(1,Math.abs(y),Math.abs(w))&&Math.abs(x-C)<=K*Math.max(1,Math.abs(x),Math.abs(C))}function Sd(){var e=new we(2);return we!=Float32Array&&(e[0]=0,e[1]=0),e}function wi(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e}function as(e,r){return e[0]=-r[0],e[1]=-r[1],e}function $r(e,r,t,n){var i=r[0],o=r[1];return e[0]=i+n*(t[0]-i),e[1]=o+n*(t[1]-o),e}var d0=function(){var e=Sd();return function(r,t,n,i,o,a){var s,l;for(t||(t=2),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],o(e,e,a),r[s]=e[0],r[s+1]=e[1];return r}}();function Od(){var e=new we(3);return we!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function ss(e,r,t){return e[0]=r[0]+t[0],e[1]=r[1]+t[1],e[2]=r[2]+t[2],e}function Cd(e,r,t){return e[0]=r[0]*t[0],e[1]=r[1]*t[1],e[2]=r[2]*t[2],e}function ls(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}var us=Cd;var g0=function(){var e=Od();return function(r,t,n,i,o,a){var s,l;for(t||(t=3),n||(n=0),i?l=Math.min(i*t+n,r.length):l=r.length,s=n;s<l;s+=t)e[0]=r[s],e[1]=r[s+1],e[2]=r[s+2],o(e,e,a),r[s]=e[0],r[s+1]=e[1],r[s+2]=e[2];return r}}();function ve(e,r){if(!e)throw new Error(r||"@math.gl/web-mercator: assertion failed.")}var de=Math.PI,ps=de/4,_e=de/180,Si=180/de,Nt=512,cs=4003e4,ft=85.051129,Oi=1.5;function Zr(e){return Math.pow(2,e)}function le(e){var r=Q(e,2),t=r[0],n=r[1];ve(Number.isFinite(t)),ve(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var i=t*_e,o=n*_e,a=Nt*(i+de)/(2*de),s=Nt*(de+Math.log(Math.tan(ps+o*.5)))/(2*de);return[a,s]}function ge(e){var r=Q(e,2),t=r[0],n=r[1],i=t/Nt*(2*de)-de,o=2*(Math.atan(Math.exp(n/Nt*(2*de)-de))-ps);return[i*Si,o*Si]}function Ci(e){var r=e.latitude,t=e.longitude,n=e.highPrecision,i=n===void 0?!1:n;ve(Number.isFinite(r)&&Number.isFinite(t));var o=Nt,a=Math.cos(r*_e),s=o/360,l=s/a,u=o/cs/a,f={unitsPerMeter:[u,u,u],metersPerUnit:[1/u,1/u,1/u],unitsPerDegree:[s,l,u],degreesPerUnit:[1/s,1/l,1/u]};if(i){var c=_e*Math.tan(r*_e)/a,p=s*c/2,d=o/cs*c,g=d/l*u;f.unitsPerDegree2=[0,p,d],f.unitsPerMeter2=[g,0,g]}return f}function Mi(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,o=e.scale,a=e.center,s=lt();jt(s,s,[0,0,-i]),rs(s,s,-t*_e),ns(s,s,n*_e);var l=o/r;return Hr(s,s,[l,l,l]),a&&jt(s,s,ls([],a)),s}function vs(e){var r=e.width,t=e.height,n=e.altitude,i=e.pitch,o=i===void 0?0:i,a=e.offset,s=e.center,l=e.scale,u=e.nearZMultiplier,f=u===void 0?1:u,c=e.farZMultiplier,p=c===void 0?1:c,d=e.fovy,g=d===void 0?ut(Oi):d;n!==void 0&&(g=ut(n));var m=g*_e,y=o*_e,x=Yr(g),_=x;s&&(_+=s[2]*l/Math.cos(y)/t);var h=m*(.5+(a?a[1]:0)/t),P=Math.sin(h)*_/Math.sin(Dt(Math.PI/2-y-h,.01,Math.PI-.01)),b=Math.sin(y)*P+_,O=_*10,L=Math.min(b*p,O);return{fov:m,aspect:r/t,focalDistance:x,near:f,far:L}}function Li(e){var r=vs(e),t=r.fov,n=r.aspect,i=r.near,o=r.far,a=is([],t,n,i,o);return a}function ut(e){return 2*Math.atan(.5/e)*Si}function Yr(e){return .5/Math.tan(.5*e*_e)}function Ai(e,r){var t=Q(e,3),n=t[0],i=t[1],o=t[2],a=o===void 0?0:o;return ve(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(a)),De(r,[n,i,a,1])}function Kr(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=Q(e,3),i=n[0],o=n[1],a=n[2];if(ve(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=De(r,[i,o,a,1]);return s}var l=De(r,[i,o,0,1]),u=De(r,[i,o,1,1]),f=l[2],c=u[2],p=f===c?0:((t||0)-f)/(c-f);return $r([],l,u,p)}function Jr(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,o=i===void 0?0:i,a=e.maxZoom,s=a===void 0?24:a,l=e.offset,u=l===void 0?[0,0]:l,f=Q(n,2),c=Q(f[0],2),p=c[0],d=c[1],g=Q(f[1],2),m=g[0],y=g[1],x=Md(e.padding),_=le([p,Dt(y,-ft,ft)]),h=le([m,Dt(d,-ft,ft)]),P=[Math.max(Math.abs(h[0]-_[0]),o),Math.max(Math.abs(h[1]-_[1]),o)],b=[r-x.left-x.right-Math.abs(u[0])*2,t-x.top-x.bottom-Math.abs(u[1])*2];ve(b[0]>0&&b[1]>0);var O=b[0]/P[0],L=b[1]/P[1],T=(x.right-x.left)/2/O,R=(x.bottom-x.top)/2/L,W=[(h[0]+_[0])/2+T,(h[1]+_[1])/2+R],z=ge(W),E=Math.min(s,Gr(Math.abs(Math.min(O,L))));return ve(Number.isFinite(E)),{longitude:z[0],latitude:z[1],zoom:E}}function Md(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return typeof e=="number"?{top:e,bottom:e,left:e,right:e}:(ve(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}var ds=Math.PI/180;function qr(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=e.width,n=e.height,i=e.unproject,o={targetZ:r},a=i([0,n],o),s=i([t,n],o),l,u,f=e.fovy?.5*e.fovy*ds:Math.atan(.5/e.altitude),c=(90-e.pitch)*ds;return f>c-.01?(l=gs(e,0,r),u=gs(e,t,r)):(l=i([0,0],o),u=i([t,0],o)),[a,s,u,l]}function gs(e,r,t){var n=e.pixelUnprojectionMatrix,i=De(n,[r,0,1,1]),o=De(n,[r,e.height,1,1]),a=t*e.distanceScales.unitsPerMeter[2],s=(a-i[2])/(o[2]-i[2]),l=$r([],i,o,s),u=ge(l);return u.push(t),u}var hs=function(){function e(){var r=this,t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{width:1,height:1};xi(this,e),V(this,"latitude",void 0),V(this,"longitude",void 0),V(this,"zoom",void 0),V(this,"pitch",void 0),V(this,"bearing",void 0),V(this,"altitude",void 0),V(this,"fovy",void 0),V(this,"meterOffset",void 0),V(this,"center",void 0),V(this,"width",void 0),V(this,"height",void 0),V(this,"scale",void 0),V(this,"distanceScales",void 0),V(this,"viewMatrix",void 0),V(this,"projectionMatrix",void 0),V(this,"viewProjectionMatrix",void 0),V(this,"pixelProjectionMatrix",void 0),V(this,"pixelUnprojectionMatrix",void 0),V(this,"equals",function(E){return E instanceof e?E.width===r.width&&E.height===r.height&&bi(E.projectionMatrix,r.projectionMatrix)&&bi(E.viewMatrix,r.viewMatrix):!1}),V(this,"project",function(E){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=D.topLeft,S=k===void 0?!0:k,w=r.projectPosition(E),C=Ai(w,r.pixelProjectionMatrix),A=Q(C,2),M=A[0],U=A[1],G=S?U:r.height-U;return E.length===2?[M,G]:[M,G,C[2]]}),V(this,"unproject",function(E){var D=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},k=D.topLeft,S=k===void 0?!0:k,w=D.targetZ,C=w===void 0?void 0:w,A=Q(E,3),M=A[0],U=A[1],G=A[2],X=S?U:r.height-U,te=C&&C*r.distanceScales.unitsPerMeter[2],re=Kr([M,X,G],r.pixelUnprojectionMatrix,te),Te=r.unprojectPosition(re),pe=Q(Te,3),ai=pe[0],si=pe[1],$v=pe[2];return Number.isFinite(G)?[ai,si,$v]:Number.isFinite(C)?[ai,si,C]:[ai,si]}),V(this,"projectPosition",function(E){var D=le(E),k=Q(D,2),S=k[0],w=k[1],C=(E[2]||0)*r.distanceScales.unitsPerMeter[2];return[S,w,C]}),V(this,"unprojectPosition",function(E){var D=ge(E),k=Q(D,2),S=k[0],w=k[1],C=(E[2]||0)*r.distanceScales.metersPerUnit[2];return[S,w,C]});var n=t.width,i=t.height,o=t.altitude,a=o===void 0?null:o,s=t.fovy,l=s===void 0?null:s,u=t.latitude,f=u===void 0?0:u,c=t.longitude,p=c===void 0?0:c,d=t.zoom,g=d===void 0?0:d,m=t.pitch,y=m===void 0?0:m,x=t.bearing,_=x===void 0?0:x,h=t.position,P=h===void 0?null:h,b=t.nearZMultiplier,O=b===void 0?.02:b,L=t.farZMultiplier,T=L===void 0?1.01:L;n=n||1,i=i||1,l===null&&a===null?(a=Oi,l=ut(a)):l===null?l=ut(a):a===null&&(a=Yr(l));var R=Zr(g);a=Math.max(.75,a);var W=Ci({longitude:p,latitude:f}),z=le([p,f]);z.push(0),P&&ss(z,z,us([],P,W.unitsPerMeter)),this.projectionMatrix=Li({width:n,height:i,scale:R,center:z,pitch:y,fovy:l,nearZMultiplier:O,farZMultiplier:T}),this.viewMatrix=Mi({height:i,scale:R,center:z,pitch:y,bearing:_,altitude:a}),this.width=n,this.height=i,this.scale=R,this.latitude=f,this.longitude=p,this.zoom=g,this.pitch=y,this.bearing=_,this.altitude=a,this.fovy=l,this.center=z,this.meterOffset=P||[0,0,0],this.distanceScales=W,this._initMatrices(),Object.freeze(this)}return Pi(e,[{key:"_initMatrices",value:function(){var t=this.width,n=this.height,i=this.projectionMatrix,o=this.viewMatrix,a=lt();Vr(a,a,i),Vr(a,a,o),this.viewProjectionMatrix=a;var s=lt();Hr(s,s,[t/2,-n/2,1]),jt(s,s,[1,-1,0]),Vr(s,s,a);var l=ts(lt(),s);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=s,this.pixelUnprojectionMatrix=l}},{key:"projectFlat",value:function(t){return le(t)}},{key:"unprojectFlat",value:function(t){return ge(t)}},{key:"getMapCenterByLngLatPosition",value:function(t){var n=t.lngLat,i=t.pos,o=Kr(i,this.pixelUnprojectionMatrix),a=le(n),s=wi([],a,as([],o)),l=wi([],this.center,s);return ge(l)}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=this.width,o=this.height,a=Jr(Object.assign({width:i,height:o,bounds:t},n)),s=a.longitude,l=a.latitude,u=a.zoom;return new e({width:i,height:o,longitude:s,latitude:l,zoom:u})}},{key:"getBounds",value:function(t){var n=this.getBoundingRegion(t),i=Math.min.apply(Math,st(n.map(function(l){return l[0]}))),o=Math.max.apply(Math,st(n.map(function(l){return l[0]}))),a=Math.min.apply(Math,st(n.map(function(l){return l[1]}))),s=Math.max.apply(Math,st(n.map(function(l){return l[1]})));return[[i,a],[o,s]]}},{key:"getBoundingRegion",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return qr(this,t.z||0)}},{key:"getLocationAtPoint",value:function(t){var n=t.lngLat,i=t.pos;return this.getMapCenterByLngLatPosition({lngLat:n,pos:i})}}]),e}();var cx=1/Math.PI*180,px=1/180*Math.PI,Wt={EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0};function ct(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function pt(e,r,t){return ct(e)?e.map(function(n,i){return pt(n,r[i],t)}):t*r+(1-t)*e}function vt(e,r,t){var n=Wt.EPSILON;t&&(Wt.EPSILON=t);try{if(e===r)return!0;if(ct(e)&&ct(r)){if(e.length!==r.length)return!1;for(var i=0;i<e.length;++i)if(!vt(e[i],r[i]))return!1;return!0}return e&&e.equals?e.equals(r):r&&r.equals?r.equals(e):typeof e=="number"&&typeof r=="number"?Math.abs(e-r)<=Wt.EPSILON*Math.max(1,Math.abs(e),Math.abs(r)):!1}finally{Wt.EPSILON=n}}var Ad=new Uint16Array([0,2,1,0,3,2]),Td=new Float32Array([0,1,0,0,1,0,1,1]);function Ti(e,r){if(!r)return Id(e);for(var t=Math.max(Math.abs(e[0][0]-e[3][0]),Math.abs(e[1][0]-e[2][0])),n=Math.max(Math.abs(e[1][1]-e[0][1]),Math.abs(e[2][1]-e[3][1])),i=Math.ceil(t/r)+1,o=Math.ceil(n/r)+1,a=(i-1)*(o-1)*6,s=new Uint32Array(a),l=new Float32Array(i*o*2),u=new Float64Array(i*o*3),f=0,c=0,p=0;p<i;p++)for(var d=p/(i-1),g=0;g<o;g++){var m=g/(o-1),y=Ed(e,d,m);u[f*3+0]=y[0],u[f*3+1]=y[1],u[f*3+2]=y[2]||0,l[f*2+0]=d,l[f*2+1]=1-m,p>0&&g>0&&(s[c++]=f-o,s[c++]=f-o-1,s[c++]=f-1,s[c++]=f-o,s[c++]=f-1,s[c++]=f),f++}return{vertexCount:a,positions:u,indices:s,texCoords:l}}function Id(e){for(var r=new Float64Array(12),t=0;t<e.length;t++)r[t*3+0]=e[t][0],r[t*3+1]=e[t][1],r[t*3+2]=e[t][2]||0;return{vertexCount:6,positions:r,indices:Ad,texCoords:Td}}function Ed(e,r,t){return pt(pt(e[0],e[1],t),pt(e[3],e[2],t),r)}var ms=`
#define SHADER_NAME bitmap-layer-vertex-shader

attribute vec2 texCoords;
attribute vec3 positions;
attribute vec3 positions64Low;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float coordinateConversion;

const vec3 pickingColor = vec3(1.0, 0.0, 0.0);

void main(void) {
  geometry.worldPosition = positions;
  geometry.uv = texCoords;
  geometry.pickingColor = pickingColor;

  gl_Position = project_position_to_clipspace(positions, positions64Low, vec3(0.0), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  vTexCoord = texCoords;

  if (coordinateConversion < -0.5) {
    vTexPos = geometry.position.xy + project_uCommonOrigin.xy;
  } else if (coordinateConversion > 0.5) {
    vTexPos = geometry.worldPosition.xy;
  }

  vec4 color = vec4(0.0);
  DECKGL_FILTER_COLOR(color, geometry);
}
`;var kd=`
vec3 packUVsIntoRGB(vec2 uv) {
  // Extract the top 8 bits. We want values to be truncated down so we can add a fraction
  vec2 uv8bit = floor(uv * 256.);

  // Calculate the normalized remainders of u and v parts that do not fit into 8 bits
  // Scale and clamp to 0-1 range
  vec2 uvFraction = fract(uv * 256.);
  vec2 uvFraction4bit = floor(uvFraction * 16.);

  // Remainder can be encoded in blue channel, encode as 4 bits for pixel coordinates
  float fractions = uvFraction4bit.x + uvFraction4bit.y * 16.;

  return vec3(uv8bit, fractions) / 255.;
}
`,ys=`
#define SHADER_NAME bitmap-layer-fragment-shader

#ifdef GL_ES
precision highp float;
#endif

uniform sampler2D bitmapTexture;

varying vec2 vTexCoord;
varying vec2 vTexPos;

uniform float desaturate;
uniform vec4 transparentColor;
uniform vec3 tintColor;
uniform float opacity;

uniform float coordinateConversion;
uniform vec4 bounds;

/* projection utils */
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / PI / 2.0;

// from degrees to Web Mercator
vec2 lnglat_to_mercator(vec2 lnglat) {
  float x = lnglat.x;
  float y = clamp(lnglat.y, -89.9, 89.9);
  return vec2(
    radians(x) + PI,
    PI + log(tan(PI * 0.25 + radians(y) * 0.5))
  ) * WORLD_SCALE;
}

// from Web Mercator to degrees
vec2 mercator_to_lnglat(vec2 xy) {
  xy /= WORLD_SCALE;
  return degrees(vec2(
    xy.x - PI,
    atan(exp(xy.y - PI)) * 2.0 - PI * 0.5
  ));
}
/* End projection utils */

// apply desaturation
vec3 color_desaturate(vec3 color) {
  float luminance = (color.r + color.g + color.b) * 0.333333333;
  return mix(color, vec3(luminance), desaturate);
}

// apply tint
vec3 color_tint(vec3 color) {
  return color * tintColor;
}

// blend with background color
vec4 apply_opacity(vec3 color, float alpha) {
  if (transparentColor.a == 0.0) {
    return vec4(color, alpha);
  }
  float blendedAlpha = alpha + transparentColor.a * (1.0 - alpha);
  float highLightRatio = alpha / blendedAlpha;
  vec3 blendedRGB = mix(transparentColor.rgb, color, highLightRatio);
  return vec4(blendedRGB, blendedAlpha);
}

vec2 getUV(vec2 pos) {
  return vec2(
    (pos.x - bounds[0]) / (bounds[2] - bounds[0]),
    (pos.y - bounds[3]) / (bounds[1] - bounds[3])
  );
}

`.concat(kd,`

void main(void) {
  vec2 uv = vTexCoord;
  if (coordinateConversion < -0.5) {
    vec2 lnglat = mercator_to_lnglat(vTexPos);
    uv = getUV(lnglat);
  } else if (coordinateConversion > 0.5) {
    vec2 commonPos = lnglat_to_mercator(vTexPos);
    uv = getUV(commonPos);
  }
  vec4 bitmapColor = texture2D(bitmapTexture, uv);

  gl_FragColor = apply_opacity(color_tint(color_desaturate(bitmapColor.rgb)), bitmapColor.a * opacity);

  geometry.uv = uv;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);

  if (picking_uActive && !picking_uAttribute) {
    // Since instance information is not used, we can use picking color for pixel index
    gl_FragColor.rgb = packUVsIntoRGB(uv);
  }
}
`);function xs(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Bt(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?xs(Object(t),!0).forEach(function(n){(0,Gt.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):xs(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Rd(e){var r=zd();return function(){var n=(0,Ut.default)(e),i;if(r){var o=(0,Ut.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Cs.default)(this,i)}}function zd(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Fd={image:{type:"image",value:null,async:!0},bounds:{type:"array",value:[1,0,0,1],compare:!0},_imageCoordinateSystem:he.COORDINATE_SYSTEM.DEFAULT,desaturate:{type:"number",min:0,max:1,value:0},transparentColor:{type:"color",value:[0,0,0,0]},tintColor:{type:"color",value:[255,255,255]},textureParameters:{type:"object",ignore:!0}},Qr=function(e){(0,Os.default)(t,e);var r=Rd(t);function t(){var n;(0,ws.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Gt.default)((0,Ss.default)(n),"state",void 0),n}return(0,_s.default)(t,[{key:"getShaders",value:function(){return(0,Ii.default)((0,Ut.default)(t.prototype),"getShaders",this).call(this,{vs:ms,fs:ys,modules:[he.project32,he.picking]})}},{key:"initializeState",value:function(){var i=this,o=this.getAttributeManager();o.remove(["instancePickingColors"]);var a=!0;o.add({indices:{size:1,isIndexed:!0,update:function(l){return l.value=i.state.mesh.indices},noAlloc:a},positions:{size:3,type:5130,fp64:this.use64bitPositions(),update:function(l){return l.value=i.state.mesh.positions},noAlloc:a},texCoords:{size:2,update:function(l){return l.value=i.state.mesh.texCoords},noAlloc:a}})}},{key:"updateState",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager();if(s.extensionsChanged){var u,f=this.context.gl;(u=this.state.model)===null||u===void 0||u.delete(),this.state.model=this._getModel(f),l.invalidateAll()}if(o.bounds!==a.bounds){var c=this.state.mesh,p=this._createMesh();this.state.model.setVertexCount(p.vertexCount);for(var d in p)c&&c[d]!==p[d]&&l.invalidate(d);this.setState(Bt({mesh:p},this._getCoordinateUniforms()))}else o._imageCoordinateSystem!==a._imageCoordinateSystem&&this.setState(this._getCoordinateUniforms())}},{key:"getPickingInfo",value:function(i){var o=this.props.image,a=i.info;if(!a.color||!o)return a.bitmap=null,a;var s=o,l=s.width,u=s.height;a.index=0;var f=Dd(a.color),c=[Math.floor(f[0]*l),Math.floor(f[1]*u)];return a.bitmap={size:{width:l,height:u},uv:f,pixel:c},a}},{key:"disablePickingIndex",value:function(){this.setState({disablePicking:!0})}},{key:"restorePickingColors",value:function(){this.setState({disablePicking:!1})}},{key:"_updateAutoHighlight",value:function(i){(0,Ii.default)((0,Ut.default)(t.prototype),"_updateAutoHighlight",this).call(this,Bt(Bt({},i),{},{color:this.encodePickingColor(0)}))}},{key:"_createMesh",value:function(){var i=this.props.bounds,o=i;return Ps(i)&&(o=[[i[0],i[1]],[i[0],i[3]],[i[2],i[3]],[i[2],i[1]]]),Ti(o,this.context.viewport.resolution)}},{key:"_getModel",value:function(i){return i?new Xr.Model(i,Bt(Bt({},this.getShaders()),{},{id:this.props.id,geometry:new Xr.Geometry({drawMode:4,vertexCount:6}),isInstanced:!1})):null}},{key:"draw",value:function(i){var o=i.uniforms,a=i.moduleParameters,s=this.state,l=s.model,u=s.coordinateConversion,f=s.bounds,c=s.disablePicking,p=this.props,d=p.image,g=p.desaturate,m=p.transparentColor,y=p.tintColor;a.pickingActive&&c||d&&l&&l.setUniforms(o).setUniforms({bitmapTexture:d,desaturate:g,transparentColor:m.map(function(x){return x/255}),tintColor:y.slice(0,3).map(function(x){return x/255}),coordinateConversion:u,bounds:f}).draw()}},{key:"_getCoordinateUniforms",value:function(){var i=he.COORDINATE_SYSTEM.LNGLAT,o=he.COORDINATE_SYSTEM.CARTESIAN,a=he.COORDINATE_SYSTEM.DEFAULT,s=this.props._imageCoordinateSystem;if(s!==a){var l=this.props.bounds;if(!Ps(l))throw new Error("_imageCoordinateSystem only supports rectangular bounds");var u=this.context.viewport.resolution?i:o;if(s=s===i?i:o,s===i&&u===o)return{coordinateConversion:-1,bounds:l};if(s===o&&u===i){var f=le([l[0],l[1]]),c=le([l[2],l[3]]);return{coordinateConversion:1,bounds:[f[0],f[1],c[0],c[1]]}}}return{coordinateConversion:0,bounds:[0,0,0,0]}}}]),t}(he.Layer);(0,Gt.default)(Qr,"layerName","BitmapLayer");(0,Gt.default)(Qr,"defaultProps",Fd);function Dd(e){var r=(0,bs.default)(e,3),t=r[0],n=r[1],i=r[2],o=(i&240)/256,a=(i&15)/16;return[(t+a)/256,(n+o)/256]}function Ps(e){return Number.isFinite(e[0])}var Qu=v(j()),ef=v(B()),tf=v(be()),or=v(ne()),rf=v(J()),nf=v(q()),tt=v(Y()),ar=v(N()),Me=v(H()),xn=v(ie());var Ms=`#define SHADER_NAME icon-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute vec4 instanceIconFrames;
attribute float instanceColorModes;
attribute vec2 instanceOffsets;
attribute vec2 instancePixelOffset;

uniform float sizeScale;
uniform vec2 iconsTextureDim;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform bool billboard;
uniform int sizeUnits;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = angle * PI / 180.0;
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;

  vec2 iconSize = instanceIconFrames.zw;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits), 
    sizeMinPixels, sizeMaxPixels
  );
  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;
  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;
  pixelOffset += instancePixelOffset;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);

  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); 
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }

  vTextureCoords = mix(
    instanceIconFrames.xy,
    instanceIconFrames.xy + iconSize,
    (positions.xy + 1.0) / 2.0
  ) / iconsTextureDim;

  vColor = instanceColors;
  DECKGL_FILTER_COLOR(vColor, geometry);

  vColorMode = instanceColorModes;
}
`;var Ls=`#define SHADER_NAME icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float alphaCutoff;

varying float vColorMode;
varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  vec4 texColor = texture2D(iconsTexture, vTextureCoords);
  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);
  float a = texColor.a * opacity * vColor.a;

  if (a < alphaCutoff) {
    discard;
  }

  gl_FragColor = vec4(color, a);
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;var $u=v(j()),Zu=v(B()),$=v(N()),ir=v(ie());var Ml=v(Se()),co=v(oe());function en(e,r){if(!e)throw new Error(r||"loader assertion failed.")}var zs=v(se()),Oe={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Nd=Oe.self||Oe.window||Oe.global||{},Wd=Oe.window||Oe.self||Oe.global||{},Bd=Oe.global||Oe.self||Oe.window||{},Ud=Oe.document||{};var Vt=Boolean((typeof process>"u"?"undefined":(0,zs.default)(process))!=="object"||String(process)!=="[object process]"||process.browser);var Rs=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),Gd=Rs&&parseFloat(Rs[1])||0;var Fs="3.3.1";function ee(e,r){if(!e)throw new Error(r||"loaders.gl assertion failed.")}var js=v(se()),Ce={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document},Jx=Ce.self||Ce.window||Ce.global||{},qx=Ce.window||Ce.self||Ce.global||{},Xx=Ce.global||Ce.self||Ce.window||{},Qx=Ce.document||{};var qe=(typeof process>"u"?"undefined":(0,js.default)(process))!=="object"||String(process)!=="[object process]"||process.browser;var Ns=typeof window<"u"&&typeof window.orientation<"u",Ds=typeof process<"u"&&process.version&&/v([0-9]*)/.exec(process.version),e1=Ds&&parseFloat(Ds[1])||0;var Ws=v(j()),Bs=v(B());function I(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var Us=function(){function e(r,t){var n=this;(0,Ws.default)(this,e),I(this,"name",void 0),I(this,"workerThread",void 0),I(this,"isRunning",!0),I(this,"result",void 0),I(this,"_resolve",function(){}),I(this,"_reject",function(){}),this.name=r,this.workerThread=t,this.result=new Promise(function(i,o){n._resolve=i,n._reject=o})}return(0,Bs.default)(e,[{key:"postMessage",value:function(t,n){this.workerThread.postMessage({source:"loaders.gl",type:t,payload:n})}},{key:"done",value:function(t){ee(this.isRunning),this.isRunning=!1,this._resolve(t)}},{key:"error",value:function(t){ee(this.isRunning),this.isRunning=!1,this._reject(t)}}]),e}();var Ks=v(j()),Js=v(B());var Gs=v(j()),Vs=v(B()),tn=function(){function e(){(0,Gs.default)(this,e)}return(0,Vs.default)(e,[{key:"terminate",value:function(){}}]),e}();var ki=new Map;function Hs(e){ee(e.source&&!e.url||!e.source&&e.url);var r=ki.get(e.source||e.url);return r||(e.url&&(r=Vd(e.url),ki.set(e.url,r)),e.source&&(r=$s(e.source),ki.set(e.source,r))),ee(r),r}function Vd(e){if(!e.startsWith("http"))return e;var r=Hd(e);return $s(r)}function $s(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function Hd(e){return`try {
  importScripts('`.concat(e,`');
} catch (error) {
  console.error(error);
  throw error;
}`)}var Ys=v(se());function Ri(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2?arguments[2]:void 0,n=t||new Set;if(e){if(Zs(e))n.add(e);else if(Zs(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&(0,Ys.default)(e)==="object")for(var i in e)Ri(e[i],r,n)}}return t===void 0?Array.from(n):[]}function Zs(e){return e?e instanceof ArrayBuffer||typeof MessagePort<"u"&&e instanceof MessagePort||typeof ImageBitmap<"u"&&e instanceof ImageBitmap||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas:!1}var zi=function(){},Ht=function(){function e(r){(0,Ks.default)(this,e),I(this,"name",void 0),I(this,"source",void 0),I(this,"url",void 0),I(this,"terminated",!1),I(this,"worker",void 0),I(this,"onMessage",void 0),I(this,"onError",void 0),I(this,"_loadableURL","");var t=r.name,n=r.source,i=r.url;ee(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=zi,this.onError=function(o){return console.log(o)},this.worker=qe?this._createBrowserWorker():this._createNodeWorker()}return(0,Js.default)(e,[{key:"destroy",value:function(){this.onMessage=zi,this.onError=zi,this.worker.terminate(),this.terminated=!0}},{key:"isRunning",get:function(){return Boolean(this.onMessage)}},{key:"postMessage",value:function(t,n){n=n||Ri(t),this.worker.postMessage(t,n)}},{key:"_getErrorFromErrorEvent",value:function(t){var n="Failed to load ";return n+="worker ".concat(this.name," from ").concat(this.url,". "),t.message&&(n+="".concat(t.message," in ")),t.lineno&&(n+=":".concat(t.lineno,":").concat(t.colno)),new Error(n)}},{key:"_createBrowserWorker",value:function(){var t=this;this._loadableURL=Hs({source:this.source,url:this.url});var n=new Worker(this._loadableURL,{name:this.name});return n.onmessage=function(i){i.data?t.onMessage(i.data):t.onError(new Error("No data received"))},n.onerror=function(i){t.onError(t._getErrorFromErrorEvent(i)),t.terminated=!0},n.onmessageerror=function(i){return console.error(i)},n}},{key:"_createNodeWorker",value:function(){var t=this,n;if(this.url){var i=this.url.includes(":/")||this.url.startsWith("/"),o=i?this.url:"./".concat(this.url);n=new tn(o,{eval:!1})}else if(this.source)n=new tn(this.source,{eval:!0});else throw new Error("no worker");return n.on("message",function(a){t.onMessage(a)}),n.on("error",function(a){t.onError(a)}),n.on("exit",function(a){}),n}}],[{key:"isSupported",value:function(){return typeof Worker<"u"&&qe||typeof tn<"u"&&!qe}}]),e}();var al=v(N()),sl=v(j()),ll=v(B());var Fi=v(Se()),Qs=v(N()),el=v(j()),tl=v(B()),$t=v(oe());function qs(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Xs(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?qs(Object(t),!0).forEach(function(n){(0,Qs.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qs(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var rl=function(){function e(r){(0,el.default)(this,e),I(this,"name","unnamed"),I(this,"source",void 0),I(this,"url",void 0),I(this,"maxConcurrency",1),I(this,"maxMobileConcurrency",1),I(this,"onDebug",function(){}),I(this,"reuseWorkers",!0),I(this,"props",{}),I(this,"jobQueue",[]),I(this,"idleQueue",[]),I(this,"count",0),I(this,"isDestroyed",!1),this.source=r.source,this.url=r.url,this.setProps(r)}return(0,tl.default)(e,[{key:"destroy",value:function(){this.idleQueue.forEach(function(t){return t.destroy()}),this.isDestroyed=!0}},{key:"setProps",value:function(t){this.props=Xs(Xs({},this.props),t),t.name!==void 0&&(this.name=t.name),t.maxConcurrency!==void 0&&(this.maxConcurrency=t.maxConcurrency),t.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=t.maxMobileConcurrency),t.reuseWorkers!==void 0&&(this.reuseWorkers=t.reuseWorkers),t.onDebug!==void 0&&(this.onDebug=t.onDebug)}},{key:"startJob",value:function(){var r=(0,Fi.default)($t.default.mark(function n(i){var o=this,a,s,l,u=arguments;return $t.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return a=u.length>1&&u[1]!==void 0?u[1]:function(p,d,g){return p.done(g)},s=u.length>2&&u[2]!==void 0?u[2]:function(p,d){return p.error(d)},l=new Promise(function(p){return o.jobQueue.push({name:i,onMessage:a,onError:s,onStart:p}),o}),this._startQueuedJob(),c.next=6,l;case 6:return c.abrupt("return",c.sent);case 7:case"end":return c.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"_startQueuedJob",value:function(){var r=(0,Fi.default)($t.default.mark(function n(){var i,o,a;return $t.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(this.jobQueue.length){l.next=2;break}return l.abrupt("return");case 2:if(i=this._getAvailableWorker(),i){l.next=5;break}return l.abrupt("return");case 5:if(o=this.jobQueue.shift(),!o){l.next=18;break}return this.onDebug({message:"Starting job",name:o.name,workerThread:i,backlog:this.jobQueue.length}),a=new Us(o.name,i),i.onMessage=function(u){return o.onMessage(a,u.type,u.payload)},i.onError=function(u){return o.onError(a,u)},o.onStart(a),l.prev=12,l.next=15,a.result;case 15:return l.prev=15,this.returnWorkerToQueue(i),l.finish(15);case 18:case"end":return l.stop()}},n,this,[[12,,15,18]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"returnWorkerToQueue",value:function(t){var n=this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency();n?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this._startQueuedJob()}},{key:"_getAvailableWorker",value:function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this._getMaxConcurrency()){this.count++;var t="".concat(this.name.toLowerCase()," (#").concat(this.count," of ").concat(this.maxConcurrency,")");return new Ht({name:t,source:this.source,url:this.url})}return null}},{key:"_getMaxConcurrency",value:function(){return Ns?this.maxMobileConcurrency:this.maxConcurrency}}],[{key:"isSupported",value:function(){return Ht.isSupported()}}]),e}();function nl(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$d(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function $d(e,r){if(e){if(typeof e=="string")return il(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return il(e,r)}}function il(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ol(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Di(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ol(Object(t),!0).forEach(function(n){(0,al.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ol(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var Zd={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:function(){}},Zt=function(){function e(r){(0,sl.default)(this,e),I(this,"props",void 0),I(this,"workerPools",new Map),this.props=Di({},Zd),this.setProps(r),this.workerPools=new Map}return(0,ll.default)(e,[{key:"destroy",value:function(){var t=nl(this.workerPools.values()),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.destroy()}}catch(o){t.e(o)}finally{t.f()}this.workerPools=new Map}},{key:"setProps",value:function(t){this.props=Di(Di({},this.props),t);var n=nl(this.workerPools.values()),i;try{for(n.s();!(i=n.n()).done;){var o=i.value;o.setProps(this._getWorkerPoolProps())}}catch(a){n.e(a)}finally{n.f()}}},{key:"getWorkerPool",value:function(t){var n=t.name,i=t.source,o=t.url,a=this.workerPools.get(n);return a||(a=new rl({name:n,source:i,url:o}),a.setProps(this._getWorkerPoolProps()),this.workerPools.set(n,a)),a}},{key:"_getWorkerPoolProps",value:function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}],[{key:"isSupported",value:function(){return Ht.isSupported()}},{key:"getWorkerFarm",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return e._workerFarm=e._workerFarm||new e({}),e._workerFarm.setProps(t),e._workerFarm}}]),e}();I(Zt,"_workerFarm",void 0);var Yd="latest";function ji(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r[e.id]||{},n="".concat(e.id,"-worker.js"),i=t.workerUrl;if(!i&&e.id==="compression"&&(i=r.workerUrl),r._workerType==="test"&&(i="modules/".concat(e.module,"/dist/").concat(n)),!i){var o=e.version;o==="latest"&&(o=Yd);var a=o?"@".concat(o):"";i="https://unpkg.com/@loaders.gl/".concat(e.module).concat(a,"/dist/").concat(n)}return ee(i),i}function Wi(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Fs;ee(e,"no worker provided");var t=e.version;return!(!r||!t)}var Gi=v(Se()),Yt=v(oe());function Vi(e,r){return!Zt.isSupported()||!qe&&!(r!=null&&r._nodeWorkers)?!1:e.worker&&r?.worker}function Hi(e,r,t,n,i){return Bi.apply(this,arguments)}function Bi(){return Bi=(0,Gi.default)(Yt.default.mark(function e(r,t,n,i,o){var a,s,l,u,f,c;return Yt.default.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=r.id,s=ji(r,n),l=Zt.getWorkerFarm(n),u=l.getWorkerPool({name:a,url:s}),n=JSON.parse(JSON.stringify(n)),i=JSON.parse(JSON.stringify(i||{})),d.next=8,u.startJob("process-on-worker",Jd.bind(null,o));case 8:return f=d.sent,f.postMessage("process",{input:t,options:n,context:i}),d.next=12,f.result;case 12:return c=d.sent,d.next=15,c.result;case 15:return d.abrupt("return",d.sent);case 16:case"end":return d.stop()}},e)})),Bi.apply(this,arguments)}function Jd(e,r,t,n){return Ui.apply(this,arguments)}function Ui(){return Ui=(0,Gi.default)(Yt.default.mark(function e(r,t,n,i){var o,a,s,l,u;return Yt.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:c.t0=n,c.next=c.t0==="done"?3:c.t0==="error"?5:c.t0==="process"?7:20;break;case 3:return t.done(i),c.abrupt("break",21);case 5:return t.error(new Error(i.error)),c.abrupt("break",21);case 7:return o=i.id,a=i.input,s=i.options,c.prev=8,c.next=11,r(a,s);case 11:l=c.sent,t.postMessage("done",{id:o,result:l}),c.next=19;break;case 15:c.prev=15,c.t1=c.catch(8),u=c.t1 instanceof Error?c.t1.message:"unknown error",t.postMessage("error",{id:o,error:u});case 19:return c.abrupt("break",21);case 20:console.warn("parse-with-worker unknown message ".concat(n));case 21:case"end":return c.stop()}},e,null,[[8,15]])})),Ui.apply(this,arguments)}function qd(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Xd(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Xd(e,r){if(e){if(typeof e=="string")return fl(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return fl(e,r)}}function fl(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function $i(e,r,t){if(t=t||e.byteLength,e.byteLength<t||r.byteLength<t)return!1;for(var n=new Uint8Array(e),i=new Uint8Array(r),o=0;o<n.length;++o)if(n[o]!==i[o])return!1;return!0}function Zi(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n=r.map(function(f){return f instanceof ArrayBuffer?new Uint8Array(f):f}),i=n.reduce(function(f,c){return f+c.byteLength},0),o=new Uint8Array(i),a=0,s=qd(n),l;try{for(s.s();!(l=s.n()).done;){var u=l.value;o.set(u,a),a+=u.byteLength}}catch(f){s.e(f)}finally{s.f()}return o.buffer}var hl=v(Se()),ml=v(Ni()),qi=v(oe());function Qi(e){return Xi.apply(this,arguments)}function Xi(){return Xi=(0,hl.default)(qi.default.mark(function e(r){var t,n,i,o,a,s,l;return qi.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t=[],n=!1,i=!1,f.prev=3,a=(0,ml.default)(r);case 5:return f.next=7,a.next();case 7:if(!(n=!(s=f.sent).done)){f.next=13;break}l=s.value,t.push(l);case 10:n=!1,f.next=5;break;case 13:f.next=19;break;case 15:f.prev=15,f.t0=f.catch(3),i=!0,o=f.t0;case 19:if(f.prev=19,f.prev=20,!(n&&a.return!=null)){f.next=24;break}return f.next=24,a.return();case 24:if(f.prev=24,!i){f.next=27;break}throw o;case 27:return f.finish(24);case 28:return f.finish(19);case 29:return f.abrupt("return",Zi.apply(void 0,t));case 30:case"end":return f.stop()}},e,null,[[3,15,19,29],[20,,24,28]])})),Xi.apply(this,arguments)}var og="",yl={};function eo(e){for(var r in yl)if(e.startsWith(r)){var t=yl[r];e=e.replace(r,t)}return!e.startsWith("http://")&&!e.startsWith("https://")&&(e="".concat(og).concat(e)),e}var to=v(se()),ro=v(xl());function Pl(e){return e&&(0,to.default)(e)==="object"&&e.isBuffer}function rn(e){if(Pl(e))return ro.toArrayBuffer(e);if(e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if(typeof e=="string"){var r=e,t=new TextEncoder().encode(r);return t.buffer}if(e&&(0,to.default)(e)==="object"&&e._toArrayBuffer)return e._toArrayBuffer();throw new Error("toArrayBuffer")}var nn={};ba(nn,{dirname:()=>sg,filename:()=>ag,join:()=>lg});function ag(e){var r=e&&e.lastIndexOf("/");return r>=0?e.substr(r+1):""}function sg(e){var r=e&&e.lastIndexOf("/");return r>=0?e.substr(0,r):""}function lg(){for(var e=arguments.length,r=new Array(e),t=0;t<e;t++)r[t]=arguments[t];var n="/";return r=r.map(function(i,o){return o&&(i=i.replace(new RegExp("^".concat(n)),"")),o!==r.length-1&&(i=i.replace(new RegExp("".concat(n,"$")),"")),i}),r.join(n)}var qt=v(Se()),Ie=v(oe());var no=v(se()),ug=function(r){return typeof r=="boolean"},Jt=function(r){return typeof r=="function"},dt=function(r){return r!==null&&(0,no.default)(r)==="object"},io=function(r){return dt(r)&&r.constructor==={}.constructor};var bl=function(r){return r&&typeof r[Symbol.iterator]=="function"},wl=function(r){return r&&typeof r[Symbol.asyncIterator]=="function"};var me=function(r){return typeof Response<"u"&&r instanceof Response||r&&r.arrayBuffer&&r.text&&r.json};var ye=function(r){return typeof Blob<"u"&&r instanceof Blob},_l=function(r){return r&&(0,no.default)(r)==="object"&&r.isBuffer};var fg=function(r){return typeof ReadableStream<"u"&&r instanceof ReadableStream||dt(r)&&Jt(r.tee)&&Jt(r.cancel)&&Jt(r.getReader)};var cg=function(r){return dt(r)&&Jt(r.read)&&Jt(r.pipe)&&ug(r.readable)},on=function(r){return fg(r)||cg(r)};var pg=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,vg=/^([-\w.]+\/[-\w.+]+)/;function Sl(e){var r=vg.exec(e);return r?r[1]:e}function oo(e){var r=pg.exec(e);return r?r[1]:""}var dg=/\?.*/;function Xe(e){if(me(e)){var r=ao(e.url||""),t=e.headers.get("content-type")||"";return{url:r,type:Sl(t)||oo(r)}}return ye(e)?{url:ao(e.name||""),type:e.type||""}:typeof e=="string"?{url:ao(e),type:oo(e)}:{url:"",type:""}}function Ol(e){return me(e)?e.headers["content-length"]||-1:ye(e)?e.size:typeof e=="string"?e.length:e instanceof ArrayBuffer||ArrayBuffer.isView(e)?e.byteLength:-1}function ao(e){return e.replace(dg,"")}function an(e){return so.apply(this,arguments)}function so(){return so=(0,qt.default)(Ie.default.mark(function e(r){var t,n,i,o,a,s,l;return Ie.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(!me(r)){f.next=2;break}return f.abrupt("return",r);case 2:return t={},n=Ol(r),n>=0&&(t["content-length"]=String(n)),i=Xe(r),o=i.url,a=i.type,a&&(t["content-type"]=a),f.next=9,hg(r);case 9:return s=f.sent,s&&(t["x-first-bytes"]=s),typeof r=="string"&&(r=new TextEncoder().encode(r)),l=new Response(r,{headers:t}),Object.defineProperty(l,"url",{value:o}),f.abrupt("return",l);case 15:case"end":return f.stop()}},e)})),so.apply(this,arguments)}function Cl(e){return lo.apply(this,arguments)}function lo(){return lo=(0,qt.default)(Ie.default.mark(function e(r){var t;return Ie.default.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:if(r.ok){i.next=5;break}return i.next=3,gg(r);case 3:throw t=i.sent,new Error(t);case 5:case"end":return i.stop()}},e)})),lo.apply(this,arguments)}function gg(e){return uo.apply(this,arguments)}function uo(){return uo=(0,qt.default)(Ie.default.mark(function e(r){var t,n,i;return Ie.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t="Failed to fetch resource ".concat(r.url," (").concat(r.status,"): "),a.prev=1,n=r.headers.get("Content-Type"),i=r.statusText,!n.includes("application/json")){a.next=11;break}return a.t0=i,a.t1=" ",a.next=9,r.text();case 9:a.t2=a.sent,i=a.t0+=a.t1.concat.call(a.t1,a.t2);case 11:t+=i,t=t.length>60?"".concat(t.slice(0,60),"..."):t,a.next=17;break;case 15:a.prev=15,a.t3=a.catch(1);case 17:return a.abrupt("return",t);case 18:case"end":return a.stop()}},e,null,[[1,15]])})),uo.apply(this,arguments)}function hg(e){return fo.apply(this,arguments)}function fo(){return fo=(0,qt.default)(Ie.default.mark(function e(r){var t,n,i,o;return Ie.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(t=5,typeof r!="string"){s.next=3;break}return s.abrupt("return","data:,".concat(r.slice(0,t)));case 3:if(!(r instanceof Blob)){s.next=8;break}return n=r.slice(0,5),s.next=7,new Promise(function(l){var u=new FileReader;u.onload=function(f){var c;return l(f==null||(c=f.target)===null||c===void 0?void 0:c.result)},u.readAsDataURL(n)});case 7:return s.abrupt("return",s.sent);case 8:if(!(r instanceof ArrayBuffer)){s.next=12;break}return i=r.slice(0,t),o=mg(i),s.abrupt("return","data:base64,".concat(o));case 12:return s.abrupt("return",null);case 13:case"end":return s.stop()}},e)})),fo.apply(this,arguments)}function mg(e){for(var r="",t=new Uint8Array(e),n=0;n<t.byteLength;n++)r+=String.fromCharCode(t[n]);return btoa(r)}function vo(e,r){return po.apply(this,arguments)}function po(){return po=(0,Ml.default)(co.default.mark(function e(r,t){var n;return co.default.wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(typeof r!="string"){o.next=7;break}return r=eo(r),n=t,t!=null&&t.fetch&&typeof t?.fetch!="function"&&(n=t.fetch),o.next=6,fetch(r,n);case 6:return o.abrupt("return",o.sent);case 7:return o.next=9,an(r);case 9:return o.abrupt("return",o.sent);case 10:case"end":return o.stop()}},e)})),po.apply(this,arguments)}var au=v(N());var ho=v(j()),mo=v(B());var pn=v(se()),Xt=v(sn()),Kl=v(N()),Jl=v(j()),ql=v(B());var zl=v(se());var ln=v(se());function go(e){if(typeof window<"u"&&(0,ln.default)(window.process)==="object"&&window.process.type==="renderer"||typeof process<"u"&&(0,ln.default)(process.versions)==="object"&&Boolean(process.versions.electron))return!0;var r=(typeof navigator>"u"?"undefined":(0,ln.default)(navigator))==="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent,t=e||r;return!!(t&&t.indexOf("Electron")>=0)}function xe(){var e=(typeof process>"u"?"undefined":(0,zl.default)(process))==="object"&&String(process)==="[object process]"&&!process.browser;return!e||go()}var Fl=v(se()),je={self:typeof self<"u"&&self,window:typeof window<"u"&&window,global:typeof global<"u"&&global,document:typeof document<"u"&&document,process:(typeof process>"u"?"undefined":(0,Fl.default)(process))==="object"&&process};var Og=je.self||je.window||je.global,gt=je.window||je.self||je.global,Cg=je.document||{},Qe=je.process||{};var un="8.9.0",RP=xe();var Dl=v(j()),jl=v(B());function Mg(e){try{var r=window[e],t="__storage_test__";return r.setItem(t,t),r.removeItem(t),r}catch{return null}}var Nl=function(){function e(r){(0,Dl.default)(this,e);var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"sessionStorage";I(this,"storage",void 0),I(this,"id",void 0),I(this,"config",{}),this.storage=Mg(n),this.id=r,this.config={},Object.assign(this.config,t),this._loadConfiguration()}return(0,jl.default)(e,[{key:"getConfiguration",value:function(){return this.config}},{key:"setConfiguration",value:function(t){return this.config={},this.updateConfiguration(t)}},{key:"updateConfiguration",value:function(t){if(Object.assign(this.config,t),this.storage){var n=JSON.stringify(this.config);this.storage.setItem(this.id,n)}return this}},{key:"_loadConfiguration",value:function(){var t={};if(this.storage){var n=this.storage.getItem(this.id);t=n?JSON.parse(n):{}}return Object.assign(this.config,t),this}}]),e}();function Wl(e){var r;return e<10?r="".concat(e.toFixed(2),"ms"):e<100?r="".concat(e.toFixed(1),"ms"):e<1e3?r="".concat(e.toFixed(0),"ms"):r="".concat((e/1e3).toFixed(2),"s"),r}function Bl(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:8,t=Math.max(r-e.length,0);return"".concat(" ".repeat(t)).concat(e)}function fn(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:600,i=e.src.replace(/\(/g,"%28").replace(/\)/g,"%29");e.width>n&&(t=Math.min(t,n/e.width));var o=e.width*t,a=e.height*t,s=["font-size:1px;","padding:".concat(Math.floor(a/2),"px ").concat(Math.floor(o/2),"px;"),"line-height:".concat(a,"px;"),"background:url(".concat(i,");"),"background-size:".concat(o,"px ").concat(a,"px;"),"color:transparent;"].join("");return["".concat(r," %c+"),s]}var cn;(function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"})(cn||(cn={}));function Ul(e){return typeof e=="string"?cn[e.toUpperCase()]||cn.WHITE:e}function Gl(e,r,t){return!xe&&typeof e=="string"&&(r&&(r=Ul(r),e="\x1B[".concat(r,"m").concat(e,"\x1B[39m")),t&&(r=Ul(t),e="\x1B[".concat(t+10,"m").concat(e,"\x1B[49m"))),e}function Lg(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Ag(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Ag(e,r){if(e){if(typeof e=="string")return Vl(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vl(e,r)}}function Vl(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Hl(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:["constructor"],t=Object.getPrototypeOf(e),n=Object.getOwnPropertyNames(t),i=Lg(n),o;try{var a=function(){var l=o.value;typeof e[l]=="function"&&(r.find(function(u){return l===u})||(e[l]=e[l].bind(e)))};for(i.s();!(o=i.n()).done;)a()}catch(s){i.e(s)}finally{i.f()}}function ht(e,r){if(!e)throw new Error(r||"Assertion failed")}function et(){var e;if(xe&&"performance"in gt){var r,t;e=gt===null||gt===void 0||(r=gt.performance)===null||r===void 0||(t=r.now)===null||t===void 0?void 0:t.call(r)}else if("hrtime"in Qe){var n,i=Qe===null||Qe===void 0||(n=Qe.hrtime)===null||n===void 0?void 0:n.call(Qe);e=i[0]*1e3+i[1]/1e6}else e=Date.now();return e}var mt={debug:xe&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},Tg={enabled:!0,level:0};function fe(){}var $l={},Zl={once:!0},Ne=function(){function e(){(0,Jl.default)(this,e);var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{id:""},t=r.id;I(this,"id",void 0),I(this,"VERSION",un),I(this,"_startTs",et()),I(this,"_deltaTs",et()),I(this,"_storage",void 0),I(this,"userData",{}),I(this,"LOG_THROTTLE_TIMEOUT",0),this.id=t,this._storage=new Nl("__probe-".concat(this.id,"__"),Tg),this.userData={},this.timeStamp("".concat(this.id," started")),Hl(this),Object.seal(this)}return(0,ql.default)(e,[{key:"level",get:function(){return this.getLevel()},set:function(t){this.setLevel(t)}},{key:"isEnabled",value:function(){return this._storage.config.enabled}},{key:"getLevel",value:function(){return this._storage.config.level}},{key:"getTotal",value:function(){return Number((et()-this._startTs).toPrecision(10))}},{key:"getDelta",value:function(){return Number((et()-this._deltaTs).toPrecision(10))}},{key:"priority",get:function(){return this.level},set:function(t){this.level=t}},{key:"getPriority",value:function(){return this.level}},{key:"enable",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;return this._storage.updateConfiguration({enabled:t}),this}},{key:"setLevel",value:function(t){return this._storage.updateConfiguration({level:t}),this}},{key:"get",value:function(t){return this._storage.config[t]}},{key:"set",value:function(t,n){this._storage.updateConfiguration((0,Kl.default)({},t,n))}},{key:"settings",value:function(){console.table?console.table(this._storage.config):console.log(this._storage.config)}},{key:"assert",value:function(t,n){ht(t,n)}},{key:"warn",value:function(t){return this._getLogFunction(0,t,mt.warn,arguments,Zl)}},{key:"error",value:function(t){return this._getLogFunction(0,t,mt.error,arguments)}},{key:"deprecated",value:function(t,n){return this.warn("`".concat(t,"` is deprecated and will be removed in a later version. Use `").concat(n,"` instead"))}},{key:"removed",value:function(t,n){return this.error("`".concat(t,"` has been removed. Use `").concat(n,"` instead"))}},{key:"probe",value:function(t,n){return this._getLogFunction(t,n,mt.log,arguments,{time:!0,once:!0})}},{key:"log",value:function(t,n){return this._getLogFunction(t,n,mt.debug,arguments)}},{key:"info",value:function(t,n){return this._getLogFunction(t,n,console.info,arguments)}},{key:"once",value:function(t,n){for(var i=arguments.length,o=new Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return this._getLogFunction(t,n,mt.debug||mt.info,arguments,Zl)}},{key:"table",value:function(t,n,i){return n?this._getLogFunction(t,n,console.table||fe,i&&[i],{tag:Rg(n)}):fe}},{key:"image",value:function(t){var n=t.logLevel,i=t.priority,o=t.image,a=t.message,s=a===void 0?"":a,l=t.scale,u=l===void 0?1:l;return this._shouldLog(n||i)?xe?kg({image:o,message:s,scale:u}):Eg({image:o,message:s,scale:u}):fe}},{key:"time",value:function(t,n){return this._getLogFunction(t,n,console.time?console.time:console.info)}},{key:"timeEnd",value:function(t,n){return this._getLogFunction(t,n,console.timeEnd?console.timeEnd:console.info)}},{key:"timeStamp",value:function(t,n){return this._getLogFunction(t,n,console.timeStamp||fe)}},{key:"group",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{collapsed:!1},o=Yl({logLevel:t,message:n,opts:i}),a=i.collapsed;return o.method=(a?console.groupCollapsed:console.group)||console.info,this._getLogFunction(o)}},{key:"groupCollapsed",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};return this.group(t,n,Object.assign({},i,{collapsed:!0}))}},{key:"groupEnd",value:function(t){return this._getLogFunction(t,"",console.groupEnd||fe)}},{key:"withGroup",value:function(t,n,i){this.group(t,n)();try{i()}finally{this.groupEnd(t)()}}},{key:"trace",value:function(){console.trace&&console.trace()}},{key:"_shouldLog",value:function(t){return this.isEnabled()&&this.getLevel()>=Xl(t)}},{key:"_getLogFunction",value:function(t,n,i,o,a){if(this._shouldLog(t)){var s;a=Yl({logLevel:t,message:n,args:o,opts:a}),i=i||a.method,ht(i),a.total=this.getTotal(),a.delta=this.getDelta(),this._deltaTs=et();var l=a.tag||a.message;if(a.once)if(!$l[l])$l[l]=et();else return fe;return n=Ig(this.id,a.message,a),(s=i).bind.apply(s,[console,n].concat((0,Xt.default)(a.args)))}return fe}}]),e}();I(Ne,"VERSION",un);function Xl(e){if(!e)return 0;var r;switch((0,pn.default)(e)){case"number":r=e;break;case"object":r=e.logLevel||e.priority||0;break;default:return 0}return ht(Number.isFinite(r)&&r>=0),r}function Yl(e){var r=e.logLevel,t=e.message;e.logLevel=Xl(r);for(var n=e.args?Array.from(e.args):[];n.length&&n.shift()!==t;);switch((0,pn.default)(r)){case"string":case"function":t!==void 0&&n.unshift(t),e.message=r;break;case"object":Object.assign(e,r);break;default:}typeof e.message=="function"&&(e.message=e.message());var i=(0,pn.default)(e.message);return ht(i==="string"||i==="object"),Object.assign(e,{args:n},e.opts)}function Ig(e,r,t){if(typeof r=="string"){var n=t.time?Bl(Wl(t.total)):"";r=t.time?"".concat(e,": ").concat(n,"  ").concat(r):"".concat(e,": ").concat(r),r=Gl(r,t.color,t.background)}return r}function Eg(e){var r=e.image,t=e.message,n=t===void 0?"":t,i=e.scale,o=i===void 0?1:i,a=null;try{a=module.require("asciify-image")}catch{}return a?function(){return a(r,{fit:"box",width:"".concat(Math.round(80*o),"%")}).then(function(s){return console.log(s)})}:fe}function kg(e){var r=e.image,t=e.message,n=t===void 0?"":t,i=e.scale,o=i===void 0?1:i;if(typeof r=="string"){var a=new Image;return a.onload=function(){var f,c=fn(a,n,o);(f=console).log.apply(f,(0,Xt.default)(c))},a.src=r,fe}var s=r.nodeName||"";if(s.toLowerCase()==="img"){var l;return(l=console).log.apply(l,(0,Xt.default)(fn(r,n,o))),fe}if(s.toLowerCase()==="canvas"){var u=new Image;return u.onload=function(){var f;return(f=console).log.apply(f,(0,Xt.default)(fn(u,n,o)))},u.src=r.toDataURL(),fe}return fe}function Rg(e){for(var r in e)for(var t in e[r])return t||"untitled";return"empty"}var lb=new Ne({id:"@probe.gl/log"});var yo=new Ne({id:"loaders.gl"}),Ql=function(){function e(){(0,ho.default)(this,e)}return(0,mo.default)(e,[{key:"log",value:function(){return function(){}}},{key:"info",value:function(){return function(){}}},{key:"warn",value:function(){return function(){}}},{key:"error",value:function(){return function(){}}}]),e}(),eu=function(){function e(){(0,ho.default)(this,e),I(this,"console",void 0),this.console=console}return(0,mo.default)(e,[{key:"log",value:function(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=this.console.log).bind.apply(t,[this.console].concat(i))}},{key:"info",value:function(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=this.console.info).bind.apply(t,[this.console].concat(i))}},{key:"warn",value:function(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=this.console.warn).bind.apply(t,[this.console].concat(i))}},{key:"error",value:function(){for(var t,n=arguments.length,i=new Array(n),o=0;o<n;o++)i[o]=arguments[o];return(t=this.console.error).bind.apply(t,[this.console].concat(i))}}]),e}();var xo={fetch:null,mimeType:void 0,nothrow:!1,log:new eu,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:Vt,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},tu={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function su(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=zg(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function zg(e,r){if(e){if(typeof e=="string")return ru(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ru(e,r)}}function ru(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function nu(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function vn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?nu(Object(t),!0).forEach(function(n){(0,au.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):nu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Po(){globalThis.loaders=globalThis.loaders||{};var e=globalThis.loaders;return e._state=e._state||{},e._state}var lu=function(){var r=Po();return r.globalOptions=r.globalOptions||vn({},xo),r.globalOptions};function uu(e,r,t,n){return t=t||[],t=Array.isArray(t)?t:[t],Fg(e,t),jg(r,e,n)}function dn(e,r){var t=lu(),n=e||t;return typeof n.fetch=="function"?n.fetch:dt(n.fetch)?function(i){return vo(i,n)}:r!=null&&r.fetch?r?.fetch:vo}function Fg(e,r){iu(e,null,xo,tu,r);var t=su(r),n;try{for(t.s();!(n=t.n()).done;){var i=n.value,o=e&&e[i.id]||{},a=i.options&&i.options[i.id]||{},s=i.deprecatedOptions&&i.deprecatedOptions[i.id]||{};iu(o,i.id,a,s,r)}}catch(l){t.e(l)}finally{t.f()}}function iu(e,r,t,n,i){var o=r||"Top level",a=r?"".concat(r,"."):"";for(var s in e){var l=!r&&dt(e[s]),u=s==="baseUri"&&!r,f=s==="workerUrl"&&r;if(!(s in t)&&!u&&!f){if(s in n)yo.warn("".concat(o," loader option '").concat(a).concat(s,"' no longer supported, use '").concat(n[s],"'"))();else if(!l){var c=Dg(s,i);yo.warn("".concat(o," loader option '").concat(a).concat(s,"' not recognized. ").concat(c))()}}}}function Dg(e,r){var t=e.toLowerCase(),n="",i=su(r),o;try{for(i.s();!(o=i.n()).done;){var a=o.value;for(var s in a.options){if(e===s)return"Did you mean '".concat(a.id,".").concat(s,"'?");var l=s.toLowerCase(),u=t.startsWith(l)||l.startsWith(t);u&&(n=n||"Did you mean '".concat(a.id,".").concat(s,"'?"))}}}catch(f){i.e(f)}finally{i.f()}return n}function jg(e,r,t){var n=e.options||{},i=vn({},n);return Ng(i,t),i.log===null&&(i.log=new Ql),ou(i,lu()),ou(i,r),i}function ou(e,r){for(var t in r)if(t in r){var n=r[t];io(n)&&io(e[t])?e[t]=vn(vn({},e[t]),r[t]):e[t]=r[t]}}function Ng(e,r){r&&!("baseUri"in e)&&(e.baseUri=r)}var cu=v(N());function fu(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function gn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?fu(Object(t),!0).forEach(function(n){(0,cu.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):fu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Qt(e){var r;if(!e)return!1;Array.isArray(e)&&(e=e[0]);var t=Array.isArray((r=e)===null||r===void 0?void 0:r.extensions);return t}function bo(e){var r,t;en(e,"null loader"),en(Qt(e),"invalid loader");var n;return Array.isArray(e)&&(n=e[1],e=e[0],e=gn(gn({},e),{},{options:gn(gn({},e.options),n)})),((r=e)!==null&&r!==void 0&&r.parseTextSync||(t=e)!==null&&t!==void 0&&t.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}var Wg=function(){var r=Po();return r.loaderRegistry=r.loaderRegistry||[],r.loaderRegistry};function pu(){return Wg()}var xu=v(N()),Pu=v(se()),bu=v(sn()),wu=v(Se()),_o=v(oe());var vu=new Ne({id:"loaders.gl"});function du(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function gu(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?du(Object(t),!0).forEach(function(n){(0,xu.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):du(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function er(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Bg(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Bg(e,r){if(e){if(typeof e=="string")return hu(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hu(e,r)}}function hu(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Ug=/\.([^.]+)$/;function _u(e){return So.apply(this,arguments)}function So(){return So=(0,wu.default)(_o.default.mark(function e(r){var t,n,i,o,a=arguments;return _o.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(t=a.length>1&&a[1]!==void 0?a[1]:[],n=a.length>2?a[2]:void 0,i=a.length>3?a[3]:void 0,Su(r)){l.next=5;break}return l.abrupt("return",null);case 5:if(o=mu(r,t,gu(gu({},n),{},{nothrow:!0}),i),!o){l.next=8;break}return l.abrupt("return",o);case 8:if(!ye(r)){l.next=13;break}return l.next=11,r.slice(0,10).arrayBuffer();case 11:r=l.sent,o=mu(r,t,n,i);case 13:if(!(!o&&!(n!=null&&n.nothrow))){l.next=15;break}throw new Error(Ou(r));case 15:return l.abrupt("return",o);case 16:case"end":return l.stop()}},e)})),So.apply(this,arguments)}function mu(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[],t=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0;if(!Su(e))return null;if(r&&!Array.isArray(r))return bo(r);var i=[];if(r&&(i=i.concat(r)),!(t!=null&&t.ignoreRegisteredLoaders)){var o;(o=i).push.apply(o,(0,bu.default)(pu()))}Vg(i);var a=Gg(e,i,t,n);if(!a&&!(t!=null&&t.nothrow))throw new Error(Ou(e));return a}function Gg(e,r,t,n){var i=Xe(e),o=i.url,a=i.type,s=o||n?.url,l=null,u="";if(t!=null&&t.mimeType&&(l=wo(r,t?.mimeType),u="match forced by supplied MIME type ".concat(t?.mimeType)),l=l||Hg(r,s),u=u||(l?"matched url ".concat(s):""),l=l||wo(r,a),u=u||(l?"matched MIME type ".concat(a):""),l=l||Zg(r,e),u=u||(l?"matched initial data ".concat(Cu(e)):""),l=l||wo(r,t?.fallbackMimeType),u=u||(l?"matched fallback MIME type ".concat(a):""),u){var f;vu.log(1,"selectLoader selected ".concat((f=l)===null||f===void 0?void 0:f.name,": ").concat(u,"."))}return l}function Su(e){return!(e instanceof Response&&e.status===204)}function Ou(e){var r=Xe(e),t=r.url,n=r.type,i="No valid loader found (";i+=t?"".concat(nn.filename(t),", "):"no url provided, ",i+="MIME type: ".concat(n?'"'.concat(n,'"'):"not provided",", ");var o=e?Cu(e):"";return i+=o?' first bytes: "'.concat(o,'"'):"first bytes: not available",i+=")",i}function Vg(e){var r=er(e),t;try{for(r.s();!(t=r.n()).done;){var n=t.value;bo(n)}}catch(i){r.e(i)}finally{r.f()}}function Hg(e,r){var t=r&&Ug.exec(r),n=t&&t[1];return n?$g(e,n):null}function $g(e,r){r=r.toLowerCase();var t=er(e),n;try{for(t.s();!(n=t.n()).done;){var i=n.value,o=er(i.extensions),a;try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.toLowerCase()===r)return i}}catch(l){o.e(l)}finally{o.f()}}}catch(l){t.e(l)}finally{t.f()}return null}function wo(e,r){var t=er(e),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;if(i.mimeTypes&&i.mimeTypes.includes(r)||r==="application/x.".concat(i.id))return i}}catch(o){t.e(o)}finally{t.f()}return null}function Zg(e,r){if(!r)return null;var t=er(e),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;if(typeof r=="string"){if(Yg(r,i))return i}else if(ArrayBuffer.isView(r)){if(yu(r.buffer,r.byteOffset,i))return i}else if(r instanceof ArrayBuffer){var o=0;if(yu(r,o,i))return i}}}catch(a){t.e(a)}finally{t.f()}return null}function Yg(e,r){if(r.testText)return r.testText(e);var t=Array.isArray(r.tests)?r.tests:[r.tests];return t.some(function(n){return e.startsWith(n)})}function yu(e,r,t){var n=Array.isArray(t.tests)?t.tests:[t.tests];return n.some(function(i){return Kg(e,r,t,i)})}function Kg(e,r,t,n){if(n instanceof ArrayBuffer)return $i(n,e,n.byteLength);switch((0,Pu.default)(n)){case"function":return n(e,t);case"string":var i=Oo(e,r,n.length);return n===i;default:return!1}}function Cu(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5;if(typeof e=="string")return e.slice(0,r);if(ArrayBuffer.isView(e))return Oo(e.buffer,e.byteOffset,r);if(e instanceof ArrayBuffer){var t=0;return Oo(e,t,r)}return""}function Oo(e,r,t){if(e.byteLength<r+t)return"";for(var n=new DataView(e),i="",o=0;o<t;o++)i+=String.fromCharCode(n.getUint8(r+o));return i}var Nu=v(se()),Bo=v(Se()),rr=v(oe());var Eu=v(Se()),Fo=v(oe());var Co=v(oe()),Jg=Co.default.mark(Mo),qg=256*1024;function Mo(e,r){var t,n,i,o,a;return Co.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:t=r?.chunkSize||qg,n=0,i=new TextEncoder;case 3:if(!(n<e.length)){l.next=11;break}return o=Math.min(e.length-n,t),a=e.slice(n,n+o),n+=o,l.next=9,i.encode(a);case 9:l.next=3;break;case 11:case"end":return l.stop()}},Jg)}var Lo=v(oe()),Xg=Lo.default.mark(Ao),Qg=256*1024;function Ao(e){var r,t,n,i,o,a,s,l,u=arguments;return Lo.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:r=u.length>1&&u[1]!==void 0?u[1]:{},t=r.chunkSize,n=t===void 0?Qg:t,i=0;case 3:if(!(i<e.byteLength)){c.next=14;break}return o=Math.min(e.byteLength-i,n),a=new ArrayBuffer(o),s=new Uint8Array(e,i,o),l=new Uint8Array(a),l.set(s),i+=o,c.next=12,a;case 12:c.next=3;break;case 14:case"end":return c.stop()}},Xg)}var Mu=v(Ki()),Lu=v(Ji()),To=v(oe()),eh=1024*1024;function Au(e,r){return Io.apply(this,arguments)}function Io(){return Io=(0,Lu.default)(To.default.mark(function e(r,t){var n,i,o,a;return To.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:n=t?.chunkSize||eh,i=0;case 2:if(!(i<r.size)){l.next=12;break}return o=i+n,l.next=6,(0,Mu.default)(r.slice(i,o).arrayBuffer());case 6:return a=l.sent,i=o,l.next=10,a;case 10:l.next=2;break;case 12:case"end":return l.stop()}},e)})),Io.apply(this,arguments)}var Tu=v(Ni()),hn=v(Ki()),Ro=v(Ji()),tr=v(oe());function zo(e,r){return Vt?th(e,r):rh(e,r)}function th(e,r){return Eo.apply(this,arguments)}function Eo(){return Eo=(0,Ro.default)(tr.default.mark(function e(r,t){var n,i,o,a,s,l;return tr.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=r.getReader(),f.prev=1;case 2:return o=i||n.read(),t!=null&&t._streamReadAhead&&(i=n.read()),f.next=7,(0,hn.default)(o);case 7:if(a=f.sent,s=a.done,l=a.value,!s){f.next=12;break}return f.abrupt("return");case 12:return f.next=14,rn(l);case 14:f.next=2;break;case 16:f.next=21;break;case 18:f.prev=18,f.t0=f.catch(1),n.releaseLock();case 21:case"end":return f.stop()}},e,null,[[1,18]])})),Eo.apply(this,arguments)}function rh(e,r){return ko.apply(this,arguments)}function ko(){return ko=(0,Ro.default)(tr.default.mark(function e(r,t){var n,i,o,a,s,l;return tr.default.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:n=!1,i=!1,f.prev=2,a=(0,Tu.default)(r);case 4:return f.next=6,(0,hn.default)(a.next());case 6:if(!(n=!(s=f.sent).done)){f.next=13;break}return l=s.value,f.next=10,rn(l);case 10:n=!1,f.next=4;break;case 13:f.next=19;break;case 15:f.prev=15,f.t0=f.catch(2),i=!0,o=f.t0;case 19:if(f.prev=19,f.prev=20,!(n&&a.return!=null)){f.next=24;break}return f.next=24,(0,hn.default)(a.return());case 24:if(f.prev=24,!i){f.next=27;break}throw o;case 27:return f.finish(24);case 28:return f.finish(19);case 29:case"end":return f.stop()}},e,null,[[2,15,19,29],[20,,24,28]])})),ko.apply(this,arguments)}function Iu(e,r){if(typeof e=="string")return Mo(e,r);if(e instanceof ArrayBuffer)return Ao(e,r);if(ye(e))return Au(e,r);if(on(e))return zo(e,r);if(me(e)){var t=e;return zo(t.body,r)}throw new Error("makeIterator")}var ku="Cannot convert supplied data type";function nh(e,r,t){if(r.text&&typeof e=="string")return e;if(_l(e)&&(e=e.buffer),e instanceof ArrayBuffer){var n=e;if(r.text&&!r.binary){var i=new TextDecoder("utf8");return i.decode(n)}return n}if(ArrayBuffer.isView(e)){if(r.text&&!r.binary){var o=new TextDecoder("utf8");return o.decode(e)}var a=e.buffer,s=e.byteLength||e.length;return(e.byteOffset!==0||s!==a.byteLength)&&(a=a.slice(e.byteOffset,e.byteOffset+s)),a}throw new Error(ku)}function Ru(e,r,t){return Do.apply(this,arguments)}function Do(){return Do=(0,Eu.default)(Fo.default.mark(function e(r,t,n){var i,o;return Fo.default.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(i=r instanceof ArrayBuffer||ArrayBuffer.isView(r),!(typeof r=="string"||i)){s.next=3;break}return s.abrupt("return",nh(r,t,n));case 3:if(!ye(r)){s.next=7;break}return s.next=6,an(r);case 6:r=s.sent;case 7:if(!me(r)){s.next=21;break}return o=r,s.next=11,Cl(o);case 11:if(!t.binary){s.next=17;break}return s.next=14,o.arrayBuffer();case 14:s.t0=s.sent,s.next=20;break;case 17:return s.next=19,o.text();case 19:s.t0=s.sent;case 20:return s.abrupt("return",s.t0);case 21:if(on(r)&&(r=Iu(r,n)),!(bl(r)||wl(r))){s.next=24;break}return s.abrupt("return",Qi(r));case 24:throw new Error(ku);case 25:case"end":return s.stop()}},e)})),Do.apply(this,arguments)}var jo=v(sn()),Fu=v(N());function zu(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function ih(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?zu(Object(t),!0).forEach(function(n){(0,Fu.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Du(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:null;if(t)return t;var n=ih({fetch:dn(r,e)},e);return Array.isArray(n.loaders)||(n.loaders=null),n}function ju(e,r){if(!r&&e&&!Array.isArray(e))return e;var t;if(e&&(t=Array.isArray(e)?e:[e]),r&&r.loaders){var n=Array.isArray(r.loaders)?r.loaders:[r.loaders];t=t?[].concat((0,jo.default)(t),(0,jo.default)(n)):n}return t&&t.length?t:null}function mn(e,r,t,n){return No.apply(this,arguments)}function No(){return No=(0,Bo.default)(rr.default.mark(function e(r,t,n,i){var o,a,s,l,u;return rr.default.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return ee(!i||(0,Nu.default)(i)==="object"),t&&!Array.isArray(t)&&!Qt(t)&&(i=void 0,n=t,t=void 0),c.next=4,r;case 4:return r=c.sent,n=n||{},o=Xe(r),a=o.url,s=t,l=ju(s,i),c.next=11,_u(r,l,n);case 11:if(u=c.sent,u){c.next=14;break}return c.abrupt("return",null);case 14:return n=uu(n,u,l,a),i=Du({url:a,parse:mn,loaders:l},n,i),c.next=18,oh(u,r,n,i);case 18:return c.abrupt("return",c.sent);case 19:case"end":return c.stop()}},e)})),No.apply(this,arguments)}function oh(e,r,t,n){return Wo.apply(this,arguments)}function Wo(){return Wo=(0,Bo.default)(rr.default.mark(function e(r,t,n,i){var o,a,s,l,u,f,c,p;return rr.default.wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return Wi(r),me(t)&&(o=t,a=o.ok,s=o.redirected,l=o.status,u=o.statusText,f=o.type,c=o.url,p=Object.fromEntries(o.headers.entries()),i.response={headers:p,ok:a,redirected:s,status:l,statusText:u,type:f,url:c}),g.next=4,Ru(t,r,n);case 4:if(t=g.sent,!(r.parseTextSync&&typeof t=="string")){g.next=8;break}return n.dataType="text",g.abrupt("return",r.parseTextSync(t,n,i,r));case 8:if(!Vi(r,n)){g.next=12;break}return g.next=11,Hi(r,t,n,i,mn);case 11:return g.abrupt("return",g.sent);case 12:if(!(r.parseText&&typeof t=="string")){g.next=16;break}return g.next=15,r.parseText(t,n,i,r);case 15:return g.abrupt("return",g.sent);case 16:if(!r.parse){g.next=20;break}return g.next=19,r.parse(t,n,i,r);case 19:return g.abrupt("return",g.sent);case 20:throw ee(!r.parseSync),new Error("".concat(r.id," loader - no parser found and worker is disabled"));case 22:case"end":return g.stop()}},e)})),Wo.apply(this,arguments)}var Wu=v(Se()),Uo=v(oe());function Vo(e,r,t,n){return Go.apply(this,arguments)}function Go(){return Go=(0,Wu.default)(Uo.default.mark(function e(r,t,n,i){var o,a;return Uo.default.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!Array.isArray(t)&&!Qt(t)&&(i=void 0,n=t,t=void 0),o=dn(n),a=r,typeof r!="string"){l.next=7;break}return l.next=6,o(r);case 6:a=l.sent;case 7:if(!ye(r)){l.next=11;break}return l.next=10,o(r);case 10:a=l.sent;case 11:return l.next=13,mn(a,t,n);case 13:return l.abrupt("return",l.sent);case 14:case"end":return l.stop()}},e)})),Go.apply(this,arguments)}var Ku=v(H()),yt;function Yu(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ah(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function ah(e,r){if(e){if(typeof e=="string")return Bu(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Bu(e,r)}}function Bu(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Uu(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function yn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Uu(Object(t),!0).forEach(function(n){(0,$.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Uu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var sh=1024,lh=4,Gu=function(){},Vu=(yt={},(0,$.default)(yt,10241,9987),(0,$.default)(yt,10240,9729),(0,$.default)(yt,10242,33071),(0,$.default)(yt,10243,33071),yt);function uh(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function fh(e,r,t,n){var i=Math.min(t/r.width,n/r.height),o=Math.floor(r.width*i),a=Math.floor(r.height*i);return i===1?{data:r,width:o,height:a}:(e.canvas.height=a,e.canvas.width=o,e.clearRect(0,0,o,a),e.drawImage(r,0,0,r.width,r.height,0,0,o,a),{data:e.canvas,width:o,height:a})}function nr(e){return e&&(e.id||e.url)}function ch(e,r,t,n){var i=e.width,o=e.height,a=new ir.Texture2D(e.gl,{width:r,height:t,parameters:n});return(0,ir.copyToTexture)(e,a,{targetY:0,width:i,height:o}),e.delete(),a}function Hu(e,r,t){for(var n=0;n<r.length;n++){var i=r[n],o=i.icon,a=i.xOffset,s=nr(o);e[s]=yn(yn({},o),{},{x:a,y:t})}}function ph(e){for(var r=e.icons,t=e.buffer,n=e.mapping,i=n===void 0?{}:n,o=e.xOffset,a=o===void 0?0:o,s=e.yOffset,l=s===void 0?0:s,u=e.rowHeight,f=u===void 0?0:u,c=e.canvasWidth,p=[],d=0;d<r.length;d++){var g=r[d],m=nr(g);if(!i[m]){var y=g.height,x=g.width;a+x+t>c&&(Hu(i,p,l),a=0,l=f+l+t,f=0,p=[]),p.push({icon:g,xOffset:a}),a=a+x+t,f=Math.max(f,y)}}return p.length>0&&Hu(i,p,l),{mapping:i,rowHeight:f,xOffset:a,yOffset:l,canvasWidth:c,canvasHeight:uh(f+l+t)}}function vh(e,r,t){if(!e||!r)return null;t=t||{};var n={},i=(0,Ku.createIterable)(e),o=i.iterable,a=i.objectInfo,s=Yu(o),l;try{for(s.s();!(l=s.n()).done;){var u=l.value;a.index++;var f=r(u,a),c=nr(f);if(!f)throw new Error("Icon is missing.");if(!f.url)throw new Error("Icon url is missing.");!n[c]&&(!t[c]||f.url!==t[c].url)&&(n[c]=yn(yn({},f),{},{source:u,sourceIndex:a.index}))}}catch(p){s.e(p)}finally{s.f()}return n}var Ju=function(){function e(r,t){var n=t.onUpdate,i=n===void 0?Gu:n,o=t.onError,a=o===void 0?Gu:o;(0,$u.default)(this,e),(0,$.default)(this,"gl",void 0),(0,$.default)(this,"onUpdate",void 0),(0,$.default)(this,"onError",void 0),(0,$.default)(this,"_loadOptions",null),(0,$.default)(this,"_texture",null),(0,$.default)(this,"_externalTexture",null),(0,$.default)(this,"_mapping",{}),(0,$.default)(this,"_textureParameters",null),(0,$.default)(this,"_pendingCount",0),(0,$.default)(this,"_autoPacking",!1),(0,$.default)(this,"_xOffset",0),(0,$.default)(this,"_yOffset",0),(0,$.default)(this,"_rowHeight",0),(0,$.default)(this,"_buffer",lh),(0,$.default)(this,"_canvasWidth",sh),(0,$.default)(this,"_canvasHeight",0),(0,$.default)(this,"_canvas",null),this.gl=r,this.onUpdate=i,this.onError=a}return(0,Zu.default)(e,[{key:"finalize",value:function(){var t;(t=this._texture)===null||t===void 0||t.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(t){var n=this._autoPacking?nr(t):t;return this._mapping[n]||{}}},{key:"setProps",value:function(t){var n=t.loadOptions,i=t.autoPacking,o=t.iconAtlas,a=t.iconMapping,s=t.textureParameters;if(n&&(this._loadOptions=n),i!==void 0&&(this._autoPacking=i),a&&(this._mapping=a),o){var l;(l=this._texture)===null||l===void 0||l.delete(),this._texture=null,this._externalTexture=o}s&&(this._textureParameters=s)}},{key:"isLoaded",get:function(){return this._pendingCount===0}},{key:"packIcons",value:function(t,n){if(!(!this._autoPacking||typeof document>"u")){var i=Object.values(vh(t,n,this._mapping)||{});if(i.length>0){var o=ph({icons:i,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),a=o.mapping,s=o.xOffset,l=o.yOffset,u=o.rowHeight,f=o.canvasHeight;this._rowHeight=u,this._mapping=a,this._xOffset=s,this._yOffset=l,this._canvasHeight=f,this._texture||(this._texture=new ir.Texture2D(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:this._textureParameters||Vu})),this._texture.height!==this._canvasHeight&&(this._texture=ch(this._texture,this._canvasWidth,this._canvasHeight,this._textureParameters||Vu)),this.onUpdate(),this._canvas=this._canvas||document.createElement("canvas"),this._loadIcons(i)}}}},{key:"_loadIcons",value:function(t){var n=this,i=this._canvas.getContext("2d",{willReadFrequently:!0}),o=Yu(t),a;try{var s=function(){var u=a.value;n._pendingCount++,Vo(u.url,n._loadOptions).then(function(f){var c=nr(u),p=n._mapping[c],d=p.x,g=p.y,m=p.width,y=p.height,x=fh(i,f,m,y),_=x.data,h=x.width,P=x.height;n._texture.setSubImageData({data:_,x:d+(m-h)/2,y:g+(y-P)/2,width:h,height:P}),p.width=h,p.height=P,n._texture.generateMipmap(),n.onUpdate()}).catch(function(f){n.onError({url:u.url,source:u.source,sourceIndex:u.sourceIndex,loadOptions:n._loadOptions,error:f})}).finally(function(){n._pendingCount--})};for(o.s();!(a=o.n()).done;)s()}catch(l){o.e(l)}finally{o.f()}}}]),e}();function qu(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Xu(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?qu(Object(t),!0).forEach(function(n){(0,ar.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):qu(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function dh(e){var r=gh();return function(){var n=(0,tt.default)(e),i;if(r){var o=(0,tt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,nf.default)(this,i)}}function gh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var of=[0,0,0,255],hh={iconAtlas:{type:"image",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(r){return r.position}},getIcon:{type:"accessor",value:function(r){return r.icon}},getColor:{type:"accessor",value:of},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},onIconError:{type:"function",value:null,optional:!0},textureParameters:{type:"object",ignore:!0}},We=function(e){(0,rf.default)(t,e);var r=dh(t);function t(){var n;(0,Qu.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,ar.default)((0,tf.default)(n),"state",void 0),n}return(0,ef.default)(t,[{key:"getShaders",value:function(){return(0,or.default)((0,tt.default)(t.prototype),"getShaders",this).call(this,{vs:Ms,fs:Ls,modules:[Me.project32,Me.picking]})}},{key:"initializeState",value:function(){this.state={iconManager:new Ju(this.context.gl,{onUpdate:this._onUpdate.bind(this),onError:this._onError.bind(this)})};var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:of},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(i){(0,or.default)((0,tt.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager(),u=o.iconAtlas,f=o.iconMapping,c=o.data,p=o.getIcon,d=o.textureParameters,g=this.state.iconManager,m=u||this.internalState.isAsyncPropLoading("iconAtlas");if(g.setProps({loadOptions:o.loadOptions,autoPacking:!m,iconAtlas:u,iconMapping:m?f:null,textureParameters:d}),m?a.iconMapping!==o.iconMapping&&l.invalidate("getIcon"):(s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getIcon))&&g.packIcons(c,p),s.extensionsChanged){var y,x=this.context.gl;(y=this.state.model)===null||y===void 0||y.delete(),this.state.model=this._getModel(x),l.invalidateAll()}}},{key:"isLoaded",get:function(){return(0,or.default)((0,tt.default)(t.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}},{key:"finalizeState",value:function(i){(0,or.default)((0,tt.default)(t.prototype),"finalizeState",this).call(this,i),this.state.iconManager.finalize()}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.sizeScale,l=a.sizeMinPixels,u=a.sizeMaxPixels,f=a.sizeUnits,c=a.billboard,p=a.alphaCutoff,d=this.state.iconManager,g=d.getTexture();g&&this.state.model.setUniforms(o).setUniforms({iconsTexture:g,iconsTextureDim:[g.width,g.height],sizeUnits:Me.UNIT[f],sizeScale:s,sizeMinPixels:l,sizeMaxPixels:u,billboard:c,alphaCutoff:p}).draw()}},{key:"_getModel",value:function(i){var o=[-1,-1,-1,1,1,1,1,-1];return new xn.Model(i,Xu(Xu({},this.getShaders()),{},{id:this.props.id,geometry:new xn.Geometry({drawMode:6,attributes:{positions:{size:2,value:new Float32Array(o)}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"_onError",value:function(i){var o,a=(o=this.getCurrentLayer())===null||o===void 0?void 0:o.props.onIconError;a?a(i):Me.log.error(i.error.message)()}},{key:"getInstanceOffset",value:function(i){var o=this.state.iconManager.getIconMapping(i),a=o.width,s=o.height,l=o.anchorX,u=l===void 0?a/2:l,f=o.anchorY,c=f===void 0?s/2:f;return[a/2-u,s/2-c]}},{key:"getInstanceColorMode",value:function(i){var o=this.state.iconManager.getIconMapping(i);return o.mask?1:0}},{key:"getInstanceIconFrame",value:function(i){var o=this.state.iconManager.getIconMapping(i),a=o.x,s=o.y,l=o.width,u=o.height;return[a,s,l,u]}}]),t}(Me.Layer);(0,ar.default)(We,"defaultProps",hh);(0,ar.default)(We,"layerName","IconLayer");var ff=v(j()),cf=v(B()),Ho=v(ne()),pf=v(J()),vf=v(q()),sr=v(Y()),Pn=v(N()),Be=v(H()),bn=v(ie());var af=`#define SHADER_NAME line-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceSourcePositions;
attribute vec3 instanceTargetPositions;
attribute vec3 instanceSourcePositions64Low;
attribute vec3 instanceTargetPositions64Low;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;
attribute float instanceWidths;

uniform float opacity;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float useShortestPath;
uniform int widthUnits;

varying vec4 vColor;
varying vec2 uv;
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {
  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  return dir_screenspace * offset_direction * width / 2.0;
}

vec3 splitLine(vec3 a, vec3 b, float x) {
  float t = (x - a.x) / (b.x - a.x);
  return vec3(x, mix(a.yz, b.yz, t));
}

void main(void) {
  geometry.worldPosition = instanceSourcePositions;
  geometry.worldPositionAlt = instanceTargetPositions;

  vec3 source_world = instanceSourcePositions;
  vec3 target_world = instanceTargetPositions;
  vec3 source_world_64low = instanceSourcePositions64Low;
  vec3 target_world_64low = instanceTargetPositions64Low;

  if (useShortestPath > 0.5 || useShortestPath < -0.5) {
    source_world.x = mod(source_world.x + 180., 360.0) - 180.;
    target_world.x = mod(target_world.x + 180., 360.0) - 180.;
    float deltaLng = target_world.x - source_world.x;

    if (deltaLng * useShortestPath > 180.) {
      source_world.x += 360. * useShortestPath;
      source_world = splitLine(source_world, target_world, 180. * useShortestPath);
      source_world_64low = vec3(0.0);
    } else if (deltaLng * useShortestPath < -180.) {
      target_world.x += 360. * useShortestPath;
      target_world = splitLine(source_world, target_world, 180. * useShortestPath);
      target_world_64low = vec3(0.0);
    } else if (useShortestPath < 0.) {
      gl_Position = vec4(0.);
      return;
    }
  }
  vec4 source_commonspace;
  vec4 target_commonspace;
  vec4 source = project_position_to_clipspace(source_world, source_world_64low, vec3(0.), source_commonspace);
  vec4 target = project_position_to_clipspace(target_world, target_world_64low, vec3(0.), target_commonspace);
  float segmentIndex = positions.x;
  vec4 p = mix(source, target, segmentIndex);
  geometry.position = mix(source_commonspace, target_commonspace, segmentIndex);
  uv = positions.xy;
  geometry.uv = uv;
  geometry.pickingColor = instancePickingColors;
  float widthPixels = clamp(
    project_size_to_pixel(instanceWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels
  );
  vec3 offset = vec3(
    getExtrusionOffset(target.xy - source.xy, positions.y, widthPixels),
    0.0);
  DECKGL_FILTER_SIZE(offset, geometry);
  DECKGL_FILTER_GL_POSITION(p, geometry);
  gl_Position = p + vec4(project_pixel_size_to_clipspace(offset.xy), 0.0, 0.0);
  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var sf=`#define SHADER_NAME line-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function lf(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function uf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?lf(Object(t),!0).forEach(function(n){(0,Pn.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):lf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mh(e){var r=yh();return function(){var n=(0,sr.default)(e),i;if(r){var o=(0,sr.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,vf.default)(this,i)}}function yh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var xh=[0,0,0,255],Ph={getSourcePosition:{type:"accessor",value:function(r){return r.sourcePosition}},getTargetPosition:{type:"accessor",value:function(r){return r.targetPosition}},getColor:{type:"accessor",value:xh},getWidth:{type:"accessor",value:1},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0}},wn=function(e){(0,pf.default)(t,e);var r=mh(t);function t(){return(0,ff.default)(this,t),r.apply(this,arguments)}return(0,cf.default)(t,[{key:"getBounds",value:function(){var i;return(i=this.getAttributeManager())===null||i===void 0?void 0:i.getBounds(["instanceSourcePositions","instanceTargetPositions"])}},{key:"getShaders",value:function(){return(0,Ho.default)((0,sr.default)(t.prototype),"getShaders",this).call(this,{vs:af,fs:sf,modules:[Be.project32,Be.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instanceSourcePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getSourcePosition"},instanceTargetPositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getTargetPosition"},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:[0,0,0,255]},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,Ho.default)((0,sr.default)(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.widthUnits,l=a.widthScale,u=a.widthMinPixels,f=a.widthMaxPixels,c=a.wrapLongitude;this.state.model.setUniforms(o).setUniforms({widthUnits:Be.UNIT[s],widthScale:l,widthMinPixels:u,widthMaxPixels:f,useShortestPath:c?1:0}).draw(),c&&this.state.model.setUniforms({useShortestPath:-1}).draw()}},{key:"_getModel",value:function(i){var o=[0,-1,0,0,1,0,1,-1,0,1,1,0];return new bn.Model(i,uf(uf({},this.getShaders()),{},{id:this.props.id,geometry:new bn.Geometry({drawMode:5,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}))}}]),t}(Be.Layer);(0,Pn.default)(wn,"layerName","LineLayer");(0,Pn.default)(wn,"defaultProps",Ph);var yf=v(j()),xf=v(B()),$o=v(ne()),Pf=v(J()),bf=v(q()),lr=v(Y()),_n=v(N()),Le=v(H()),Sn=v(ie());var df=`#define SHADER_NAME point-cloud-layer-vertex-shader

attribute vec3 positions;
attribute vec3 instanceNormals;
attribute vec4 instanceColors;
attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusPixels;
uniform int sizeUnits;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.normal = project_normal(instanceNormals);
  unitPosition = positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;
  vec3 offset = vec3(positions.xy * project_size_to_pixel(radiusPixels, sizeUnits), 0.0);
  DECKGL_FILTER_SIZE(offset, geometry);

  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
  vColor = vec4(lightColor, instanceColors.a * opacity);
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var gf=`#define SHADER_NAME point-cloud-layer-fragment-shader

precision highp float;

varying vec4 vColor;
varying vec2 unitPosition;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition);

  if (distToCenter > 1.0) {
    discard;
  }

  gl_FragColor = vColor;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function hf(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function mf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?hf(Object(t),!0).forEach(function(n){(0,_n.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):hf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function bh(e){var r=wh();return function(){var n=(0,lr.default)(e),i;if(r){var o=(0,lr.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,bf.default)(this,i)}}function wh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var wf=[0,0,0,255],_f=[0,0,1],_h={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:function(r){return r.position}},getNormal:{type:"accessor",value:_f},getColor:{type:"accessor",value:wf},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};function Sh(e){var r=e.header,t=e.attributes;!r||!t||(e.length=r.vertexCount,t.POSITION&&(t.instancePositions=t.POSITION),t.NORMAL&&(t.instanceNormals=t.NORMAL),t.COLOR_0&&(t.instanceColors=t.COLOR_0))}var On=function(e){(0,Pf.default)(t,e);var r=bh(t);function t(){return(0,yf.default)(this,t),r.apply(this,arguments)}return(0,xf.default)(t,[{key:"getShaders",value:function(){return(0,$o.default)((0,lr.default)(t.prototype),"getShaders",this).call(this,{vs:df,fs:gf,modules:[Le.project32,Le.gouraudLighting,Le.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:_f},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:wf}})}},{key:"updateState",value:function(i){var o=i.changeFlags,a=i.props;if((0,$o.default)((0,lr.default)(t.prototype),"updateState",this).call(this,i),o.extensionsChanged){var s,l=this.context.gl;(s=this.state.model)===null||s===void 0||s.delete(),this.state.model=this._getModel(l),this.getAttributeManager().invalidateAll()}o.dataChanged&&Sh(a.data)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.pointSize,l=a.sizeUnits;this.state.model.setUniforms(o).setUniforms({sizeUnits:Le.UNIT[l],radiusPixels:s}).draw()}},{key:"_getModel",value:function(i){for(var o=[],a=0;a<3;a++){var s=a/3*Math.PI*2;o.push(Math.cos(s)*2,Math.sin(s)*2,0)}return new Sn.Model(i,mf(mf({},this.getShaders()),{},{id:this.props.id,geometry:new Sn.Geometry({drawMode:4,attributes:{positions:new Float32Array(o)}}),isInstanced:!0}))}}]),t}(Le.Layer);(0,_n.default)(On,"layerName","PointCloudLayer");(0,_n.default)(On,"defaultProps",_h);var Af=v(j()),Tf=v(B()),Zo=v(ne()),If=v(J()),Ef=v(q()),ur=v(Y()),Cn=v(N()),Ee=v(H()),Mn=v(ie());var Sf=`#define SHADER_NAME scatterplot-layer-vertex-shader

attribute vec3 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute float instanceRadius;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform float opacity;
uniform float radiusScale;
uniform float radiusMinPixels;
uniform float radiusMaxPixels;
uniform float lineWidthScale;
uniform float lineWidthMinPixels;
uniform float lineWidthMaxPixels;
uniform float stroked;
uniform bool filled;
uniform bool antialiasing;
uniform bool billboard;
uniform int radiusUnits;
uniform int lineWidthUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;


void main(void) {
  geometry.worldPosition = instancePositions;
  outerRadiusPixels = clamp(
    project_size_to_pixel(radiusScale * instanceRadius, radiusUnits),
    radiusMinPixels, radiusMaxPixels
  );
  float lineWidthPixels = clamp(
    project_size_to_pixel(lineWidthScale * instanceLineWidths, lineWidthUnits),
    lineWidthMinPixels, lineWidthMaxPixels
  );
  outerRadiusPixels += stroked * lineWidthPixels / 2.0;
  float edgePadding = antialiasing ? (outerRadiusPixels + SMOOTH_EDGE_RADIUS) / outerRadiusPixels : 1.0;
  unitPosition = edgePadding * positions.xy;
  geometry.uv = unitPosition;
  geometry.pickingColor = instancePickingColors;

  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;
  
  if (billboard) {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = edgePadding * positions * outerRadiusPixels;
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset = edgePadding * positions * project_pixel_size(outerRadiusPixels);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var Of=`#define SHADER_NAME scatterplot-layer-fragment-shader

precision highp float;

uniform bool filled;
uniform float stroked;
uniform bool antialiasing;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying vec2 unitPosition;
varying float innerUnitRadius;
varying float outerRadiusPixels;

void main(void) {
  geometry.uv = unitPosition;

  float distToCenter = length(unitPosition) * outerRadiusPixels;
  float inCircle = antialiasing ? 
    smoothedge(distToCenter, outerRadiusPixels) : 
    step(distToCenter, outerRadiusPixels);

  if (inCircle == 0.0) {
    discard;
  }

  if (stroked > 0.5) {
    float isLine = antialiasing ? 
      smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter) :
      step(innerUnitRadius * outerRadiusPixels, distToCenter);

    if (filled) {
      gl_FragColor = mix(vFillColor, vLineColor, isLine);
    } else {
      if (isLine == 0.0) {
        discard;
      }
      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);
    }
  } else if (filled) {
    gl_FragColor = vFillColor;
  } else {
    discard;
  }

  gl_FragColor.a *= inCircle;
  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Cf(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Mf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Cf(Object(t),!0).forEach(function(n){(0,Cn.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Cf(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Oh(e){var r=Ch();return function(){var n=(0,ur.default)(e),i;if(r){var o=(0,ur.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Ef.default)(this,i)}}function Ch(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Lf=[0,0,0,255],Mh={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,antialiasing:!0,getPosition:{type:"accessor",value:function(r){return r.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:Lf},getLineColor:{type:"accessor",value:Lf},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},xt=function(e){(0,If.default)(t,e);var r=Oh(t);function t(){return(0,Af.default)(this,t),r.apply(this,arguments)}return(0,Tf.default)(t,[{key:"getShaders",value:function(){return(0,Zo.default)((0,ur.default)(t.prototype),"getShaders",this).call(this,{vs:Sf,fs:Of,modules:[Ee.project32,Ee.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){if((0,Zo.default)((0,ur.default)(t.prototype),"updateState",this).call(this,i),i.changeFlags.extensionsChanged){var o,a=this.context.gl;(o=this.state.model)===null||o===void 0||o.delete(),this.state.model=this._getModel(a),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.radiusUnits,l=a.radiusScale,u=a.radiusMinPixels,f=a.radiusMaxPixels,c=a.stroked,p=a.filled,d=a.billboard,g=a.antialiasing,m=a.lineWidthUnits,y=a.lineWidthScale,x=a.lineWidthMinPixels,_=a.lineWidthMaxPixels;this.state.model.setUniforms(o).setUniforms({stroked:c?1:0,filled:p,billboard:d,antialiasing:g,radiusUnits:Ee.UNIT[s],radiusScale:l,radiusMinPixels:u,radiusMaxPixels:f,lineWidthUnits:Ee.UNIT[m],lineWidthScale:y,lineWidthMinPixels:x,lineWidthMaxPixels:_}).draw()}},{key:"_getModel",value:function(i){var o=[-1,-1,0,1,-1,0,1,1,0,-1,1,0];return new Mn.Model(i,Mf(Mf({},this.getShaders()),{},{id:this.props.id,geometry:new Mn.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array(o)}}}),isInstanced:!0}))}}]),t}(Ee.Layer);(0,Cn.default)(xt,"defaultProps",Mh);(0,Cn.default)(xt,"layerName","ScatterplotLayer");var ic=v(j()),oc=v(B()),Qo=v(ne()),ac=v(J()),sc=v(q()),gr=v(Y()),En=v(N()),ue=v(H()),Ve=v(ie());var Yf=v(N()),Kf=v(j()),Jf=v(J()),qf=v(q()),Xo=v(Y()),Xf=v(H()),Tn=v(ie());var Ff=v(j()),Df=v(B());var Pt={CLOCKWISE:1,COUNTER_CLOCKWISE:-1};function Ue(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=kf(e,t);return n!==r?(Lh(e,t),!0):!1}function kf(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(fr(e,r))}function fr(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=r.size||2,s=0,l=n,u=o-a;l<o;l+=a)s+=(e[l]-e[u])*(e[l+1]+e[u+1]),u=l;return s/2}function Yo(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.start,i=n===void 0?0:n,o=t.end,a=o===void 0?e.length:o,s=t.size,l=s===void 0?2:s,u=t.isClosed,f=(a-i)/l,c=0;c<f-1;++c)r(e[i+c*l],e[i+c*l+1],e[i+(c+1)*l],e[i+(c+1)*l+1],c,c+1);var p=i+(f-1)*l,d=u||vt(e[i],e[p])&&vt(e[i+1],e[p+1]);d||r(e[p],e[p+1],e[i],e[i+1],f-1,0)}function Lh(e,r){for(var t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=r.size,s=a===void 0?2:a,l=(o-n)/s,u=Math.floor(l/2),f=0;f<u;++f)for(var c=n+f*s,p=n+(l-1-f)*s,d=0;d<s;++d){var g=e[c+d];e[c+d]=e[p+d],e[p+d]=g}}function Rf(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=Ah(e,t);return n!==r?(e.reverse(),!0):!1}function Ah(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return Math.sign(Ko(e,r))}function Ko(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},t=r.start,n=t===void 0?0:t,i=r.end,o=i===void 0?e.length:i,a=0,s=n,l=o-1;s<o;++s)a+=(e[s][0]-e[l][0])*(e[s][1]+e[l][1]),l=s;return a/2}function zf(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n=t.start,i=n===void 0?0:n,o=t.end,a=o===void 0?e.length:o,s=t.isClosed,l=i;l<a-1;++l)r(e[l],e[l+1],l,l+1);var u=s||vt(e[a-1],e[0]);u||r(e[a-1],e[0],a-1,0)}var jf=function(){function e(r){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};(0,Ff.default)(this,e),I(this,"points",void 0),I(this,"isFlatArray",void 0),I(this,"options",void 0),this.points=r,this.isFlatArray=!ct(r[0]),this.options={start:t.start||0,end:t.end||r.length,size:t.size||2,isClosed:t.isClosed},Object.freeze(this)}return(0,Df.default)(e,[{key:"getSignedArea",value:function(){return this.isFlatArray?fr(this.points,this.options):Ko(this.points,this.options)}},{key:"getArea",value:function(){return Math.abs(this.getSignedArea())}},{key:"getWindingDirection",value:function(){return Math.sign(this.getSignedArea())}},{key:"forEachSegment",value:function(t){this.isFlatArray?Yo(this.points,function(n,i,o,a,s,l){t([n,i],[o,a],s,l)},this.options):zf(this.points,t,this.options)}},{key:"modifyWindingDirection",value:function(t){return this.isFlatArray?Ue(this.points,t,this.options):Rf(this.points,t,this.options)}}]),e}();function ae(e,r){var t=r.length,n=e.length;if(n>0){for(var i=!0,o=0;o<t;o++)if(e[n-t+o]!==r[o]){i=!1;break}if(i)return!1}for(var a=0;a<t;a++)e[n+a]=r[a];return!0}function cr(e,r){for(var t=r.length,n=0;n<t;n++)e[n]=r[n]}function Ge(e,r,t,n){for(var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o=n+r*t,a=0;a<t;a++)i[a]=e[o+a];return i}function Ln(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:[],o,a;if(t&8)o=(n[3]-e[1])/(r[1]-e[1]),a=3;else if(t&4)o=(n[1]-e[1])/(r[1]-e[1]),a=1;else if(t&2)o=(n[2]-e[0])/(r[0]-e[0]),a=2;else if(t&1)o=(n[0]-e[0])/(r[0]-e[0]),a=0;else return null;for(var s=0;s<e.length;s++)i[s]=(a&1)===s?n[a]:o*(r[s]-e[s])+e[s];return i}function pr(e,r){var t=0;return e[0]<r[0]?t|=1:e[0]>r[2]&&(t|=2),e[1]<r[1]?t|=4:e[1]>r[3]&&(t|=8),t}function vr(e,r){var t=r||{},n=t.size,i=n===void 0?2:n,o=t.broken,a=o===void 0?!1:o,s=t.gridResolution,l=s===void 0?10:s,u=t.gridOffset,f=u===void 0?[0,0]:u,c=t.startIndex,p=c===void 0?0:c,d=t.endIndex,g=d===void 0?e.length:d,m=(g-p)/i,y=[],x=[y],_=Ge(e,0,i,p),h,P,b=Bf(_,l,f,[]),O=[];ae(y,_);for(var L=1;L<m;L++){for(h=Ge(e,L,i,p,h),P=pr(h,b);P;){Ln(_,h,P,b,O);var T=pr(O,b);T&&(Ln(_,O,T,b,O),P=T),ae(y,O),cr(_,O),Ih(b,l,P),a&&y.length>i&&(y=[],x.push(y),ae(y,_)),P=pr(h,b)}ae(y,h),cr(_,h)}return a?x:x[0]}var Nf=0,Th=1;function An(e,r){for(var t=0;t<r.length;t++)e.push(r[t]);return e}function dr(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0;if(!e.length)return[];for(var n=t||{},i=n.size,o=i===void 0?2:i,a=n.gridResolution,s=a===void 0?10:a,l=n.gridOffset,u=l===void 0?[0,0]:l,f=n.edgeTypes,c=f===void 0?!1:f,p=[],d=[{pos:e,types:c?new Array(e.length/o).fill(Th):null,holes:r||[]}],g=[[],[]],m=[];d.length;){var y=d.shift(),x=y.pos,_=y.types,h=y.holes;Eh(x,o,h[0]||x.length,g),m=Bf(g[0],s,u,m);var P=pr(g[1],m);if(P){var b=Wf(x,_,o,0,h[0]||x.length,m,P),O={pos:b[0].pos,types:b[0].types,holes:[]},L={pos:b[1].pos,types:b[1].types,holes:[]};d.push(O,L);for(var T=0;T<h.length;T++)b=Wf(x,_,o,h[T],h[T+1]||x.length,m,P),b[0]&&(O.holes.push(O.pos.length),O.pos=An(O.pos,b[0].pos),c&&(O.types=An(O.types,b[0].types))),b[1]&&(L.holes.push(L.pos.length),L.pos=An(L.pos,b[1].pos),c&&(L.types=An(L.types,b[1].types)))}else{var R={positions:x};c&&(R.edgeTypes=_),h.length&&(R.holeIndices=h),p.push(R)}}return p}function Wf(e,r,t,n,i,o,a){for(var s=(i-n)/t,l=[],u=[],f=[],c=[],p=[],d,g,m,y=Ge(e,s-1,t,n),x=Math.sign(a&8?y[1]-o[3]:y[0]-o[2]),_=r&&r[s-1],h=0,P=0,b=0;b<s;b++)d=Ge(e,b,t,n,d),g=Math.sign(a&8?d[1]-o[3]:d[0]-o[2]),m=r&&r[n/t+b],g&&x&&x!==g&&(Ln(y,d,a,o,p),ae(l,p)&&f.push(_),ae(u,p)&&c.push(_)),g<=0?(ae(l,d)&&f.push(m),h-=g):f.length&&(f[f.length-1]=Nf),g>=0?(ae(u,d)&&c.push(m),P+=g):c.length&&(c[c.length-1]=Nf),cr(y,d),x=g,_=m;return[h?{pos:l,types:r&&f}:null,P?{pos:u,types:r&&c}:null]}function Bf(e,r,t,n){var i=Math.floor((e[0]-t[0])/r)*r+t[0],o=Math.floor((e[1]-t[1])/r)*r+t[1];return n[0]=i,n[1]=o,n[2]=i+r,n[3]=o+r,n}function Ih(e,r,t){t&8?(e[1]+=r,e[3]+=r):t&4?(e[1]-=r,e[3]-=r):t&2?(e[0]+=r,e[2]+=r):t&1&&(e[0]-=r,e[2]-=r)}function Eh(e,r,t,n){for(var i=1/0,o=-1/0,a=1/0,s=-1/0,l=0;l<t;l+=r){var u=e[l],f=e[l+1];i=u<i?u:i,o=u>o?u:o,a=f<a?f:a,s=f>s?f:s}return n[0][0]=i,n[0][1]=a,n[1][0]=o,n[1][1]=s,n}function Gf(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kh(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function kh(e,r){if(e){if(typeof e=="string")return Uf(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Uf(e,r)}}function Uf(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Rh=85.051129;function Jo(e,r){var t=r||{},n=t.size,i=n===void 0?2:n,o=t.startIndex,a=o===void 0?0:o,s=t.endIndex,l=s===void 0?e.length:s,u=t.normalize,f=u===void 0?!0:u,c=e.slice(a,l);Vf(c,i,0,l-a);var p=vr(c,{size:i,broken:!0,gridResolution:360,gridOffset:[-180,-180]});if(f){var d=Gf(p),g;try{for(d.s();!(g=d.n()).done;){var m=g.value;Hf(m,i)}}catch(y){d.e(y)}finally{d.f()}}return p}function qo(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,t=arguments.length>2?arguments[2]:void 0,n=t||{},i=n.size,o=i===void 0?2:i,a=n.normalize,s=a===void 0?!0:a,l=n.edgeTypes,u=l===void 0?!1:l;r=r||[];for(var f=[],c=[],p=0,d=0,g=0;g<=r.length;g++){for(var m=r[g]||e.length,y=d,x=zh(e,o,p,m),_=x;_<m;_++)f[d++]=e[_];for(var h=p;h<x;h++)f[d++]=e[h];Vf(f,o,y,d),Fh(f,o,y,d,t?.maxLatitude),p=m,c[g]=d}c.pop();var P=dr(f,c,{size:o,gridResolution:360,gridOffset:[-180,-180],edgeTypes:u});if(s){var b=Gf(P),O;try{for(b.s();!(O=b.n()).done;){var L=O.value;Hf(L.positions,o)}}catch(T){b.e(T)}finally{b.f()}}return P}function zh(e,r,t,n){for(var i=-1,o=-1,a=t+1;a<n;a+=r){var s=Math.abs(e[a]);s>i&&(i=s,o=a-1)}return o}function Fh(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:Rh,o=e[t],a=e[n-r];if(Math.abs(o-a)>180){var s=Ge(e,0,r,t);s[0]+=Math.round((a-o)/360)*360,ae(e,s),s[1]=Math.sign(s[1])*i,ae(e,s),s[0]=o,ae(e,s)}}function Vf(e,r,t,n){for(var i=e[0],o,a=t;a<n;a+=r){o=e[a];var s=o-i;(s>180||s<-180)&&(o-=Math.round(s/360)*360),e[a]=i=o}}function Hf(e,r){for(var t,n=e.length/r,i=0;i<n&&(t=e[i*r],(t+180)%360===0);i++);var o=-Math.round(t/360)*360;if(o!==0)for(var a=0;a<n;a++)e[a*r]+=o}function $f(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Zf(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?$f(Object(t),!0).forEach(function(n){(0,Yf.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$f(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Dh(e){var r=jh();return function(){var n=(0,Xo.default)(e),i;if(r){var o=(0,Xo.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,qf.default)(this,i)}}function jh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Qf=function(e){(0,Jf.default)(t,e);var r=Dh(t);function t(n){(0,Kf.default)(this,t);var i=n.id,o=i===void 0?(0,Tn.uid)("column-geometry"):i,a=Nh(n),s=a.indices,l=a.attributes;return r.call(this,Zf(Zf({},n),{},{id:o,indices:s,attributes:l}))}return t}(Tn.Geometry);function Nh(e){var r=e.radius,t=e.height,n=t===void 0?1:t,i=e.nradial,o=i===void 0?10:i,a=e.vertices;a&&(Xf.log.assert(a.length>=o),a=a.flatMap(function(D){return[D[0],D[1]]}),Ue(a,Pt.COUNTER_CLOCKWISE));var s=n>0,l=o+1,u=s?l*3+1:o,f=Math.PI*2/o,c=new Uint16Array(s?o*3*2:0),p=new Float32Array(u*3),d=new Float32Array(u*3),g=0;if(s){for(var m=0;m<l;m++)for(var y=m*f,x=m%o,_=Math.sin(y),h=Math.cos(y),P=0;P<2;P++)p[g+0]=a?a[x*2]:h*r,p[g+1]=a?a[x*2+1]:_*r,p[g+2]=(1/2-P)*n,d[g+0]=a?a[x*2]:h,d[g+1]=a?a[x*2+1]:_,g+=3;p[g+0]=p[g-3],p[g+1]=p[g-2],p[g+2]=p[g-1],g+=3}for(var b=s?0:1;b<l;b++){var O=Math.floor(b/2)*Math.sign(.5-b%2),L=O*f,T=(O+o)%o,R=Math.sin(L),W=Math.cos(L);p[g+0]=a?a[T*2]:W*r,p[g+1]=a?a[T*2+1]:R*r,p[g+2]=n/2,d[g+2]=1,g+=3}if(s)for(var z=0,E=0;E<o;E++)c[z++]=E*2+0,c[z++]=E*2+2,c[z++]=E*2+0,c[z++]=E*2+1,c[z++]=E*2+1,c[z++]=E*2+3;return{indices:c,attributes:{POSITION:{size:3,value:p},NORMAL:{size:3,value:d}}}}var ec=`#version 300 es

#define SHADER_NAME column-layer-vertex-shader

in vec3 positions;
in vec3 normals;

in vec3 instancePositions;
in float instanceElevations;
in vec3 instancePositions64Low;
in vec4 instanceFillColors;
in vec4 instanceLineColors;
in float instanceStrokeWidths;

in vec3 instancePickingColors;
uniform float opacity;
uniform float radius;
uniform float angle;
uniform vec2 offset;
uniform bool extruded;
uniform bool stroked;
uniform bool isStroke;
uniform float coverage;
uniform float elevationScale;
uniform float edgeDistance;
uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform int radiusUnits;
uniform int widthUnits;
out vec4 vColor;
#ifdef FLAT_SHADING
out vec4 position_commonspace;
#endif

void main(void) {
  geometry.worldPosition = instancePositions;

  vec4 color = isStroke ? instanceLineColors : instanceFillColors;
  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));
  float elevation = 0.0;
  float strokeOffsetRatio = 1.0;

  if (extruded) {
    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;
  } else if (stroked) {
    float widthPixels = clamp(
      project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
      widthMinPixels, widthMaxPixels) / 2.0;
    float halfOffset = project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);
    if (isStroke) {
      strokeOffsetRatio -= sign(positions.z) * halfOffset;
    } else {
      strokeOffsetRatio -= halfOffset;
    }
  }
  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);
  float dotRadius = radius * coverage * shouldRender;

  geometry.pickingColor = instancePickingColors;
  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);
  vec3 centroidPosition64Low = instancePositions64Low;
  vec2 offset = (rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius;
  if (radiusUnits == UNIT_METERS) {
    offset = project_size(offset);
  }
  vec3 pos = vec3(offset, 0.);
  DECKGL_FILTER_SIZE(pos, geometry);

  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64Low, pos, geometry.position);
  geometry.normal = project_normal(vec3(rotationMatrix * normals.xy, normals.z));
  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  if (extruded && !isStroke) {
#ifdef FLAT_SHADING
    position_commonspace = geometry.position;
    vColor = vec4(color.rgb, color.a * opacity);
#else
    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, geometry.position.xyz, geometry.normal);
    vColor = vec4(lightColor, color.a * opacity);
#endif
  } else {
    vColor = vec4(color.rgb, color.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var tc=`#version 300 es
#define SHADER_NAME column-layer-fragment-shader

precision highp float;

uniform vec3 project_uCameraPosition;
uniform bool extruded;
uniform bool isStroke;

out vec4 fragColor;

in vec4 vColor;
#ifdef FLAT_SHADING
in vec4 position_commonspace;
#endif

void main(void) {
  fragColor = vColor;
#ifdef FLAT_SHADING
  if (extruded && !isStroke && !picking_uActive) {
    vec3 normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
    fragColor.rgb = lighting_getLightColor(vColor.rgb, project_uCameraPosition, position_commonspace.xyz, normal);
  }
#endif
  DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;function rc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function nc(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?rc(Object(t),!0).forEach(function(n){(0,En.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):rc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Wh(e){var r=Bh();return function(){var n=(0,gr.default)(e),i;if(r){var o=(0,gr.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,sc.default)(this,i)}}function Bh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var In=[0,0,0,255],Uh={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},radiusUnits:"meters",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(r){return r.position}},getFillColor:{type:"accessor",value:In},getLineColor:{type:"accessor",value:In},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},bt=function(e){(0,ac.default)(t,e);var r=Wh(t);function t(){return(0,ic.default)(this,t),r.apply(this,arguments)}return(0,oc.default)(t,[{key:"getShaders",value:function(){var i=this.context.gl,o=!(0,Ve.isWebGL2)(i),a={},s=this.props.flatShading&&(0,Ve.hasFeature)(i,Ve.FEATURES.GLSL_DERIVATIVES);return s&&(a.FLAT_SHADING=1),(0,Qo.default)((0,gr.default)(t.prototype),"getShaders",this).call(this,{vs:ec,fs:tc,defines:a,transpileToGLSL100:o,modules:[ue.project32,s?ue.phongLighting:ue.gouraudLighting,ue.picking]})}},{key:"initializeState",value:function(){var i=this.getAttributeManager();i.addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instanceFillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getFillColor",defaultValue:In},instanceLineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getLineColor",defaultValue:In},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(i){(0,Qo.default)((0,gr.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.extensionsChanged||o.flatShading!==a.flatShading;if(l){var u,f=this.context.gl;(u=this.state.model)===null||u===void 0||u.delete(),this.state.model=this._getModel(f),this.getAttributeManager().invalidateAll()}(l||o.diskResolution!==a.diskResolution||o.vertices!==a.vertices||(o.extruded||o.stroked)!==(a.extruded||a.stroked))&&this._updateGeometry(o)}},{key:"getGeometry",value:function(i,o,a){var s=new Qf({radius:1,height:a?2:0,vertices:o,nradial:i}),l=0;if(o)for(var u=0;u<i;u++){var f=o[u],c=Math.sqrt(f[0]*f[0]+f[1]*f[1]);l+=c/i}else l=1;return this.setState({edgeDistance:Math.cos(Math.PI/i)*l}),s}},{key:"_getModel",value:function(i){return new Ve.Model(i,nc(nc({},this.getShaders()),{},{id:this.props.id,isInstanced:!0}))}},{key:"_updateGeometry",value:function(i){var o=i.diskResolution,a=i.vertices,s=i.extruded,l=i.stroked,u=this.getGeometry(o,a,s||l);this.setState({fillVertexCount:u.attributes.POSITION.value.length/3,wireframeVertexCount:u.indices.value.length}),this.state.model.setProps({geometry:u})}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.lineWidthUnits,l=a.lineWidthScale,u=a.lineWidthMinPixels,f=a.lineWidthMaxPixels,c=a.radiusUnits,p=a.elevationScale,d=a.extruded,g=a.filled,m=a.stroked,y=a.wireframe,x=a.offset,_=a.coverage,h=a.radius,P=a.angle,b=this.state,O=b.model,L=b.fillVertexCount,T=b.wireframeVertexCount,R=b.edgeDistance;O.setUniforms(o).setUniforms({radius:h,angle:P/180*Math.PI,offset:x,extruded:d,stroked:m,coverage:_,elevationScale:p,edgeDistance:R,radiusUnits:ue.UNIT[c],widthUnits:ue.UNIT[s],widthScale:l,widthMinPixels:u,widthMaxPixels:f}),d&&y&&(O.setProps({isIndexed:!0}),O.setVertexCount(T).setDrawMode(1).setUniforms({isStroke:!0}).draw()),g&&(O.setProps({isIndexed:!1}),O.setVertexCount(L).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!d&&m&&(O.setProps({isIndexed:!1}),O.setVertexCount(L*2/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}}]),t}(ue.Layer);(0,En.default)(bt,"layerName","ColumnLayer");(0,En.default)(bt,"defaultProps",Uh);var lc=v(j()),uc=v(B()),fc=v(J()),cc=v(q()),ea=v(Y()),ta=v(N()),pc=v(ie()),vc=v(H());function Gh(e){var r=Vh();return function(){var n=(0,ea.default)(e),i;if(r){var o=(0,ea.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,cc.default)(this,i)}}function Vh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Hh={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",value:[1,1]}},kn=function(e){(0,fc.default)(t,e);var r=Gh(t);function t(){return(0,lc.default)(this,t),r.apply(this,arguments)}return(0,uc.default)(t,[{key:"getGeometry",value:function(i){return new pc.CubeGeometry}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.elevationScale,l=a.extruded,u=a.offset,f=a.coverage,c=a.cellSize,p=a.angle,d=a.radiusUnits;this.state.model.setUniforms(o).setUniforms({radius:c/2,radiusUnits:vc.UNIT[d],angle:p,offset:u,extruded:l,coverage:f,elevationScale:s,edgeDistance:1,isWireframe:!1}).draw()}}]),t}(bt);(0,ta.default)(kn,"layerName","GridCellLayer");(0,ta.default)(kn,"defaultProps",Hh);var Ec=v(j()),kc=v(B()),Rc=v(be()),zn=v(ne()),zc=v(J()),Fc=v(q()),wt=v(Y()),hr=v(N()),He=v(H()),Fn=v(ie());var Pc=v(N()),bc=v(j()),wc=v(B()),_c=v(ne()),Sc=v(J()),Oc=v(q()),Rn=v(Y()),Cc=v(H());function dc(e,r,t,n){var i;if(Array.isArray(e[0])){var o=e.length*r;i=new Array(o);for(var a=0;a<e.length;a++)for(var s=0;s<r;s++)i[a*r+s]=e[a][s]||0}else i=e;return t?vr(i,{size:r,gridResolution:t}):n?Jo(i,{size:r}):i}function gc(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=$h(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function $h(e,r){if(e){if(typeof e=="string")return hc(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return hc(e,r)}}function hc(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function mc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function yc(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?mc(Object(t),!0).forEach(function(n){(0,Pc.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):mc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Zh(e){var r=Yh();return function(){var n=(0,Rn.default)(e),i;if(r){var o=(0,Rn.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Oc.default)(this,i)}}function Yh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Kh=1,Jh=2,ra=4,Mc=function(e){(0,Sc.default)(t,e);var r=Zh(t);function t(n){return(0,bc.default)(this,t),r.call(this,yc(yc({},n),{},{attributes:{positions:{size:3,padding:18,initialize:!0,type:n.fp64?Float64Array:Float32Array},segmentTypes:{size:1,type:Uint8ClampedArray}}}))}return(0,wc.default)(t,[{key:"get",value:function(i){return this.attributes[i]}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize?(0,_c.default)((0,Rn.default)(t.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"normalizeGeometry",value:function(i){return this.normalize?dc(i,this.positionSize,this.opts.resolution,this.opts.wrapLongitude):i}},{key:"getGeometrySize",value:function(i){if(xc(i)){var o=0,a=gc(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;o+=this.getGeometrySize(l)}}catch(f){a.e(f)}finally{a.f()}return o}var u=this.getPathLength(i);return u<2?0:this.isClosed(i)?u<3?0:u+2:u}},{key:"updateGeometryAttributes",value:function(i,o){if(o.geometrySize!==0)if(i&&xc(i)){var a=gc(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value,u=this.getGeometrySize(l);o.geometrySize=u,this.updateGeometryAttributes(l,o),o.vertexStart+=u}}catch(f){a.e(f)}finally{a.f()}}else this._updateSegmentTypes(i,o),this._updatePositions(i,o)}},{key:"_updateSegmentTypes",value:function(i,o){var a=this.attributes.segmentTypes,s=i?this.isClosed(i):!1,l=o.vertexStart,u=o.geometrySize;a.fill(0,l,l+u),s?(a[l]=ra,a[l+u-2]=ra):(a[l]+=Kh,a[l+u-2]+=Jh),a[l+u-1]=ra}},{key:"_updatePositions",value:function(i,o){var a=this.attributes.positions;if(!(!a||!i))for(var s=o.vertexStart,l=o.geometrySize,u=new Array(3),f=s,c=0;c<l;f++,c++)this.getPointOnPath(i,c,u),a[f*3]=u[0],a[f*3+1]=u[1],a[f*3+2]=u[2]}},{key:"getPathLength",value:function(i){return i.length/this.positionSize}},{key:"getPointOnPath",value:function(i,o){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:[],s=this.positionSize;o*s>=i.length&&(o+=1-i.length/s);var l=o*s;return a[0]=i[l],a[1]=i[l+1],a[2]=s===3&&i[l+2]||0,a}},{key:"isClosed",value:function(i){if(!this.normalize)return Boolean(this.opts.loop);var o=this.positionSize,a=i.length-o;return i[0]===i[a]&&i[1]===i[a+1]&&(o===2||i[2]===i[a+2])}}]),t}(Cc.Tesselator);function xc(e){return Array.isArray(e[0])}var Lc=`#define SHADER_NAME path-layer-vertex-shader

attribute vec2 positions;

attribute float instanceTypes;
attribute vec3 instanceStartPositions;
attribute vec3 instanceEndPositions;
attribute vec3 instanceLeftPositions;
attribute vec3 instanceRightPositions;
attribute vec3 instanceLeftPositions64Low;
attribute vec3 instanceStartPositions64Low;
attribute vec3 instanceEndPositions64Low;
attribute vec3 instanceRightPositions64Low;
attribute float instanceStrokeWidths;
attribute vec4 instanceColors;
attribute vec3 instancePickingColors;

uniform float widthScale;
uniform float widthMinPixels;
uniform float widthMaxPixels;
uniform float jointType;
uniform float capType;
uniform float miterLimit;
uniform bool billboard;
uniform int widthUnits;

uniform float opacity;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

const float EPSILON = 0.001;
const vec3 ZERO_OFFSET = vec3(0.0);

float flipIfTrue(bool flag) {
  return -(float(flag) * 2. - 1.);
}
vec3 getLineJoinOffset(
  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,
  vec2 width
) {
  bool isEnd = positions.x > 0.0;
  float sideOfPath = positions.y;
  float isJoint = float(sideOfPath == 0.0);

  vec3 deltaA3 = (currPoint - prevPoint);
  vec3 deltaB3 = (nextPoint - currPoint);

  mat3 rotationMatrix;
  bool needsRotation = !billboard && project_needs_rotation(currPoint, rotationMatrix);
  if (needsRotation) {
    deltaA3 = deltaA3 * rotationMatrix;
    deltaB3 = deltaB3 * rotationMatrix;
  }
  vec2 deltaA = deltaA3.xy / width;
  vec2 deltaB = deltaB3.xy / width;

  float lenA = length(deltaA);
  float lenB = length(deltaB);

  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);
  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);

  vec2 perpA = vec2(-dirA.y, dirA.x);
  vec2 perpB = vec2(-dirB.y, dirB.x);
  vec2 tangent = dirA + dirB;
  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;
  vec2 miterVec = vec2(-tangent.y, tangent.x);
  vec2 dir = isEnd ? dirA : dirB;
  vec2 perp = isEnd ? perpA : perpB;
  float L = isEnd ? lenA : lenB;
  float sinHalfA = abs(dot(miterVec, perp));
  float cosHalfA = abs(dot(dirA, miterVec));
  float turnDirection = flipIfTrue(dirA.x * dirB.y >= dirA.y * dirB.x);
  float cornerPosition = sideOfPath * turnDirection;

  float miterSize = 1.0 / max(sinHalfA, EPSILON);
  miterSize = mix(
    min(miterSize, max(lenA, lenB) / max(cosHalfA, EPSILON)),
    miterSize,
    step(0.0, cornerPosition)
  );

  vec2 offsetVec = mix(miterVec * miterSize, perp, step(0.5, cornerPosition))
    * (sideOfPath + isJoint * turnDirection);
  bool isStartCap = lenA == 0.0 || (!isEnd && (instanceTypes == 1.0 || instanceTypes == 3.0));
  bool isEndCap = lenB == 0.0 || (isEnd && (instanceTypes == 2.0 || instanceTypes == 3.0));
  bool isCap = isStartCap || isEndCap;
  if (isCap) {
    offsetVec = mix(perp * sideOfPath, dir * capType * 4.0 * flipIfTrue(isStartCap), isJoint);
    vJointType = capType;
  } else {
    vJointType = jointType;
  }
  vPathLength = L;
  vCornerOffset = offsetVec;
  vMiterLength = dot(vCornerOffset, miterVec * turnDirection);
  vMiterLength = isCap ? isJoint : vMiterLength;

  vec2 offsetFromStartOfPath = vCornerOffset + deltaA * float(isEnd);
  vPathPosition = vec2(
    dot(offsetFromStartOfPath, perp),
    dot(offsetFromStartOfPath, dir)
  );
  geometry.uv = vPathPosition;

  float isValid = step(instanceTypes, 3.5);
  vec3 offset = vec3(offsetVec * width * isValid, 0.0);

  if (needsRotation) {
    offset = rotationMatrix * offset;
  }
  return offset;
}
void clipLine(inout vec4 position, vec4 refPosition) {
  if (position.w < EPSILON) {
    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);
    position = refPosition + (position - refPosition) * r;
  }
}

void main() {
  geometry.pickingColor = instancePickingColors;

  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity);

  float isEnd = positions.x;

  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);
  vec3 prevPosition64Low = mix(instanceLeftPositions64Low, instanceStartPositions64Low, isEnd);

  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);
  vec3 currPosition64Low = mix(instanceStartPositions64Low, instanceEndPositions64Low, isEnd);

  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);
  vec3 nextPosition64Low = mix(instanceEndPositions64Low, instanceRightPositions64Low, isEnd);

  geometry.worldPosition = currPosition;
  vec2 widthPixels = vec2(clamp(
    project_size_to_pixel(instanceStrokeWidths * widthScale, widthUnits),
    widthMinPixels, widthMaxPixels) / 2.0);
  vec3 width;

  if (billboard) {
    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64Low, ZERO_OFFSET);
    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64Low, ZERO_OFFSET, geometry.position);
    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64Low, ZERO_OFFSET);

    clipLine(prevPositionScreen, currPositionScreen);
    clipLine(nextPositionScreen, currPositionScreen);
    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));

    width = vec3(widthPixels, 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(
      prevPositionScreen.xyz / prevPositionScreen.w,
      currPositionScreen.xyz / currPositionScreen.w,
      nextPositionScreen.xyz / nextPositionScreen.w,
      project_pixel_size_to_clipspace(width.xy)
    );

    DECKGL_FILTER_GL_POSITION(currPositionScreen, geometry);
    gl_Position = vec4(currPositionScreen.xyz + offset * currPositionScreen.w, currPositionScreen.w);
  } else {
    prevPosition = project_position(prevPosition, prevPosition64Low);
    currPosition = project_position(currPosition, currPosition64Low);
    nextPosition = project_position(nextPosition, nextPosition64Low);

    width = vec3(project_pixel_size(widthPixels), 0.0);
    DECKGL_FILTER_SIZE(width, geometry);

    vec3 offset = getLineJoinOffset(prevPosition, currPosition, nextPosition, width.xy);
    geometry.position = vec4(currPosition + offset, 1.0);
    gl_Position = project_common_position_to_clipspace(geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var Ac=`#define SHADER_NAME path-layer-fragment-shader

precision highp float;

uniform float miterLimit;

varying vec4 vColor;
varying vec2 vCornerOffset;
varying float vMiterLength;
varying vec2 vPathPosition;
varying float vPathLength;
varying float vJointType;

void main(void) {
  geometry.uv = vPathPosition;

  if (vPathPosition.y < 0.0 || vPathPosition.y > vPathLength) {
    if (vJointType > 0.5 && length(vCornerOffset) > 1.0) {
      discard;
    }
    if (vJointType < 0.5 && vMiterLength > miterLimit + 1.0) {
      discard;
    }
  }
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Tc(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ic(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Tc(Object(t),!0).forEach(function(n){(0,hr.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Tc(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function qh(e){var r=Xh();return function(){var n=(0,wt.default)(e),i;if(r){var o=(0,wt.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Fc.default)(this,i)}}function Xh(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Dc=[0,0,0,255],Qh={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},jointRounded:!1,capRounded:!1,miterLimit:{type:"number",min:0,value:4},billboard:!1,_pathType:null,getPath:{type:"accessor",value:function(r){return r.path}},getColor:{type:"accessor",value:Dc},getWidth:{type:"accessor",value:1},rounded:{deprecatedFor:["jointRounded","capRounded"]}},na={enter:function(r,t){return t.length?t.subarray(t.length-r.length):r}},$e=function(e){(0,zc.default)(t,e);var r=qh(t);function t(){var n;(0,Ec.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,hr.default)((0,Rc.default)(n),"state",void 0),n}return(0,kc.default)(t,[{key:"getShaders",value:function(){return(0,zn.default)((0,wt.default)(t.prototype),"getShaders",this).call(this,{vs:Lc,fs:Ac,modules:[He.project32,He.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,o=!0,a=this.getAttributeManager();a.addInstanced({positions:{size:3,vertexOffset:1,type:5130,fp64:this.use64bitPositions(),transition:na,accessor:"getPath",update:this.calculatePositions,noAlloc:o,shaderAttributes:{instanceLeftPositions:{vertexOffset:0},instanceStartPositions:{vertexOffset:1},instanceEndPositions:{vertexOffset:2},instanceRightPositions:{vertexOffset:3}}},instanceTypes:{size:1,type:5121,update:this.calculateSegmentTypes,noAlloc:o},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:na,defaultValue:1},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,accessor:"getColor",transition:na,defaultValue:Dc},instancePickingColors:{size:3,type:5121,accessor:function(l,u){var f=u.index,c=u.target;return i.encodePickingColor(l&&l.__source?l.__source.index:f,c)}}}),this.setState({pathTesselator:new Mc({fp64:this.use64bitPositions()})})}},{key:"updateState",value:function(i){(0,zn.default)((0,wt.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.changeFlags,s=this.getAttributeManager(),l=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getPath);if(l){var u=this.state.pathTesselator,f=o.data.attributes||{};u.updateGeometry({data:o.data,geometryBuffer:f.getPath,buffers:f,normalize:!o._pathType,loop:o._pathType==="loop",getGeometry:o.getPath,positionFormat:o.positionFormat,wrapLongitude:o.wrapLongitude,resolution:this.context.viewport.resolution,dataChanged:a.dataChanged}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),a.dataChanged||s.invalidateAll()}if(a.extensionsChanged){var c,p=this.context.gl;(c=this.state.model)===null||c===void 0||c.delete(),this.state.model=this._getModel(p),s.invalidateAll()}}},{key:"getPickingInfo",value:function(i){var o=(0,zn.default)((0,wt.default)(t.prototype),"getPickingInfo",this).call(this,i),a=o.index,s=this.props.data;return s[0]&&s[0].__source&&(o.object=s.find(function(l){return l.__source.index===a})),o}},{key:"disablePickingIndex",value:function(i){var o=this.props.data;if(o[0]&&o[0].__source)for(var a=0;a<o.length;a++)o[a].__source.index===i&&this._disablePickingIndex(a);else this._disablePickingIndex(i)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.jointRounded,l=a.capRounded,u=a.billboard,f=a.miterLimit,c=a.widthUnits,p=a.widthScale,d=a.widthMinPixels,g=a.widthMaxPixels;this.state.model.setUniforms(o).setUniforms({jointType:Number(s),capType:Number(l),billboard:u,widthUnits:He.UNIT[c],widthScale:p,miterLimit:f,widthMinPixels:d,widthMaxPixels:g}).draw()}},{key:"_getModel",value:function(i){var o=[0,1,2,1,4,2,1,3,4,3,5,4],a=[0,0,0,-1,0,1,1,-1,1,1,1,0];return new Fn.Model(i,Ic(Ic({},this.getShaders()),{},{id:this.props.id,geometry:new Fn.Geometry({drawMode:4,attributes:{indices:new Uint16Array(o),positions:{value:new Float32Array(a),size:2}}}),isInstanced:!0}))}},{key:"calculatePositions",value:function(i){var o=this.state.pathTesselator;i.startIndices=o.vertexStarts,i.value=o.get("positions")}},{key:"calculateSegmentTypes",value:function(i){var o=this.state.pathTesselator;i.startIndices=o.vertexStarts,i.value=o.get("segmentTypes")}}]),t}(He.Layer);(0,hr.default)($e,"defaultProps",Qh);(0,hr.default)($e,"layerName","PathLayer");var Pp=v(j()),bp=v(B()),wp=v(J()),_p=v(q()),fa=v(Y()),ca=v(N()),Mt=v(H());var dp=v(j()),gp=v(B()),hp=v(be()),Hn=v(ne()),mp=v(J()),yp=v(q()),Ct=v(Y()),wr=v(N()),ce=v(H()),ke=v(ie());var np=v(N()),ip=v(j()),op=v(B()),ua=v(ne()),ap=v(J()),sp=v(q()),br=v(Y());var Yc=v(Br()),Kc=v(Uc());function gm(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=hm(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function hm(e,r){if(e){if(typeof e=="string")return Gc(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Gc(e,r)}}function Gc(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Bn=Pt.CLOCKWISE,Vc=Pt.COUNTER_CLOCKWISE,Ze={isClosed:!0};function mm(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function St(e){return"positions"in e?e.positions:e}function Pr(e){return"holeIndices"in e?e.holeIndices:null}function ym(e){return Array.isArray(e[0])}function xm(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function Pm(e){var r=e[0],t=e[e.length-1];return r[0]===t[0]&&r[1]===t[1]&&r[2]===t[2]}function bm(e,r,t,n){for(var i=0;i<r;i++)if(e[t+i]!==e[n-r+i])return!1;return!0}function Hc(e,r,t,n,i){for(var o=r,a=t.length,s=0;s<a;s++)for(var l=0;l<n;l++)e[o++]=t[s][l]||0;if(!Pm(t))for(var u=0;u<n;u++)e[o++]=t[0][u]||0;return Ze.start=r,Ze.end=o,Ze.size=n,Ue(e,i,Ze),o}function $c(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0;o=o||t.length;var s=o-i;if(s<=0)return r;for(var l=r,u=0;u<s;u++)e[l++]=t[i+u];if(!bm(t,n,i,o))for(var f=0;f<n;f++)e[l++]=t[i+f];return Ze.start=r,Ze.end=l,Ze.size=n,Ue(e,a,Ze),l}function Un(e,r){mm(e);var t=[],n=[];if("positions"in e){var i=e,o=i.positions,a=i.holeIndices;if(a){for(var s=0,l=0;l<=a.length;l++)s=$c(t,s,o,r,a[l-1],a[l],l===0?Bn:Vc),n.push(s);return n.pop(),{positions:t,holeIndices:n}}e=o}if(!ym(e))return $c(t,0,e,r,0,t.length,Bn),t;if(!xm(e)){var u=0,f=gm(e.entries()),c;try{for(f.s();!(c=f.n()).done;){var p=(0,Yc.default)(c.value,2),d=p[0],g=p[1];u=Hc(t,u,g,r,d===0?Bn:Vc),n.push(u)}}catch(m){f.e(m)}finally{f.f()}return n.pop(),{positions:t,holeIndices:n}}return Hc(t,0,e,r,Bn),t}function la(e,r,t){for(var n=e.length/3,i=0,o=0;o<n;o++){var a=(o+1)%n;i+=e[o*3+r]*e[a*3+t],i-=e[a*3+r]*e[o*3+t]}return Math.abs(i/2)}function Zc(e,r,t,n){for(var i=e.length/3,o=0;o<i;o++){var a=o*3,s=e[a+0],l=e[a+1],u=e[a+2];e[a+r]=s,e[a+t]=l,e[a+n]=u}}function Jc(e,r,t,n){var i=Pr(e);i&&(i=i.map(function(g){return g/r}));var o=St(e),a=n&&r===3;if(t){var s=o.length;o=o.slice();for(var l=[],u=0;u<s;u+=r){l[0]=o[u],l[1]=o[u+1],a&&(l[2]=o[u+2]);var f=t(l);o[u]=f[0],o[u+1]=f[1],a&&(o[u+2]=f[2])}}if(a){var c=la(o,0,1),p=la(o,0,2),d=la(o,1,2);if(!c&&!p&&!d)return[];c>p&&c>d||(p>d?(t||(o=o.slice()),Zc(o,0,2,1)):(t||(o=o.slice()),Zc(o,1,2,0)))}return(0,Kc.default)(o,i,r)}var lp=v(H());function Xc(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=wm(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function wm(e,r){if(e){if(typeof e=="string")return Qc(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Qc(e,r)}}function Qc(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function ep(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function tp(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?ep(Object(t),!0).forEach(function(n){(0,np.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):ep(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _m(e){var r=Sm();return function(){var n=(0,br.default)(e),i;if(r){var o=(0,br.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,sp.default)(this,i)}}function Sm(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var up=function(e){(0,ap.default)(t,e);var r=_m(t);function t(n){(0,ip.default)(this,t);var i=n.fp64,o=n.IndexType,a=o===void 0?Uint32Array:o;return r.call(this,tp(tp({},n),{},{attributes:{positions:{size:3,type:i?Float64Array:Float32Array},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:a,size:1}}}))}return(0,op.default)(t,[{key:"get",value:function(i){var o=this.attributes;return i==="indices"?o.indices&&o.indices.subarray(0,this.vertexCount):o[i]}},{key:"updateGeometry",value:function(i){(0,ua.default)((0,br.default)(t.prototype),"updateGeometry",this).call(this,i);var o=this.buffers.indices;if(o)this.vertexCount=(o.value||o).length;else if(this.data&&!this.getGeometry)throw new Error("missing indices buffer")}},{key:"normalizeGeometry",value:function(i){if(this.normalize){var o=Un(i,this.positionSize);return this.opts.resolution?dr(St(o),Pr(o),{size:this.positionSize,gridResolution:this.opts.resolution,edgeTypes:!0}):this.opts.wrapLongitude?qo(St(o),Pr(o),{size:this.positionSize,maxLatitude:86,edgeTypes:!0}):o}return i}},{key:"getGeometrySize",value:function(i){if(rp(i)){var o=0,a=Xc(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;o+=this.getGeometrySize(l)}}catch(u){a.e(u)}finally{a.f()}return o}return St(i).length/this.positionSize}},{key:"getGeometryFromBuffer",value:function(i){return this.normalize||!this.buffers.indices?(0,ua.default)((0,br.default)(t.prototype),"getGeometryFromBuffer",this).call(this,i):null}},{key:"updateGeometryAttributes",value:function(i,o){if(i&&rp(i)){var a=Xc(i),s;try{for(a.s();!(s=a.n()).done;){var l=s.value,u=this.getGeometrySize(l);o.geometrySize=u,this.updateGeometryAttributes(l,o),o.vertexStart+=u,o.indexStart=this.indexStarts[o.geometryIndex+1]}}catch(f){a.e(f)}finally{a.f()}}else this._updateIndices(i,o),this._updatePositions(i,o),this._updateVertexValid(i,o)}},{key:"_updateIndices",value:function(i,o){var a=o.geometryIndex,s=o.vertexStart,l=o.indexStart,u=this.attributes,f=this.indexStarts,c=this.typedArrayManager,p=u.indices;if(!(!p||!i)){var d=l,g=Jc(i,this.positionSize,this.opts.preproject,this.opts.full3d);p=c.allocate(p,l+g.length,{copy:!0});for(var m=0;m<g.length;m++)p[d++]=g[m]+s;f[a+1]=l+g.length,u.indices=p}}},{key:"_updatePositions",value:function(i,o){var a=o.vertexStart,s=o.geometrySize,l=this.attributes.positions,u=this.positionSize;if(!(!l||!i))for(var f=St(i),c=a,p=0;p<s;c++,p++){var d=f[p*u],g=f[p*u+1],m=u>2?f[p*u+2]:0;l[c*3]=d,l[c*3+1]=g,l[c*3+2]=m}}},{key:"_updateVertexValid",value:function(i,o){var a=o.vertexStart,s=o.geometrySize,l=this.positionSize,u=this.attributes.vertexValid,f=i&&Pr(i);if(i&&i.edgeTypes?u.set(i.edgeTypes,a):u.fill(1,a,a+s),f)for(var c=0;c<f.length;c++)u[a+f[c]/l-1]=0;u[a+s-1]=0}}]),t}(lp.Tesselator);function rp(e){return Array.isArray(e)&&e.length>0&&!Number.isFinite(e[0])}var Gn=`
attribute vec2 vertexPositions;
attribute float vertexValid;

uniform bool extruded;
uniform bool isWireframe;
uniform float elevationScale;
uniform float opacity;

varying vec4 vColor;

struct PolygonProps {
  vec4 fillColors;
  vec4 lineColors;
  vec3 positions;
  vec3 nextPositions;
  vec3 pickingColors;
  vec3 positions64Low;
  vec3 nextPositions64Low;
  float elevations;
};

vec3 project_offset_normal(vec3 vector) {
  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS) {
    return normalize(vector * project_uCommonUnitsPerWorldUnit);
  }
  return project_normal(vector);
}

void calculatePosition(PolygonProps props) {
#ifdef IS_SIDE_VERTEX
  if(vertexValid < 0.5){
    gl_Position = vec4(0.);
    return;
  }
#endif

  vec3 pos;
  vec3 pos64Low;
  vec3 normal;
  vec4 colors = isWireframe ? props.lineColors : props.fillColors;

  geometry.worldPosition = props.positions;
  geometry.worldPositionAlt = props.nextPositions;
  geometry.pickingColor = props.pickingColors;

#ifdef IS_SIDE_VERTEX
  pos = mix(props.positions, props.nextPositions, vertexPositions.x);
  pos64Low = mix(props.positions64Low, props.nextPositions64Low, vertexPositions.x);
#else
  pos = props.positions;
  pos64Low = props.positions64Low;
#endif

  if (extruded) {
    pos.z += props.elevations * vertexPositions.y * elevationScale;
  }
  gl_Position = project_position_to_clipspace(pos, pos64Low, vec3(0.), geometry.position);

  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);

  if (extruded) {
  #ifdef IS_SIDE_VERTEX
    normal = vec3(
      props.positions.y - props.nextPositions.y + (props.positions64Low.y - props.nextPositions64Low.y),
      props.nextPositions.x - props.positions.x + (props.nextPositions64Low.x - props.positions64Low.x),
      0.0);
    normal = project_offset_normal(normal);
  #else
    normal = project_normal(vec3(0.0, 0.0, 1.0));
  #endif
    geometry.normal = normal;
    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, geometry.position.xyz, normal);
    vColor = vec4(lightColor, colors.a * opacity);
  } else {
    vColor = vec4(colors.rgb, colors.a * opacity);
  }
  DECKGL_FILTER_COLOR(vColor, geometry);
}
`;var fp=`#define SHADER_NAME solid-polygon-layer-vertex-shader

attribute vec3 positions;
attribute vec3 positions64Low;
attribute float elevations;
attribute vec4 fillColors;
attribute vec4 lineColors;
attribute vec3 pickingColors;

`.concat(Gn,`

void main(void) {
  PolygonProps props;

  props.positions = positions;
  props.positions64Low = positions64Low;
  props.elevations = elevations;
  props.fillColors = fillColors;
  props.lineColors = lineColors;
  props.pickingColors = pickingColors;

  calculatePosition(props);
}
`);var cp=`#define SHADER_NAME solid-polygon-layer-vertex-shader-side
#define IS_SIDE_VERTEX


attribute vec3 instancePositions;
attribute vec3 nextPositions;
attribute vec3 instancePositions64Low;
attribute vec3 nextPositions64Low;
attribute float instanceElevations;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

`.concat(Gn,`

void main(void) {
  PolygonProps props;

  #if RING_WINDING_ORDER_CW == 1
    props.positions = instancePositions;
    props.positions64Low = instancePositions64Low;
    props.nextPositions = nextPositions;
    props.nextPositions64Low = nextPositions64Low;
  #else
    props.positions = nextPositions;
    props.positions64Low = nextPositions64Low;
    props.nextPositions = instancePositions;
    props.nextPositions64Low = instancePositions64Low;
  #endif
  props.elevations = instanceElevations;
  props.fillColors = instanceFillColors;
  props.lineColors = instanceLineColors;
  props.pickingColors = instancePickingColors;

  calculatePosition(props);
}
`);var pp=`#define SHADER_NAME solid-polygon-layer-fragment-shader

precision highp float;

varying vec4 vColor;

void main(void) {
  gl_FragColor = vColor;

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function vp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ot(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?vp(Object(t),!0).forEach(function(n){(0,wr.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):vp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Om(e){var r=Cm();return function(){var n=(0,Ct.default)(e),i;if(r){var o=(0,Ct.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,yp.default)(this,i)}}function Cm(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var $n=[0,0,0,255],Mm={filled:!0,extruded:!1,wireframe:!1,_normalize:!0,_windingOrder:"CW",_full3d:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(r){return r.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:$n},getLineColor:{type:"accessor",value:$n},material:!0},Vn={enter:function(r,t){return t.length?t.subarray(t.length-r.length):r}},Ye=function(e){(0,mp.default)(t,e);var r=Om(t);function t(){var n;(0,dp.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,wr.default)((0,hp.default)(n),"state",void 0),n}return(0,gp.default)(t,[{key:"getShaders",value:function(i){return(0,Hn.default)((0,Ct.default)(t.prototype),"getShaders",this).call(this,{vs:i==="top"?fp:cp,fs:pp,defines:{RING_WINDING_ORDER_CW:!this.props._normalize&&this.props._windingOrder==="CCW"?0:1},modules:[ce.project32,ce.gouraudLighting,ce.picking]})}},{key:"wrapLongitude",get:function(){return!1}},{key:"initializeState",value:function(){var i=this,o=this.context,a=o.gl,s=o.viewport,l=this.props.coordinateSystem,u=this.props._full3d;s.isGeospatial&&l===ce.COORDINATE_SYSTEM.DEFAULT&&(l=ce.COORDINATE_SYSTEM.LNGLAT);var f;l===ce.COORDINATE_SYSTEM.LNGLAT&&(u?f=s.projectPosition.bind(s):f=s.projectFlat.bind(s)),this.setState({numInstances:0,polygonTesselator:new up({preproject:f,fp64:this.use64bitPositions(),IndexType:!a||(0,ke.hasFeatures)(a,ke.FEATURES.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var c=this.getAttributeManager(),p=!0;c.remove(["instancePickingColors"]),c.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:p},positions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:Vn,accessor:"getPolygon",update:this.calculatePositions,noAlloc:p,shaderAttributes:{positions:{vertexOffset:0,divisor:0},instancePositions:{vertexOffset:0,divisor:1},nextPositions:{vertexOffset:1,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:p},elevations:{size:1,transition:Vn,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Vn,accessor:"getFillColor",defaultValue:$n,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:Vn,accessor:"getLineColor",defaultValue:$n,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(g,m){var y=m.index,x=m.target;return i.encodePickingColor(g&&g.__source?g.__source.index:y,x)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"getPickingInfo",value:function(i){var o=(0,Hn.default)((0,Ct.default)(t.prototype),"getPickingInfo",this).call(this,i),a=o.index,s=this.props.data;return s[0]&&s[0].__source&&(o.object=s.find(function(l){return l.__source.index===a})),o}},{key:"disablePickingIndex",value:function(i){var o=this.props.data;if(o[0]&&o[0].__source)for(var a=0;a<o.length;a++)o[a].__source.index===i&&this._disablePickingIndex(a);else this._disablePickingIndex(i)}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.extruded,l=a.filled,u=a.wireframe,f=a.elevationScale,c=this.state,p=c.topModel,d=c.sideModel,g=c.polygonTesselator,m=Ot(Ot({},o),{},{extruded:Boolean(s),elevationScale:f});d&&(d.setInstanceCount(g.instanceCount-1),d.setUniforms(m),u&&(d.setDrawMode(3),d.setUniforms({isWireframe:!0}).draw()),l&&(d.setDrawMode(6),d.setUniforms({isWireframe:!1}).draw())),p&&(p.setVertexCount(g.vertexCount),p.setUniforms(m).draw())}},{key:"updateState",value:function(i){(0,Hn.default)((0,Ct.default)(t.prototype),"updateState",this).call(this,i),this.updateGeometry(i);var o=i.props,a=i.oldProps,s=i.changeFlags,l=this.getAttributeManager(),u=s.extensionsChanged||o.filled!==a.filled||o.extruded!==a.extruded;if(u){var f;(f=this.state.models)===null||f===void 0||f.forEach(function(c){return c.delete()}),this.setState(this._getModels(this.context.gl)),l.invalidateAll()}}},{key:"updateGeometry",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getPolygon);if(l){var u=this.state.polygonTesselator,f=o.data.attributes||{};u.updateGeometry({data:o.data,normalize:o._normalize,geometryBuffer:f.getPolygon,buffers:f,getGeometry:o.getPolygon,positionFormat:o.positionFormat,wrapLongitude:o.wrapLongitude,resolution:this.context.viewport.resolution,fp64:this.use64bitPositions(),dataChanged:s.dataChanged,full3d:o._full3d}),this.setState({numInstances:u.instanceCount,startIndices:u.vertexStarts}),s.dataChanged||this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(i){var o=this.props,a=o.id,s=o.filled,l=o.extruded,u,f;if(s){var c=this.getShaders("top");c.defines.NON_INSTANCED_MODEL=1,u=new ke.Model(i,Ot(Ot({},c),{},{id:"".concat(a,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0}))}return l&&(f=new ke.Model(i,Ot(Ot({},this.getShaders("side")),{},{id:"".concat(a,"-side"),geometry:new ke.Geometry({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,0,0,0,0,1,1,1])}}}),instanceCount:0,isInstanced:1})),f.userData.excludeAttributes={indices:!0}),{models:[f,u].filter(Boolean),topModel:u,sideModel:f}}},{key:"calculateIndices",value:function(i){var o=this.state.polygonTesselator;i.startIndices=o.indexStarts,i.value=o.get("indices")}},{key:"calculatePositions",value:function(i){var o=this.state.polygonTesselator;i.startIndices=o.vertexStarts,i.value=o.get("positions")}},{key:"calculateVertexValid",value:function(i){i.value=this.state.polygonTesselator.get("vertexValid")}}]),t}(ce.Layer);(0,wr.default)(Ye,"defaultProps",Mm);(0,wr.default)(Ye,"layerName","SolidPolygonLayer");function Zn(e){for(var r=e.data,t=e.getIndex,n=e.dataRange,i=e.replace,o=n.startRow,a=o===void 0?0:o,s=n.endRow,l=s===void 0?1/0:s,u=r.length,f=u,c=u,p=0;p<u;p++){var d=t(r[p]);if(f>p&&d>=a&&(f=p),d>=l){c=p;break}}for(var g=f,m=c-f!==i.length,y=m?r.slice(c):void 0,x=0;x<i.length;x++)r[g++]=i[x];if(y){for(var _=0;_<y.length;_++)r[g++]=y[_];r.length=g}return{startRow:f,endRow:f+i.length}}function Lm(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Am(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Am(e,r){if(e){if(typeof e=="string")return xp(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return xp(e,r)}}function xp(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Tm(e){var r=Im();return function(){var n=(0,fa.default)(e),i;if(r){var o=(0,fa.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,_p.default)(this,i)}}function Im(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Sp=[0,0,0,255],Em=[0,0,0,255],km={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:function(r){return r.polygon}},getFillColor:{type:"accessor",value:Em},getLineColor:{type:"accessor",value:Sp},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0},Yn=function(e){(0,wp.default)(t,e);var r=Tm(t);function t(){return(0,Pp.default)(this,t),r.apply(this,arguments)}return(0,bp.default)(t,[{key:"initializeState",value:function(){this.state={paths:[]},this.props.getLineDashArray&&Mt.log.removed("getLineDashArray","PathStyleExtension")()}},{key:"updateState",value:function(i){var o=this,a=i.changeFlags,s=a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getPolygon);if(s&&Array.isArray(a.dataChanged)){var l=this.state.paths.slice(),u=a.dataChanged.map(function(f){return Zn({data:l,getIndex:function(p){return p.__source.index},dataRange:f,replace:o._getPaths(f)})});this.setState({paths:l,pathsDiff:u})}else s&&this.setState({paths:this._getPaths(),pathsDiff:null})}},{key:"_getPaths",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},o=this.props,a=o.data,s=o.getPolygon,l=o.positionFormat,u=o._normalize,f=[],c=l==="XY"?2:3,p=i.startRow,d=i.endRow,g=(0,Mt.createIterable)(a,p,d),m=g.iterable,y=g.objectInfo,x=Lm(m),_;try{for(x.s();!(_=x.n()).done;){var h=_.value;y.index++;var P=s(h,y);u&&(P=Un(P,c));var b=P,O=b.holeIndices,L=P.positions||P;if(O)for(var T=0;T<=O.length;T++){var R=L.slice(O[T-1]||0,O[T]||L.length);f.push(this.getSubLayerRow({path:R},h,y.index))}else f.push(this.getSubLayerRow({path:L},h,y.index))}}catch(W){x.e(W)}finally{x.f()}return f}},{key:"renderLayers",value:function(){var i=this.props,o=i.data,a=i._dataDiff,s=i.stroked,l=i.filled,u=i.extruded,f=i.wireframe,c=i._normalize,p=i._windingOrder,d=i.elevationScale,g=i.transitions,m=i.positionFormat,y=this.props,x=y.lineWidthUnits,_=y.lineWidthScale,h=y.lineWidthMinPixels,P=y.lineWidthMaxPixels,b=y.lineJointRounded,O=y.lineMiterLimit,L=y.lineDashJustified,T=this.props,R=T.getFillColor,W=T.getLineColor,z=T.getLineWidth,E=T.getLineDashArray,D=T.getElevation,k=T.getPolygon,S=T.updateTriggers,w=T.material,C=this.state,A=C.paths,M=C.pathsDiff,U=this.getSubLayerClass("fill",Ye),G=this.getSubLayerClass("stroke",$e),X=this.shouldRenderSubLayer("fill",A)&&new U({_dataDiff:a,extruded:u,elevationScale:d,filled:l,wireframe:f,_normalize:c,_windingOrder:p,getElevation:D,getFillColor:R,getLineColor:u&&f?W:Sp,material:w,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:S&&{getPolygon:S.getPolygon,getElevation:S.getElevation,getFillColor:S.getFillColor,lineColors:u&&f,getLineColor:S.getLineColor}}),{data:o,positionFormat:m,getPolygon:k}),te=!u&&s&&this.shouldRenderSubLayer("stroke",A)&&new G({_dataDiff:M&&function(){return M},widthUnits:x,widthScale:_,widthMinPixels:h,widthMaxPixels:P,jointRounded:b,miterLimit:O,dashJustified:L,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(W),getWidth:this.getSubLayerAccessor(z),getDashArray:this.getSubLayerAccessor(E)},this.getSubLayerProps({id:"stroke",updateTriggers:S&&{getWidth:S.getLineWidth,getColor:S.getLineColor,getDashArray:S.getLineDashArray}}),{data:A,positionFormat:m,getPath:function(Te){return Te.path}});return[!u&&X,te,u&&X]}}]),t}(Mt.CompositeLayer);(0,ca.default)(Yn,"layerName","PolygonLayer");(0,ca.default)(Yn,"defaultProps",km);var Wv=v(Lp()),Bv=v(j()),Uv=v(B()),Pa=v(ne()),Gv=v(J()),Vv=v(q()),Tr=v(Y()),ii=v(N()),Hv=v(H());var Tp=v(N());function Ap(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Dm(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Ap(Object(t),!0).forEach(function(n){(0,Tp.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Ap(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Ip(e,r){if(!e)return null;var t="startIndices"in e?e.startIndices[r]:r,n=e.featureIds.value[t];return t!==-1?jm(e,n,t):null}function jm(e,r,t){var n={properties:Dm({},e.properties[r])};for(var i in e.numericProps)n.properties[i]=e.numericProps[i].value[t];return n}function Ep(e,r){var t={points:null,lines:null,polygons:null};for(var n in t){var i=e[n].globalFeatureIds.value;t[n]=new Uint8ClampedArray(i.length*3);for(var o=[],a=0;a<i.length;a++)r(i[a],o),t[n][a*3+0]=o[0],t[n][a*3+1]=o[1],t[n][a*3+2]=o[2]}return t}var ha=v(Br()),Mv=v(j()),Lv=v(B()),ei=v(be()),Av=v(J()),Tv=v(q()),ma=v(Y()),ot=v(N()),Tt=v(H());var Fp=v(j()),Dp=v(B()),jp=v(be()),nt=v(ne()),Np=v(J()),Wp=v(q()),Re=v(Y()),_r=v(N()),Bp=v(H());var kp=`#define SHADER_NAME multi-icon-layer-fragment-shader

precision highp float;

uniform float opacity;
uniform sampler2D iconsTexture;
uniform float gamma;
uniform bool sdf;
uniform float alphaCutoff;
uniform float sdfBuffer;
uniform float outlineBuffer;
uniform vec4 outlineColor;

varying vec4 vColor;
varying vec2 vTextureCoords;
varying vec2 uv;

void main(void) {
  geometry.uv = uv;

  if (!picking_uActive) {
    float alpha = texture2D(iconsTexture, vTextureCoords).a;
    vec4 color = vColor;
    if (sdf) {
      float distance = alpha;
      alpha = smoothstep(sdfBuffer - gamma, sdfBuffer + gamma, distance);

      if (outlineBuffer > 0.0) {
        float inFill = alpha;
        float inBorder = smoothstep(outlineBuffer - gamma, outlineBuffer + gamma, distance);
        color = mix(outlineColor, vColor, inFill);
        alpha = inBorder;
      }
    }
    float a = alpha * color.a;
    
    if (a < alphaCutoff) {
      discard;
    }

    gl_FragColor = vec4(color.rgb, a * opacity);
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function Rp(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Kn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Rp(Object(t),!0).forEach(function(n){(0,_r.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Rp(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Nm(e){var r=Wm();return function(){var n=(0,Re.default)(e),i;if(r){var o=(0,Re.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Wp.default)(this,i)}}function Wm(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var pa=192/256,zp=[],Bm={getIconOffsets:{type:"accessor",value:function(r){return r.offsets}},alphaCutoff:.001,smoothing:.1,outlineWidth:0,outlineColor:{type:"color",value:[0,0,0,255]}},Lt=function(e){(0,Np.default)(t,e);var r=Nm(t);function t(){var n;(0,Fp.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,_r.default)((0,jp.default)(n),"state",void 0),n}return(0,Dp.default)(t,[{key:"getShaders",value:function(){return Kn(Kn({},(0,nt.default)((0,Re.default)(t.prototype),"getShaders",this).call(this)),{},{fs:kp})}},{key:"initializeState",value:function(){var i=this;(0,nt.default)((0,Re.default)(t.prototype),"initializeState",this).call(this);var o=this.getAttributeManager();o.addInstanced({instanceOffsets:{size:2,accessor:"getIconOffsets"},instancePickingColors:{type:5121,size:3,accessor:function(s,l){var u=l.index,f=l.target;return i.encodePickingColor(u,f)}}})}},{key:"updateState",value:function(i){(0,nt.default)((0,Re.default)(t.prototype),"updateState",this).call(this,i);var o=i.props,a=i.oldProps,s=o.outlineColor;s!==a.outlineColor&&(s=s.map(function(l){return l/255}),s[3]=Number.isFinite(s[3])?s[3]:1,this.setState({outlineColor:s})),!o.sdf&&o.outlineWidth&&Bp.log.warn("".concat(this.id,": fontSettings.sdf is required to render outline"))()}},{key:"draw",value:function(i){var o=this.props,a=o.sdf,s=o.smoothing,l=o.outlineWidth,u=this.state.outlineColor,f=l?Math.max(s,pa*(1-l)):-1;if(i.uniforms=Kn(Kn({},i.uniforms),{},{sdfBuffer:pa,outlineBuffer:f,gamma:s,sdf:Boolean(a),outlineColor:u}),(0,nt.default)((0,Re.default)(t.prototype),"draw",this).call(this,i),a&&l){var c=this.state.iconManager,p=c.getTexture();p&&this.state.model.draw({uniforms:{outlineBuffer:pa}})}}},{key:"getInstanceOffset",value:function(i){var o=this;return i?Array.from(i).flatMap(function(a){return(0,nt.default)((0,Re.default)(t.prototype),"getInstanceOffset",o).call(o,a)}):zp}},{key:"getInstanceColorMode",value:function(i){return 1}},{key:"getInstanceIconFrame",value:function(i){var o=this;return i?Array.from(i).flatMap(function(a){return(0,nt.default)((0,Re.default)(t.prototype),"getInstanceIconFrame",o).call(o,a)}):zp}}]),t}(We);(0,_r.default)(Lt,"defaultProps",Bm);(0,_r.default)(Lt,"layerName","MultiIconLayer");var lv=v(j()),uv=v(B()),Or=v(N());var Sr=class{constructor({fontSize:r=24,buffer:t=3,radius:n=8,cutoff:i=.25,fontFamily:o="sans-serif",fontWeight:a="normal",fontStyle:s="normal"}={}){this.buffer=t,this.cutoff=i,this.radius=n;let l=this.size=r+t*4,u=this._createCanvas(l),f=this.ctx=u.getContext("2d",{willReadFrequently:!0});f.font=`${s} ${a} ${r}px ${o}`,f.textBaseline="alphabetic",f.textAlign="left",f.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(r){let t=document.createElement("canvas");return t.width=t.height=r,t}draw(r){let{width:t,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:o,actualBoundingBoxRight:a}=this.ctx.measureText(r),s=Math.ceil(n),l=0,u=Math.min(this.size-this.buffer,Math.ceil(a-o)),f=Math.min(this.size-this.buffer,s+Math.ceil(i)),c=u+2*this.buffer,p=f+2*this.buffer,d=Math.max(c*p,0),g=new Uint8ClampedArray(d),m={data:g,width:c,height:p,glyphWidth:u,glyphHeight:f,glyphTop:s,glyphLeft:l,glyphAdvance:t};if(u===0||f===0)return m;let{ctx:y,buffer:x,gridInner:_,gridOuter:h}=this;y.clearRect(x,x,u,f),y.fillText(r,x,x+s);let P=y.getImageData(x,x,u,f);h.fill(1e20,0,d),_.fill(0,0,d);for(let b=0;b<f;b++)for(let O=0;O<u;O++){let L=P.data[4*(b*u+O)+3]/255;if(L===0)continue;let T=(b+x)*c+O+x;if(L===1)h[T]=0,_[T]=1e20;else{let R=.5-L;h[T]=R>0?R*R:0,_[T]=R<0?R*R:0}}Up(h,0,0,c,p,c,this.f,this.v,this.z),Up(_,x,x,u,f,c,this.f,this.v,this.z);for(let b=0;b<d;b++){let O=Math.sqrt(h[b])-Math.sqrt(_[b]);g[b]=Math.round(255-255*(O/this.radius+this.cutoff))}return m}};function Up(e,r,t,n,i,o,a,s,l){for(let u=r;u<r+n;u++)Gp(e,t*o+u,o,i,a,s,l);for(let u=t;u<t+i;u++)Gp(e,u*o+r,1,n,a,s,l)}function Gp(e,r,t,n,i,o,a){o[0]=0,a[0]=-1e20,a[1]=1e20,i[0]=e[r];for(let s=1,l=0,u=0;s<n;s++){i[s]=e[r+s*t];let f=s*s;do{let c=o[l];u=(i[s]-i[c]+f-c*c)/(s-c)/2}while(u<=a[l]&&--l>-1);l++,o[l]=s,a[l]=u,a[l+1]=1e20}for(let s=0,l=0;s<n;s++){for(;a[l+1]<s;)l++;let u=o[l],f=s-u;e[r+s*t]=i[u]+f*f}}var fv=v(H());var $p=v(H());function Hp(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Um(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Um(e,r){if(e){if(typeof e=="string")return Vp(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vp(e,r)}}function Vp(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Gm=32,Vm=[];function Hm(e){return Math.pow(2,Math.ceil(Math.log2(e)))}function Zp(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,o=e.maxCanvasWidth,a=e.mapping,s=a===void 0?{}:a,l=e.xOffset,u=l===void 0?0:l,f=e.yOffset,c=f===void 0?0:f,p=0,d=u,g=n+i*2,m=Hp(r),y;try{for(m.s();!(y=m.n()).done;){var x=y.value;if(!s[x]){var _=t(x);d+_+i*2>o&&(d=0,p++),s[x]={x:d+i,y:c+p*g+i,width:_,height:g,layoutWidth:_,layoutHeight:n},d+=_+i*2}}}catch(h){m.e(h)}finally{m.f()}return{mapping:s,xOffset:d,yOffset:c+p*g,canvasHeight:Hm(c+(p+1)*g)}}function Yp(e,r,t,n){for(var i=0,o=r;o<t;o++){var a,s=e[o];i+=((a=n[s])===null||a===void 0?void 0:a.layoutWidth)||0}return i}function Kp(e,r,t,n,i,o){for(var a=r,s=0,l=r;l<t;l++){var u=Yp(e,l,l+1,i);s+u>n&&(a<l&&o.push(l),a=l,s=0),s+=u}return s}function $m(e,r,t,n,i,o){for(var a=r,s=r,l=r,u=0,f=r;f<t;f++)if((e[f]===" "||e[f+1]===" "||f+1===t)&&(l=f+1),l>s){var c=Yp(e,s,l,i);u+c>n&&(a<s&&(o.push(s),a=s,u=0),c>n&&(c=Kp(e,s,l,n,i,o),a=o[o.length-1])),s=l,u+=c}return u}function Zm(e,r,t,n){var i=arguments.length>4&&arguments[4]!==void 0?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;o===void 0&&(o=e.length);var a=[];return r==="break-all"?Kp(e,i,o,t,n,a):$m(e,i,o,t,n,a),a}function Ym(e,r,t,n,i,o){for(var a=0,s=0,l=r;l<t;l++){var u=e[l],f=n[u];f?(s||(s=f.layoutHeight),i[l]=a+f.layoutWidth/2,a+=f.layoutWidth):($p.log.warn("Missing character: ".concat(u," (").concat(u.codePointAt(0),")"))(),i[l]=a,a+=Gm)}o[0]=a,o[1]=s}function Jp(e,r,t,n,i){for(var o=Array.from(e),a=o.length,s=new Array(a),l=new Array(a),u=new Array(a),f=(t==="break-word"||t==="break-all")&&isFinite(n)&&n>0,c=[0,0],p=[0,0],d=0,g=0,m=0,y=0;y<=a;y++){var x=o[y];if((x===`
`||y===a)&&(m=y),m>g){for(var _=f?Zm(o,t,n,i,g,m):Vm,h=0;h<=_.length;h++){var P=h===0?g:_[h-1],b=h<_.length?_[h]:m;Ym(o,P,b,i,s,p);for(var O=P;O<b;O++){var L,T=o[O],R=((L=i[T])===null||L===void 0?void 0:L.layoutOffsetY)||0;l[O]=d+p[1]/2+R,u[O]=p[0]}d=d+p[1]*r,c[0]=Math.max(c[0],p[0])}g=m}x===`
`&&(s[g]=0,l[g]=0,u[g]=0,g++)}return c[1]=d,{x:s,y:l,rowWidth:u,size:c}}function qp(e){var r=e.value,t=e.length,n=e.stride,i=e.offset,o=e.startIndices,a=e.characterSet,s=r.BYTES_PER_ELEMENT,l=n?n/s:1,u=i?i/s:0,f=o[t]||Math.ceil((r.length-u)/l),c=a&&new Set,p=new Array(t),d=r;if(l>1||u>0){var g=r.constructor;d=new g(f);for(var m=0;m<f;m++)d[m]=r[m*l+u]}for(var y=0;y<t;y++){var x=o[y],_=o[y+1]||f,h=d.subarray(x,_);p[y]=String.fromCodePoint.apply(null,h),c&&h.forEach(c.add,c)}if(c){var P=Hp(c),b;try{for(P.s();!(b=P.n()).done;){var O=b.value;a.add(String.fromCodePoint(O))}}catch(L){P.e(L)}finally{P.f()}}return{texts:p,characterCount:f}}var Xp=v(j()),Qp=v(B()),Jn=v(N()),va=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:5;(0,Xp.default)(this,e),(0,Jn.default)(this,"limit",void 0),(0,Jn.default)(this,"_cache",{}),(0,Jn.default)(this,"_order",[]),this.limit=r}return(0,Qp.default)(e,[{key:"get",value:function(t){var n=this._cache[t];return n&&(this._deleteOrder(t),this._appendOrder(t)),n}},{key:"set",value:function(t,n){this._cache[t]?(this.delete(t),this._cache[t]=n,this._appendOrder(t)):(Object.keys(this._cache).length===this.limit&&this.delete(this._order[0]),this._cache[t]=n,this._appendOrder(t))}},{key:"delete",value:function(t){var n=this._cache[t];n&&(delete this._cache[t],this._deleteOrder(t))}},{key:"_deleteOrder",value:function(t){var n=this._order.indexOf(t);n>=0&&this._order.splice(n,1)}},{key:"_appendOrder",value:function(t){this._order.push(t)}}]),e}();function ev(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Km(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function Km(e,r){if(e){if(typeof e=="string")return tv(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tv(e,r)}}function tv(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function rv(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function nv(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?rv(Object(t),!0).forEach(function(n){(0,Or.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):rv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Jm(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}var it={fontFamily:"Monaco, monospace",fontWeight:"normal",characterSet:Jm(),fontSize:64,buffer:4,sdf:!1,cutoff:.25,radius:12,smoothing:.1},iv=1024,ov=.9,av=1.2,cv=3,qn=new va(cv);function qm(e,r){var t;typeof r=="string"?t=new Set(Array.from(r)):t=new Set(r);var n=qn.get(e);if(!n)return t;for(var i in n.mapping)t.has(i)&&t.delete(i);return t}function Xm(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}function sv(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="#000",e.textBaseline="alphabetic",e.textAlign="left"}function pv(e){fv.log.assert(Number.isFinite(e)&&e>=cv,"Invalid cache limit"),qn=new va(e)}var vv=function(){function e(){(0,lv.default)(this,e),(0,Or.default)(this,"props",nv({},it)),(0,Or.default)(this,"_key",void 0),(0,Or.default)(this,"_atlas",void 0)}return(0,uv.default)(e,[{key:"texture",get:function(){return this._atlas}},{key:"mapping",get:function(){return this._atlas&&this._atlas.mapping}},{key:"scale",get:function(){var t=this.props,n=t.fontSize,i=t.buffer;return(n*av+i*2)/n}},{key:"setProps",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Object.assign(this.props,t),this._key=this._getKey();var n=qm(this._key,this.props.characterSet),i=qn.get(this._key);if(i&&n.size===0){this._atlas!==i&&(this._atlas=i);return}var o=this._generateFontAtlas(n,i);this._atlas=o,qn.set(this._key,o)}},{key:"_generateFontAtlas",value:function(t,n){var i=this.props,o=i.fontFamily,a=i.fontWeight,s=i.fontSize,l=i.buffer,u=i.sdf,f=i.radius,c=i.cutoff,p=n&&n.data;p||(p=document.createElement("canvas"),p.width=iv);var d=p.getContext("2d",{willReadFrequently:!0});sv(d,o,s,a);var g=Zp(nv({getFontWidth:function(A){return d.measureText(A).width},fontHeight:s*av,buffer:l,characterSet:t,maxCanvasWidth:iv},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),m=g.mapping,y=g.canvasHeight,x=g.xOffset,_=g.yOffset;if(p.height!==y){var h=d.getImageData(0,0,p.width,p.height);p.height=y,d.putImageData(h,0,0)}if(sv(d,o,s,a),u){var P=new Sr({fontSize:s,buffer:l,radius:f,cutoff:c,fontFamily:o,fontWeight:"".concat(a)}),b=ev(t),O;try{for(b.s();!(O=b.n()).done;){var L=O.value,T=P.draw(L),R=T.data,W=T.width,z=T.height,E=T.glyphTop;m[L].width=W,m[L].layoutOffsetY=s*ov-E;var D=d.createImageData(W,z);Xm(R,D),d.putImageData(D,m[L].x,m[L].y)}}catch(C){b.e(C)}finally{b.f()}}else{var k=ev(t),S;try{for(k.s();!(S=k.n()).done;){var w=S.value;d.fillText(w,m[w].x,m[w].y+l+s*ov)}}catch(C){k.e(C)}finally{k.f()}}return{xOffset:x,yOffset:_,mapping:m,data:p,width:p.width,height:p.height}}},{key:"_getKey",value:function(){var t=this.props,n=t.fontFamily,i=t.fontWeight,o=t.fontSize,a=t.buffer,s=t.sdf,l=t.radius,u=t.cutoff;return s?"".concat(n," ").concat(i," ").concat(o," ").concat(a," ").concat(l," ").concat(u):"".concat(n," ").concat(i," ").concat(o," ").concat(a)}}]),e}();var yv=v(j()),xv=v(B()),Pv=v(be()),da=v(ne()),bv=v(J()),wv=v(q()),Cr=v(Y()),Mr=v(N()),Ke=v(H()),Xn=v(ie());var dv=`#define SHADER_NAME text-background-layer-vertex-shader

attribute vec2 positions;

attribute vec3 instancePositions;
attribute vec3 instancePositions64Low;
attribute vec4 instanceRects;
attribute float instanceSizes;
attribute float instanceAngles;
attribute vec2 instancePixelOffsets;
attribute float instanceLineWidths;
attribute vec4 instanceFillColors;
attribute vec4 instanceLineColors;
attribute vec3 instancePickingColors;

uniform bool billboard;
uniform float opacity;
uniform float sizeScale;
uniform float sizeMinPixels;
uniform float sizeMaxPixels;
uniform vec4 padding;
uniform int sizeUnits;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

vec2 rotate_by_angle(vec2 vertex, float angle) {
  float angle_radian = radians(angle);
  float cos_angle = cos(angle_radian);
  float sin_angle = sin(angle_radian);
  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);
  return rotationMatrix * vertex;
}

void main(void) {
  geometry.worldPosition = instancePositions;
  geometry.uv = positions;
  geometry.pickingColor = instancePickingColors;
  uv = positions;
  vLineWidth = instanceLineWidths;
  float sizePixels = clamp(
    project_size_to_pixel(instanceSizes * sizeScale, sizeUnits),
    sizeMinPixels, sizeMaxPixels
  );

  dimensions = instanceRects.zw * sizePixels + padding.xy + padding.zw;

  vec2 pixelOffset = (positions * instanceRects.zw + instanceRects.xy) * sizePixels + mix(-padding.xy, padding.zw, positions);
  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles);
  pixelOffset += instancePixelOffsets;
  pixelOffset.y *= -1.0;

  if (billboard)  {
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
    vec3 offset = vec3(pixelOffset, 0.0);
    DECKGL_FILTER_SIZE(offset, geometry);
    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
  } else {
    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);
    DECKGL_FILTER_SIZE(offset_common, geometry);
    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position);
    DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
  }
  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);
  DECKGL_FILTER_COLOR(vFillColor, geometry);
  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);
  DECKGL_FILTER_COLOR(vLineColor, geometry);
}
`;var gv=`#define SHADER_NAME text-background-layer-fragment-shader

precision highp float;

uniform bool stroked;

varying vec4 vFillColor;
varying vec4 vLineColor;
varying float vLineWidth;
varying vec2 uv;
varying vec2 dimensions;

void main(void) {
  geometry.uv = uv;

  vec2 pixelPosition = uv * dimensions;
  if (stroked) {
    float distToEdge = min(
      min(pixelPosition.x, dimensions.x - pixelPosition.x),
      min(pixelPosition.y, dimensions.y - pixelPosition.y)
    );
    float isBorder = smoothedge(distToEdge, vLineWidth);
    gl_FragColor = mix(vFillColor, vLineColor, isBorder);
  } else {
    gl_FragColor = vFillColor;
  }

  DECKGL_FILTER_COLOR(gl_FragColor, geometry);
}
`;function hv(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function mv(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?hv(Object(t),!0).forEach(function(n){(0,Mr.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):hv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function Qm(e){var r=ey();return function(){var n=(0,Cr.default)(e),i;if(r){var o=(0,Cr.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,wv.default)(this,i)}}function ey(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var ty={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,padding:{type:"array",value:[0,0,0,0]},getPosition:{type:"accessor",value:function(r){return r.position}},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]},getBoundingRect:{type:"accessor",value:[0,0,0,0]},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1}},At=function(e){(0,bv.default)(t,e);var r=Qm(t);function t(){var n;(0,yv.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,Mr.default)((0,Pv.default)(n),"state",void 0),n}return(0,xv.default)(t,[{key:"getShaders",value:function(){return(0,da.default)((0,Cr.default)(t.prototype),"getShaders",this).call(this,{vs:dv,fs:gv,modules:[Ke.project32,Ke.picking]})}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instanceRects:{size:4,accessor:"getBoundingRect"},instancePixelOffsets:{size:2,transition:!0,accessor:"getPixelOffset"},instanceFillColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(i){(0,da.default)((0,Cr.default)(t.prototype),"updateState",this).call(this,i);var o=i.changeFlags;if(o.extensionsChanged){var a,s=this.context.gl;(a=this.state.model)===null||a===void 0||a.delete(),this.state.model=this._getModel(s),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(i){var o=i.uniforms,a=this.props,s=a.billboard,l=a.sizeScale,u=a.sizeUnits,f=a.sizeMinPixels,c=a.sizeMaxPixels,p=a.getLineWidth,d=this.props.padding;d.length<4&&(d=[d[0],d[1],d[0],d[1]]),this.state.model.setUniforms(o).setUniforms({billboard:s,stroked:Boolean(p),padding:d,sizeUnits:Ke.UNIT[u],sizeScale:l,sizeMinPixels:f,sizeMaxPixels:c}).draw()}},{key:"_getModel",value:function(i){var o=[0,0,1,0,1,1,0,1];return new Xn.Model(i,mv(mv({},this.getShaders()),{},{id:this.props.id,geometry:new Xn.Geometry({drawMode:6,vertexCount:4,attributes:{positions:{size:2,value:new Float32Array(o)}}}),isInstanced:!0}))}}]),t}(Ke.Layer);(0,Mr.default)(At,"defaultProps",ty);(0,Mr.default)(At,"layerName","TextBackgroundLayer");function ry(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ny(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function ny(e,r){if(e){if(typeof e=="string")return _v(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return _v(e,r)}}function _v(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Sv(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Qn(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Sv(Object(t),!0).forEach(function(n){(0,ot.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Sv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function iy(e){var r=oy();return function(){var n=(0,ma.default)(e),i;if(r){var o=(0,ma.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Tv.default)(this,i)}}function oy(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}var Ov={start:1,middle:0,end:-1},Cv={top:1,center:0,bottom:-1},ga=[0,0,0,255],ay=1,sy={billboard:!0,sizeScale:1,sizeUnits:"pixels",sizeMinPixels:0,sizeMaxPixels:Number.MAX_SAFE_INTEGER,background:!1,getBackgroundColor:{type:"accessor",value:[255,255,255,255]},getBorderColor:{type:"accessor",value:ga},getBorderWidth:{type:"accessor",value:0},backgroundPadding:{type:"array",value:[0,0,0,0]},characterSet:{type:"object",value:it.characterSet},fontFamily:it.fontFamily,fontWeight:it.fontWeight,lineHeight:ay,outlineWidth:{type:"number",value:0,min:0},outlineColor:{type:"color",value:ga},fontSettings:{},wordBreak:"break-word",maxWidth:{type:"number",value:-1},getText:{type:"accessor",value:function(r){return r.text}},getPosition:{type:"accessor",value:function(r){return r.position}},getColor:{type:"accessor",value:ga},getSize:{type:"accessor",value:32},getAngle:{type:"accessor",value:0},getTextAnchor:{type:"accessor",value:"middle"},getAlignmentBaseline:{type:"accessor",value:"center"},getPixelOffset:{type:"accessor",value:[0,0]},backgroundColor:{deprecatedFor:["background","getBackgroundColor"]}},It=function(e){(0,Av.default)(t,e);var r=iy(t);function t(){var n;(0,Mv.default)(this,t);for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return n=r.call.apply(r,[this].concat(o)),(0,ot.default)((0,ei.default)(n),"state",void 0),(0,ot.default)((0,ei.default)(n),"getBoundingRect",function(s,l){var u=n.transformParagraph(s,l),f=(0,ha.default)(u.size,2),c=f[0],p=f[1],d=n.state.fontAtlasManager.props.fontSize;c/=d,p/=d;var g=n.props,m=g.getTextAnchor,y=g.getAlignmentBaseline,x=Ov[typeof m=="function"?m(s,l):m],_=Cv[typeof y=="function"?y(s,l):y];return[(x-1)*c/2,(_-1)*p/2,c,p]}),(0,ot.default)((0,ei.default)(n),"getIconOffsets",function(s,l){for(var u=n.props,f=u.getTextAnchor,c=u.getAlignmentBaseline,p=n.transformParagraph(s,l),d=p.x,g=p.y,m=p.rowWidth,y=(0,ha.default)(p.size,2),x=y[0],_=y[1],h=Ov[typeof f=="function"?f(s,l):f],P=Cv[typeof c=="function"?c(s,l):c],b=d.length,O=new Array(b*2),L=0,T=0;T<b;T++){var R=(1-h)*(x-m[T])/2;O[L++]=(h-1)*x/2+R+d[T],O[L++]=(P-1)*_/2+g[T]}return O}),n}return(0,Lv.default)(t,[{key:"initializeState",value:function(){this.state={styleVersion:0,fontAtlasManager:new vv},this.props.maxWidth>0&&Tt.log.warn("v8.9 breaking change: TextLayer maxWidth is now relative to text size")()}},{key:"updateState",value:function(i){var o=i.props,a=i.oldProps,s=i.changeFlags,l=s.dataChanged||s.updateTriggersChanged&&(s.updateTriggersChanged.all||s.updateTriggersChanged.getText);l&&this._updateText();var u=this._updateFontAtlas(),f=u||o.lineHeight!==a.lineHeight||o.wordBreak!==a.wordBreak||o.maxWidth!==a.maxWidth;f&&this.setState({styleVersion:this.state.styleVersion+1})}},{key:"getPickingInfo",value:function(i){var o=i.info;return o.object=o.index>=0?this.props.data[o.index]:null,o}},{key:"_updateFontAtlas",value:function(){var i=this.props,o=i.fontSettings,a=i.fontFamily,s=i.fontWeight,l=this.state,u=l.fontAtlasManager,f=l.characterSet,c=Qn(Qn({},o),{},{characterSet:f,fontFamily:a,fontWeight:s});if(!u.mapping)return u.setProps(c),!0;for(var p in c)if(c[p]!==u.props[p])return u.setProps(c),!0;return!1}},{key:"_updateText",value:function(){var i,o=this.props,a=o.data,s=o.characterSet,l=(i=a.attributes)===null||i===void 0?void 0:i.getText,u=this.props.getText,f=a.startIndices,c,p=s==="auto"&&new Set;if(l&&f){var d=qp(Qn(Qn({},ArrayBuffer.isView(l)?{value:l}:l),{},{length:a.length,startIndices:f,characterSet:p})),g=d.texts,m=d.characterCount;c=m,u=function(T,R){var W=R.index;return g[W]}}else{var y=(0,Tt.createIterable)(a),x=y.iterable,_=y.objectInfo;f=[0],c=0;var h=ry(x),P;try{for(h.s();!(P=h.n()).done;){var b=P.value;_.index++;var O=Array.from(u(b,_)||"");p&&O.forEach(p.add,p),c+=O.length,f.push(c)}}catch(L){h.e(L)}finally{h.f()}}this.setState({getText:u,startIndices:f,numInstances:c,characterSet:p||s})}},{key:"transformParagraph",value:function(i,o){var a=this.state.fontAtlasManager,s=a.mapping,l=this.state.getText,u=this.props,f=u.wordBreak,c=u.lineHeight,p=u.maxWidth,d=l(i,o)||"";return Jp(d,c,f,p*a.props.fontSize,s)}},{key:"renderLayers",value:function(){var i=this.state,o=i.startIndices,a=i.numInstances,s=i.getText,l=i.fontAtlasManager,u=l.scale,f=l.texture,c=l.mapping,p=i.styleVersion,d=this.props,g=d.data,m=d._dataDiff,y=d.getPosition,x=d.getColor,_=d.getSize,h=d.getAngle,P=d.getPixelOffset,b=d.getBackgroundColor,O=d.getBorderColor,L=d.getBorderWidth,T=d.backgroundPadding,R=d.background,W=d.billboard,z=d.fontSettings,E=d.outlineWidth,D=d.outlineColor,k=d.sizeScale,S=d.sizeUnits,w=d.sizeMinPixels,C=d.sizeMaxPixels,A=d.transitions,M=d.updateTriggers,U=this.getSubLayerClass("characters",Lt),G=this.getSubLayerClass("background",At);return[R&&new G({getFillColor:b,getLineColor:O,getLineWidth:L,padding:T,getPosition:y,getSize:_,getAngle:h,getPixelOffset:P,billboard:W,sizeScale:k,sizeUnits:S,sizeMinPixels:w,sizeMaxPixels:C,transitions:A&&{getPosition:A.getPosition,getAngle:A.getAngle,getSize:A.getSize,getFillColor:A.getBackgroundColor,getLineColor:A.getBorderColor,getLineWidth:A.getBorderWidth,getPixelOffset:A.getPixelOffset}},this.getSubLayerProps({id:"background",updateTriggers:{getPosition:M.getPosition,getAngle:M.getAngle,getSize:M.getSize,getFillColor:M.getBackgroundColor,getLineColor:M.getBorderColor,getLineWidth:M.getBorderWidth,getPixelOffset:M.getPixelOffset,getBoundingRect:{getText:M.getText,getTextAnchor:M.getTextAnchor,getAlignmentBaseline:M.getAlignmentBaseline,styleVersion:p}}}),{data:g.attributes&&g.attributes.background?{length:g.length,attributes:g.attributes.background}:g,_dataDiff:m,autoHighlight:!1,getBoundingRect:this.getBoundingRect}),new U({sdf:z.sdf,smoothing:Number.isFinite(z.smoothing)?z.smoothing:it.smoothing,outlineWidth:E/(z.radius||it.radius),outlineColor:D,iconAtlas:f,iconMapping:c,getPosition:y,getColor:x,getSize:_,getAngle:h,getPixelOffset:P,billboard:W,sizeScale:k*u,sizeUnits:S,sizeMinPixels:w*u,sizeMaxPixels:C*u,transitions:A&&{getPosition:A.getPosition,getAngle:A.getAngle,getColor:A.getColor,getSize:A.getSize,getPixelOffset:A.getPixelOffset}},this.getSubLayerProps({id:"characters",updateTriggers:{getIcon:M.getText,getPosition:M.getPosition,getAngle:M.getAngle,getColor:M.getColor,getSize:M.getSize,getPixelOffset:M.getPixelOffset,getIconOffsets:{getText:M.getText,getTextAnchor:M.getTextAnchor,getAlignmentBaseline:M.getAlignmentBaseline,styleVersion:p}}}),{data:g,_dataDiff:m,startIndices:o,numInstances:a,getIconOffsets:this.getIconOffsets,getIcon:s})]}}],[{key:"fontAtlasCacheLimit",set:function(i){pv(i)}}]),t}(Tt.CompositeLayer);(0,ot.default)(It,"defaultProps",sy);(0,ot.default)(It,"layerName","TextLayer");var Lr={circle:{type:xt,props:{filled:"filled",stroked:"stroked",lineWidthMaxPixels:"lineWidthMaxPixels",lineWidthMinPixels:"lineWidthMinPixels",lineWidthScale:"lineWidthScale",lineWidthUnits:"lineWidthUnits",pointRadiusMaxPixels:"radiusMaxPixels",pointRadiusMinPixels:"radiusMinPixels",pointRadiusScale:"radiusScale",pointRadiusUnits:"radiusUnits",pointAntialiasing:"antialiasing",pointBillboard:"billboard",getFillColor:"getFillColor",getLineColor:"getLineColor",getLineWidth:"getLineWidth",getPointRadius:"getRadius"}},icon:{type:We,props:{iconAtlas:"iconAtlas",iconMapping:"iconMapping",iconSizeMaxPixels:"sizeMaxPixels",iconSizeMinPixels:"sizeMinPixels",iconSizeScale:"sizeScale",iconSizeUnits:"sizeUnits",iconAlphaCutoff:"alphaCutoff",iconBillboard:"billboard",getIcon:"getIcon",getIconAngle:"getAngle",getIconColor:"getColor",getIconPixelOffset:"getPixelOffset",getIconSize:"getSize"}},text:{type:It,props:{textSizeMaxPixels:"sizeMaxPixels",textSizeMinPixels:"sizeMinPixels",textSizeScale:"sizeScale",textSizeUnits:"sizeUnits",textBackground:"background",textBackgroundPadding:"backgroundPadding",textFontFamily:"fontFamily",textFontWeight:"fontWeight",textLineHeight:"lineHeight",textMaxWidth:"maxWidth",textOutlineColor:"outlineColor",textOutlineWidth:"outlineWidth",textWordBreak:"wordBreak",textCharacterSet:"characterSet",textBillboard:"billboard",textFontSettings:"fontSettings",getText:"getText",getTextAngle:"getAngle",getTextColor:"getColor",getTextPixelOffset:"getPixelOffset",getTextSize:"getSize",getTextAnchor:"getTextAnchor",getTextAlignmentBaseline:"getAlignmentBaseline",getTextBackgroundColor:"getBackgroundColor",getTextBorderColor:"getBorderColor",getTextBorderWidth:"getBorderWidth"}}},Ar={type:$e,props:{lineWidthUnits:"widthUnits",lineWidthScale:"widthScale",lineWidthMinPixels:"widthMinPixels",lineWidthMaxPixels:"widthMaxPixels",lineJointRounded:"jointRounded",lineCapRounded:"capRounded",lineMiterLimit:"miterLimit",lineBillboard:"billboard",getLineColor:"getColor",getLineWidth:"getWidth"}},ti={type:Ye,props:{extruded:"extruded",filled:"filled",wireframe:"wireframe",elevationScale:"elevationScale",material:"material",_full3d:"_full3d",getElevation:"getElevation",getFillColor:"getFillColor",getLineColor:"getLineColor"}};function Et(e){var r=e.type,t=e.props,n={};for(var i in t)n[i]=r.defaultProps[t[i]];return n}function ri(e,r){var t=e.props,n=t.transitions,i=t.updateTriggers,o={updateTriggers:{},transitions:n&&{getPosition:n.geometry}};for(var a in r){var s=r[a],l=e.props[a];a.startsWith("get")&&(l=e.getSubLayerAccessor(l),o.updateTriggers[s]=i[a],n&&(o.transitions[s]=n[a])),o[s]=l}return o}var kt=v(H());function Ev(e){if(Array.isArray(e))return e;switch(kt.log.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return kt.log.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}function ya(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},n={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},i=t.startRow,o=i===void 0?0:i,a=t.endRow,s=a===void 0?e.length:a,l=o;l<s;l++){var u=e[l],f=u.geometry;if(f)if(f.type==="GeometryCollection"){kt.log.assert(Array.isArray(f.geometries),"GeoJSON does not have geometries array");for(var c=f.geometries,p=0;p<c.length;p++){var d=c[p];Iv(d,n,r,u,l)}}else Iv(f,n,r,u,l)}return n}function Iv(e,r,t,n,i){var o=e.type,a=e.coordinates,s=r.pointFeatures,l=r.lineFeatures,u=r.polygonFeatures,f=r.polygonOutlineFeatures;if(!uy(o,a)){kt.log.warn("".concat(o," coordinates are malformed"))();return}switch(o){case"Point":s.push(t({geometry:e},n,i));break;case"MultiPoint":a.forEach(function(c){s.push(t({geometry:{type:"Point",coordinates:c}},n,i))});break;case"LineString":l.push(t({geometry:e},n,i));break;case"MultiLineString":a.forEach(function(c){l.push(t({geometry:{type:"LineString",coordinates:c}},n,i))});break;case"Polygon":u.push(t({geometry:e},n,i)),a.forEach(function(c){f.push(t({geometry:{type:"LineString",coordinates:c}},n,i))});break;case"MultiPolygon":a.forEach(function(c){u.push(t({geometry:{type:"Polygon",coordinates:c}},n,i)),c.forEach(function(p){f.push(t({geometry:{type:"LineString",coordinates:p}},n,i))})});break;default:}}var ly={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};function uy(e,r){var t=ly[e];for(kt.log.assert(t,"Unknown GeoJSON type ".concat(e));r&&--t>0;)r=r[0];return r&&Number.isFinite(r[0])}var Rv=v(N());function kv(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Je(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?kv(Object(t),!0).forEach(function(n){(0,Rv.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function zv(){return{points:{},lines:{},polygons:{},polygonsOutline:{}}}function ni(e){return e.geometry.coordinates}function Fv(e,r){var t=zv(),n=e.pointFeatures,i=e.lineFeatures,o=e.polygonFeatures,a=e.polygonOutlineFeatures;return t.points.data=n,t.points._dataDiff=r.pointFeatures&&function(){return r.pointFeatures},t.points.getPosition=ni,t.lines.data=i,t.lines._dataDiff=r.lineFeatures&&function(){return r.lineFeatures},t.lines.getPath=ni,t.polygons.data=o,t.polygons._dataDiff=r.polygonFeatures&&function(){return r.polygonFeatures},t.polygons.getPolygon=ni,t.polygonsOutline.data=a,t.polygonsOutline._dataDiff=r.polygonOutlineFeatures&&function(){return r.polygonOutlineFeatures},t.polygonsOutline.getPath=ni,t}function Dv(e,r){var t=zv(),n=e.points,i=e.lines,o=e.polygons,a=Ep(e,r);return t.points.data={length:n.positions.value.length/n.positions.size,attributes:Je(Je({},n.attributes),{},{getPosition:n.positions,instancePickingColors:{size:3,value:a.points}}),properties:n.properties,numericProps:n.numericProps,featureIds:n.featureIds},t.lines.data={length:i.pathIndices.value.length-1,startIndices:i.pathIndices.value,attributes:Je(Je({},i.attributes),{},{getPath:i.positions,instancePickingColors:{size:3,value:a.lines}}),properties:i.properties,numericProps:i.numericProps,featureIds:i.featureIds},t.lines._pathType="open",t.polygons.data={length:o.polygonIndices.value.length-1,startIndices:o.polygonIndices.value,attributes:Je(Je({},o.attributes),{},{getPolygon:o.positions,pickingColors:{size:3,value:a.polygons}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygons._normalize=!1,o.triangles&&(t.polygons.data.attributes.indices=o.triangles.value),t.polygonsOutline.data={length:o.primitivePolygonIndices.value.length-1,startIndices:o.primitivePolygonIndices.value,attributes:Je(Je({},o.attributes),{},{getPath:o.positions,instancePickingColors:{size:3,value:a.polygons}}),properties:o.properties,numericProps:o.numericProps,featureIds:o.featureIds},t.polygonsOutline._pathType="open",t}var fy=["instancePickingColors"];function xa(e,r){var t=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=cy(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(u){throw u},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var o=!0,a=!1,s;return{s:function(){t=t.call(e)},n:function(){var u=t.next();return o=u.done,u},e:function(u){a=!0,s=u},f:function(){try{!o&&t.return!=null&&t.return()}finally{if(a)throw s}}}}function cy(e,r){if(e){if(typeof e=="string")return jv(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return jv(e,r)}}function jv(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function py(e){var r=vy();return function(){var n=(0,Tr.default)(e),i;if(r){var o=(0,Tr.default)(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return(0,Vv.default)(this,i)}}function vy(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Nv(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function Ae(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?Nv(Object(t),!0).forEach(function(n){(0,ii.default)(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Nv(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}var dy=["points","linestrings","polygons"],gy=Ae(Ae(Ae(Ae(Ae(Ae({},Et(Lr.circle)),Et(Lr.icon)),Et(Lr.text)),Et(Ar)),Et(ti)),{},{stroked:!0,filled:!0,extruded:!1,wireframe:!1,_full3d:!1,iconAtlas:{type:"object",value:null},iconMapping:{type:"object",value:{}},getIcon:{type:"accessor",value:function(r){return r.properties.icon}},getText:{type:"accessor",value:function(r){return r.properties.text}},pointType:"circle",getRadius:{deprecatedFor:"getPointRadius"}}),oi=function(e){(0,Gv.default)(t,e);var r=py(t);function t(){return(0,Bv.default)(this,t),r.apply(this,arguments)}return(0,Uv.default)(t,[{key:"initializeState",value:function(){this.state={layerProps:{},features:{}}}},{key:"updateState",value:function(i){var o=i.props,a=i.changeFlags;if(a.dataChanged){var s=this.props.data,l=s&&"points"in s&&"polygons"in s&&"lines"in s;this.setState({binary:l}),l?this._updateStateBinary({props:o,changeFlags:a}):this._updateStateJSON({props:o,changeFlags:a})}}},{key:"_updateStateBinary",value:function(i){var o=i.props,a=i.changeFlags,s=Dv(o.data,this.encodePickingColor);this.setState({layerProps:s})}},{key:"_updateStateJSON",value:function(i){var o=i.props,a=i.changeFlags,s=Ev(o.data),l=this.getSubLayerRow.bind(this),u={},f={};if(Array.isArray(a.dataChanged)){var c=this.state.features;for(var p in c)u[p]=c[p].slice(),f[p]=[];var d=xa(a.dataChanged),g;try{for(d.s();!(g=d.n()).done;){var m=g.value,y=ya(s,l,m);for(var x in c)f[x].push(Zn({data:u[x],getIndex:function(P){return P.__source.index},dataRange:m,replace:y[x]}))}}catch(h){d.e(h)}finally{d.f()}}else u=ya(s,l);var _=Fv(u,f);this.setState({features:u,featuresDiff:f,layerProps:_})}},{key:"getPickingInfo",value:function(i){var o=this,a=(0,Pa.default)((0,Tr.default)(t.prototype),"getPickingInfo",this).call(this,i),s=a.index,l=a.sourceLayer;return a.featureType=dy.find(function(u){return l.id.startsWith("".concat(o.id,"-").concat(u,"-"))}),s>=0&&l.id.startsWith("".concat(this.id,"-points-text"))&&this.state.binary&&(a.index=this.props.data.points.globalFeatureIds.value[s]),a}},{key:"_updateAutoHighlight",value:function(i){var o="".concat(this.id,"-points-"),a=i.featureType==="points",s=xa(this.getSubLayers()),l;try{for(s.s();!(l=s.n()).done;){var u=l.value;u.id.startsWith(o)===a&&u.updateAutoHighlight(i)}}catch(f){s.e(f)}finally{s.f()}}},{key:"_renderPolygonLayer",value:function(){var i=this.props,o=i.extruded,a=i.wireframe,s=this.state.layerProps,l="polygons-fill",u=this.shouldRenderSubLayer(l,s.polygons.data)&&this.getSubLayerClass(l,ti.type);if(u){var f=ri(this,ti.props),c=o&&a;return c||delete f.getLineColor,f.updateTriggers.lineColors=c,new u(f,this.getSubLayerProps({id:l,updateTriggers:f.updateTriggers}),s.polygons)}return null}},{key:"_renderLineLayers",value:function(){var i=this.props,o=i.extruded,a=i.stroked,s=this.state.layerProps,l="polygons-stroke",u="linestrings",f=!o&&a&&this.shouldRenderSubLayer(l,s.polygonsOutline.data)&&this.getSubLayerClass(l,Ar.type),c=this.shouldRenderSubLayer(u,s.lines.data)&&this.getSubLayerClass(u,Ar.type);if(f||c){var p=ri(this,Ar.props);return[f&&new f(p,this.getSubLayerProps({id:l,updateTriggers:p.updateTriggers}),s.polygonsOutline),c&&new c(p,this.getSubLayerProps({id:u,updateTriggers:p.updateTriggers}),s.lines)]}return null}},{key:"_renderPointLayers",value:function(){var i=this.props.pointType,o=this.state,a=o.layerProps,s=o.binary,l=this.props.highlightedObjectIndex;!s&&Number.isFinite(l)&&(l=a.points.data.findIndex(function(O){return O.__source.index===l}));var u=new Set(i.split("+")),f=[],c=xa(u),p;try{for(c.s();!(p=c.n()).done;){var d=p.value,g="points-".concat(d),m=Lr[d],y=m&&this.shouldRenderSubLayer(g,a.points.data)&&this.getSubLayerClass(g,m.type);if(y){var x=ri(this,m.props),_=a.points;if(d==="text"&&s){var h=_.data.attributes,P=h.instancePickingColors,b=(0,Wv.default)(h,fy);_=Ae(Ae({},_),{},{data:Ae(Ae({},_.data),{},{attributes:b})})}f.push(new y(x,this.getSubLayerProps({id:g,updateTriggers:x.updateTriggers,highlightedObjectIndex:l}),_))}}}catch(O){c.e(O)}finally{c.f()}return f}},{key:"renderLayers",value:function(){var i=this.props.extruded,o=this._renderPolygonLayer(),a=this._renderLineLayers(),s=this._renderPointLayers();return[!i&&o,a,s,i&&o]}},{key:"getSubLayerAccessor",value:function(i){var o=this.state.binary;return!o||typeof i!="function"?(0,Pa.default)((0,Tr.default)(t.prototype),"getSubLayerAccessor",this).call(this,i):function(a,s){var l=s.data,u=s.index,f=Ip(l,u);return i(f,s)}}}]),t}(Hv.CompositeLayer);(0,ii.default)(oi,"layerName","GeoJsonLayer");(0,ii.default)(oi,"defaultProps",gy);return Xv(Ir);})();
