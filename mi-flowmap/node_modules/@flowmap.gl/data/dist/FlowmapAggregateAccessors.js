/*
 * Copyright (c) Flowmap.gl contributors
 * Copyright (c) 2018-2020 Teralytics
 * SPDX-License-Identifier: Apache-2.0
 */
import { isAggregateFlow, isCluster, isLocationClusterNode, } from './types';
export default class FlowmapAggregateAccessors {
    constructor(accessors) {
        this.getLocationId = (location) => isLocationClusterNode(location)
            ? location.id
            : this.accessors.getLocationId(location);
        this.getLocationName = (location) => {
            let name;
            if (isLocationClusterNode(location) && isCluster(location)) {
                name = location.name;
            }
            else if (this.accessors.getLocationName) {
                name = this.accessors.getLocationName(location);
            }
            if (!name)
                name = `${this.getLocationId(location)}`;
            return name;
        };
        this.getLocationLat = (location) => isLocationClusterNode(location)
            ? location.lat
            : this.accessors.getLocationLat(location);
        this.getLocationLon = (location) => isLocationClusterNode(location)
            ? location.lon
            : this.accessors.getLocationLon(location);
        this.getFlowOriginId = (f) => {
            return isAggregateFlow(f) ? f.origin : this.accessors.getFlowOriginId(f);
        };
        this.getFlowDestId = (f) => {
            return isAggregateFlow(f) ? f.dest : this.accessors.getFlowDestId(f);
        };
        this.getFlowMagnitude = (f) => {
            return isAggregateFlow(f) ? f.count : this.accessors.getFlowMagnitude(f);
        };
        // Note: Aggregate flows have no time
        this.getFlowTime = (f) => {
            const { getFlowTime } = this.accessors;
            return getFlowTime ? getFlowTime(f) : undefined;
        };
        this.accessors = accessors;
    }
    setAccessors(accessors) {
        this.accessors = accessors;
    }
    getFlowmapDataAccessors() {
        return this.accessors;
    }
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiRmxvd21hcEFnZ3JlZ2F0ZUFjY2Vzc29ycy5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy9GbG93bWFwQWdncmVnYXRlQWNjZXNzb3JzLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBSUwsZUFBZSxFQUNmLFNBQVMsRUFDVCxxQkFBcUIsR0FDdEIsTUFBTSxTQUFTLENBQUM7QUFFakIsTUFBTSxDQUFDLE9BQU8sT0FBTyx5QkFBeUI7SUFLNUMsWUFBWSxTQUFxQztRQVlqRCxrQkFBYSxHQUFHLENBQUMsUUFBeUIsRUFBbUIsRUFBRSxDQUM3RCxxQkFBcUIsQ0FBQyxRQUFRLENBQUM7WUFDN0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxFQUFFO1lBQ2IsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsYUFBYSxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTdDLG9CQUFlLEdBQUcsQ0FBQyxRQUF5QixFQUFVLEVBQUU7WUFDdEQsSUFBSSxJQUFJLENBQUM7WUFDVCxJQUFJLHFCQUFxQixDQUFDLFFBQVEsQ0FBQyxJQUFJLFNBQVMsQ0FBQyxRQUFRLENBQUMsRUFBRTtnQkFDMUQsSUFBSSxHQUFHLFFBQVEsQ0FBQyxJQUFJLENBQUM7YUFDdEI7aUJBQU0sSUFBSSxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsRUFBRTtnQkFDekMsSUFBSSxHQUFHLElBQUksQ0FBQyxTQUFTLENBQUMsZUFBZSxDQUFDLFFBQWEsQ0FBQyxDQUFDO2FBQ3REO1lBQ0QsSUFBSSxDQUFDLElBQUk7Z0JBQUUsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxRQUFRLENBQUMsRUFBRSxDQUFDO1lBQ3BELE9BQU8sSUFBSSxDQUFDO1FBQ2QsQ0FBQyxDQUFDO1FBRUYsbUJBQWMsR0FBRyxDQUFDLFFBQXlCLEVBQVUsRUFBRSxDQUNyRCxxQkFBcUIsQ0FBQyxRQUFRLENBQUM7WUFDN0IsQ0FBQyxDQUFDLFFBQVEsQ0FBQyxHQUFHO1lBQ2QsQ0FBQyxDQUFDLElBQUksQ0FBQyxTQUFTLENBQUMsY0FBYyxDQUFDLFFBQVEsQ0FBQyxDQUFDO1FBRTlDLG1CQUFjLEdBQUcsQ0FBQyxRQUF5QixFQUFVLEVBQUUsQ0FDckQscUJBQXFCLENBQUMsUUFBUSxDQUFDO1lBQzdCLENBQUMsQ0FBQyxRQUFRLENBQUMsR0FBRztZQUNkLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGNBQWMsQ0FBQyxRQUFRLENBQUMsQ0FBQztRQUU5QyxvQkFBZSxHQUFHLENBQUMsQ0FBb0IsRUFBRSxFQUFFO1lBQ3pDLE9BQU8sZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUM7UUFFRixrQkFBYSxHQUFHLENBQUMsQ0FBb0IsRUFBRSxFQUFFO1lBQ3ZDLE9BQU8sZUFBZSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUN2RSxDQUFDLENBQUM7UUFFRixxQkFBZ0IsR0FBRyxDQUFDLENBQW9CLEVBQUUsRUFBRTtZQUMxQyxPQUFPLGVBQWUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDLENBQUMsQ0FBQztRQUMzRSxDQUFDLENBQUM7UUFFRixxQ0FBcUM7UUFDckMsZ0JBQVcsR0FBRyxDQUFDLENBQUksRUFBRSxFQUFFO1lBQ3JCLE1BQU0sRUFBQyxXQUFXLEVBQUMsR0FBRyxJQUFJLENBQUMsU0FBUyxDQUFDO1lBQ3JDLE9BQU8sV0FBVyxDQUFDLENBQUMsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQztRQUNsRCxDQUFDLENBQUM7UUFyREEsSUFBSSxDQUFDLFNBQVMsR0FBRyxTQUFTLENBQUM7SUFDN0IsQ0FBQztJQUVELFlBQVksQ0FBQyxTQUFxQztRQUNoRCxJQUFJLENBQUMsU0FBUyxHQUFHLFNBQVMsQ0FBQztJQUM3QixDQUFDO0lBRUQsdUJBQXVCO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQztJQUN4QixDQUFDO0NBNkNGIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgRmxvd21hcC5nbCBjb250cmlidXRvcnNcbiAqIENvcHlyaWdodCAoYykgMjAxOC0yMDIwIFRlcmFseXRpY3NcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHtcbiAgQWdncmVnYXRlRmxvdyxcbiAgQ2x1c3Rlck5vZGUsXG4gIEZsb3dtYXBEYXRhQWNjZXNzb3JzLFxuICBpc0FnZ3JlZ2F0ZUZsb3csXG4gIGlzQ2x1c3RlcixcbiAgaXNMb2NhdGlvbkNsdXN0ZXJOb2RlLFxufSBmcm9tICcuL3R5cGVzJztcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgRmxvd21hcEFnZ3JlZ2F0ZUFjY2Vzc29yczxcbiAgTCBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIEYgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuPiB7XG4gIHByaXZhdGUgYWNjZXNzb3JzOiBGbG93bWFwRGF0YUFjY2Vzc29yczxMLCBGPjtcbiAgY29uc3RydWN0b3IoYWNjZXNzb3JzOiBGbG93bWFwRGF0YUFjY2Vzc29yczxMLCBGPikge1xuICAgIHRoaXMuYWNjZXNzb3JzID0gYWNjZXNzb3JzO1xuICB9XG5cbiAgc2V0QWNjZXNzb3JzKGFjY2Vzc29yczogRmxvd21hcERhdGFBY2Nlc3NvcnM8TCwgRj4pIHtcbiAgICB0aGlzLmFjY2Vzc29ycyA9IGFjY2Vzc29ycztcbiAgfVxuXG4gIGdldEZsb3dtYXBEYXRhQWNjZXNzb3JzKCkge1xuICAgIHJldHVybiB0aGlzLmFjY2Vzc29ycztcbiAgfVxuXG4gIGdldExvY2F0aW9uSWQgPSAobG9jYXRpb246IEwgfCBDbHVzdGVyTm9kZSk6IHN0cmluZyB8IG51bWJlciA9PlxuICAgIGlzTG9jYXRpb25DbHVzdGVyTm9kZShsb2NhdGlvbilcbiAgICAgID8gbG9jYXRpb24uaWRcbiAgICAgIDogdGhpcy5hY2Nlc3NvcnMuZ2V0TG9jYXRpb25JZChsb2NhdGlvbik7XG5cbiAgZ2V0TG9jYXRpb25OYW1lID0gKGxvY2F0aW9uOiBMIHwgQ2x1c3Rlck5vZGUpOiBzdHJpbmcgPT4ge1xuICAgIGxldCBuYW1lO1xuICAgIGlmIChpc0xvY2F0aW9uQ2x1c3Rlck5vZGUobG9jYXRpb24pICYmIGlzQ2x1c3Rlcihsb2NhdGlvbikpIHtcbiAgICAgIG5hbWUgPSBsb2NhdGlvbi5uYW1lO1xuICAgIH0gZWxzZSBpZiAodGhpcy5hY2Nlc3NvcnMuZ2V0TG9jYXRpb25OYW1lKSB7XG4gICAgICBuYW1lID0gdGhpcy5hY2Nlc3NvcnMuZ2V0TG9jYXRpb25OYW1lKGxvY2F0aW9uIGFzIEwpO1xuICAgIH1cbiAgICBpZiAoIW5hbWUpIG5hbWUgPSBgJHt0aGlzLmdldExvY2F0aW9uSWQobG9jYXRpb24pfWA7XG4gICAgcmV0dXJuIG5hbWU7XG4gIH07XG5cbiAgZ2V0TG9jYXRpb25MYXQgPSAobG9jYXRpb246IEwgfCBDbHVzdGVyTm9kZSk6IG51bWJlciA9PlxuICAgIGlzTG9jYXRpb25DbHVzdGVyTm9kZShsb2NhdGlvbilcbiAgICAgID8gbG9jYXRpb24ubGF0XG4gICAgICA6IHRoaXMuYWNjZXNzb3JzLmdldExvY2F0aW9uTGF0KGxvY2F0aW9uKTtcblxuICBnZXRMb2NhdGlvbkxvbiA9IChsb2NhdGlvbjogTCB8IENsdXN0ZXJOb2RlKTogbnVtYmVyID0+XG4gICAgaXNMb2NhdGlvbkNsdXN0ZXJOb2RlKGxvY2F0aW9uKVxuICAgICAgPyBsb2NhdGlvbi5sb25cbiAgICAgIDogdGhpcy5hY2Nlc3NvcnMuZ2V0TG9jYXRpb25Mb24obG9jYXRpb24pO1xuXG4gIGdldEZsb3dPcmlnaW5JZCA9IChmOiBGIHwgQWdncmVnYXRlRmxvdykgPT4ge1xuICAgIHJldHVybiBpc0FnZ3JlZ2F0ZUZsb3coZikgPyBmLm9yaWdpbiA6IHRoaXMuYWNjZXNzb3JzLmdldEZsb3dPcmlnaW5JZChmKTtcbiAgfTtcblxuICBnZXRGbG93RGVzdElkID0gKGY6IEYgfCBBZ2dyZWdhdGVGbG93KSA9PiB7XG4gICAgcmV0dXJuIGlzQWdncmVnYXRlRmxvdyhmKSA/IGYuZGVzdCA6IHRoaXMuYWNjZXNzb3JzLmdldEZsb3dEZXN0SWQoZik7XG4gIH07XG5cbiAgZ2V0Rmxvd01hZ25pdHVkZSA9IChmOiBGIHwgQWdncmVnYXRlRmxvdykgPT4ge1xuICAgIHJldHVybiBpc0FnZ3JlZ2F0ZUZsb3coZikgPyBmLmNvdW50IDogdGhpcy5hY2Nlc3NvcnMuZ2V0Rmxvd01hZ25pdHVkZShmKTtcbiAgfTtcblxuICAvLyBOb3RlOiBBZ2dyZWdhdGUgZmxvd3MgaGF2ZSBubyB0aW1lXG4gIGdldEZsb3dUaW1lID0gKGY6IEYpID0+IHtcbiAgICBjb25zdCB7Z2V0Rmxvd1RpbWV9ID0gdGhpcy5hY2Nlc3NvcnM7XG4gICAgcmV0dXJuIGdldEZsb3dUaW1lID8gZ2V0Rmxvd1RpbWUoZikgOiB1bmRlZmluZWQ7XG4gIH07XG59XG4iXX0=