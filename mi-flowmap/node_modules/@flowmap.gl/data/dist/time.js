/*
 * Copyright (c) Flowmap.gl contributors
 * Copyright (c) 2018-2020 Teralytics
 * SPDX-License-Identifier: Apache-2.0
 */
import { timeFormat, timeParse } from 'd3-time-format';
import { timeDay, timeHour, timeMinute, timeMonth, timeSecond, timeWeek, timeYear, } from 'd3-time';
const dateParsers = [
    timeParse('%Y-%m-%d'),
    timeParse('%Y-%m-%d %H:%M'),
    timeParse('%Y-%m-%d %H:%M:%S'),
    timeParse('%Y'),
    timeParse('%Y-%m'),
];
export function parseTime(input) {
    if (input != null) {
        if (input instanceof Date) {
            return input;
        }
        for (const parse of dateParsers) {
            const date = parse(input);
            if (date) {
                return date;
            }
        }
    }
    return undefined;
}
export var TimeGranularityKey;
(function (TimeGranularityKey) {
    TimeGranularityKey["SECOND"] = "SECOND";
    TimeGranularityKey["MINUTE"] = "MINUTE";
    TimeGranularityKey["HOUR"] = "HOUR";
    TimeGranularityKey["DAY"] = "DAY";
    TimeGranularityKey["MONTH"] = "MONTH";
    TimeGranularityKey["YEAR"] = "YEAR";
})(TimeGranularityKey || (TimeGranularityKey = {}));
// const preferredLocale = navigator.languages ? navigator.languages[0] : 'en';
const formatMillisecond = timeFormat('.%L'), formatSecond = timeFormat(':%S'), formatMinute = timeFormat('%I:%M'), 
// formatHour = (d: Date) => d.toLocaleString(preferredLocale, { hour: 'numeric' }),
formatHour = timeFormat('%I %p'), formatDay = timeFormat('%a %d'), formatWeek = timeFormat('%b %d'), formatMonth = timeFormat('%b'), formatYear = timeFormat('%Y');
export function tickMultiFormat(date) {
    return (timeSecond(date) < date
        ? formatMillisecond
        : timeMinute(date) < date
            ? formatSecond
            : timeHour(date) < date
                ? formatMinute
                : timeDay(date) < date
                    ? formatHour
                    : timeMonth(date) < date
                        ? timeWeek(date) < date
                            ? formatDay
                            : formatWeek
                        : timeYear(date) < date
                            ? formatMonth
                            : formatYear)(date);
}
export const TIME_GRANULARITIES = [
    {
        order: 0,
        key: TimeGranularityKey.SECOND,
        interval: timeSecond,
        format: formatSecond,
        formatFull: timeFormat('%Y-%m-%d %H:%M:%S'),
    },
    {
        order: 1,
        key: TimeGranularityKey.MINUTE,
        interval: timeMinute,
        format: formatMinute,
        formatFull: timeFormat('%Y-%m-%d %H:%M'),
    },
    {
        order: 2,
        key: TimeGranularityKey.HOUR,
        interval: timeHour,
        // format: (d: Date) => d.toLocaleString(preferredLocale, { hour: 'numeric', minute: '2-digit' }),
        format: formatHour,
        formatFull: timeFormat('%a %d %b %Y, %I %p'),
    },
    {
        order: 3,
        key: TimeGranularityKey.DAY,
        interval: timeDay,
        format: formatDay,
        formatFull: timeFormat('%a %d %b %Y'),
    },
    {
        order: 4,
        key: TimeGranularityKey.MONTH,
        interval: timeMonth,
        format: formatMonth,
        formatFull: timeFormat('%b %Y'),
    },
    {
        order: 5,
        key: TimeGranularityKey.YEAR,
        interval: timeYear,
        format: formatYear,
        formatFull: timeFormat('%Y'),
    },
];
export function getTimeGranularityByKey(key) {
    return TIME_GRANULARITIES.find((s) => s.key === key);
}
export function getTimeGranularityByOrder(order) {
    return TIME_GRANULARITIES.find((s) => s.order === order);
}
export function getTimeGranularityForDate(date) {
    let prev = undefined;
    for (const current of TIME_GRANULARITIES) {
        const { interval } = current;
        const floored = interval(date);
        if (floored < date) {
            if (!prev)
                return current;
            return prev;
        }
        prev = current;
    }
    return TIME_GRANULARITIES[TIME_GRANULARITIES.length - 1];
}
export function areRangesEqual(a, b) {
    if (!a && !b)
        return true;
    if (!a || !b)
        return false;
    return a[0] === b[0] && a[1] === b[1];
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidGltZS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uL3NyYy90aW1lLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7O0dBSUc7QUFFSCxPQUFPLEVBQUMsVUFBVSxFQUFFLFNBQVMsRUFBQyxNQUFNLGdCQUFnQixDQUFDO0FBQ3JELE9BQU8sRUFDTCxPQUFPLEVBQ1AsUUFBUSxFQUVSLFVBQVUsRUFDVixTQUFTLEVBQ1QsVUFBVSxFQUNWLFFBQVEsRUFDUixRQUFRLEdBQ1QsTUFBTSxTQUFTLENBQUM7QUFFakIsTUFBTSxXQUFXLEdBQUc7SUFDbEIsU0FBUyxDQUFDLFVBQVUsQ0FBQztJQUNyQixTQUFTLENBQUMsZ0JBQWdCLENBQUM7SUFDM0IsU0FBUyxDQUFDLG1CQUFtQixDQUFDO0lBQzlCLFNBQVMsQ0FBQyxJQUFJLENBQUM7SUFDZixTQUFTLENBQUMsT0FBTyxDQUFDO0NBQ25CLENBQUM7QUFFRixNQUFNLFVBQVUsU0FBUyxDQUFDLEtBQWdDO0lBQ3hELElBQUksS0FBSyxJQUFJLElBQUksRUFBRTtRQUNqQixJQUFJLEtBQUssWUFBWSxJQUFJLEVBQUU7WUFDekIsT0FBTyxLQUFLLENBQUM7U0FDZDtRQUNELEtBQUssTUFBTSxLQUFLLElBQUksV0FBVyxFQUFFO1lBQy9CLE1BQU0sSUFBSSxHQUFHLEtBQUssQ0FBQyxLQUFLLENBQUMsQ0FBQztZQUMxQixJQUFJLElBQUksRUFBRTtnQkFDUixPQUFPLElBQUksQ0FBQzthQUNiO1NBQ0Y7S0FDRjtJQUNELE9BQU8sU0FBUyxDQUFDO0FBQ25CLENBQUM7QUFFRCxNQUFNLENBQU4sSUFBWSxrQkFPWDtBQVBELFdBQVksa0JBQWtCO0lBQzVCLHVDQUFpQixDQUFBO0lBQ2pCLHVDQUFpQixDQUFBO0lBQ2pCLG1DQUFhLENBQUE7SUFDYixpQ0FBVyxDQUFBO0lBQ1gscUNBQWUsQ0FBQTtJQUNmLG1DQUFhLENBQUE7QUFDZixDQUFDLEVBUFcsa0JBQWtCLEtBQWxCLGtCQUFrQixRQU83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LENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztBQUN4QyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIENvcHlyaWdodCAoYykgRmxvd21hcC5nbCBjb250cmlidXRvcnNcbiAqIENvcHlyaWdodCAoYykgMjAxOC0yMDIwIFRlcmFseXRpY3NcbiAqIFNQRFgtTGljZW5zZS1JZGVudGlmaWVyOiBBcGFjaGUtMi4wXG4gKi9cblxuaW1wb3J0IHt0aW1lRm9ybWF0LCB0aW1lUGFyc2V9IGZyb20gJ2QzLXRpbWUtZm9ybWF0JztcbmltcG9ydCB7XG4gIHRpbWVEYXksXG4gIHRpbWVIb3VyLFxuICBUaW1lSW50ZXJ2YWwsXG4gIHRpbWVNaW51dGUsXG4gIHRpbWVNb250aCxcbiAgdGltZVNlY29uZCxcbiAgdGltZVdlZWssXG4gIHRpbWVZZWFyLFxufSBmcm9tICdkMy10aW1lJztcblxuY29uc3QgZGF0ZVBhcnNlcnMgPSBbXG4gIHRpbWVQYXJzZSgnJVktJW0tJWQnKSxcbiAgdGltZVBhcnNlKCclWS0lbS0lZCAlSDolTScpLFxuICB0aW1lUGFyc2UoJyVZLSVtLSVkICVIOiVNOiVTJyksXG4gIHRpbWVQYXJzZSgnJVknKSxcbiAgdGltZVBhcnNlKCclWS0lbScpLFxuXTtcblxuZXhwb3J0IGZ1bmN0aW9uIHBhcnNlVGltZShpbnB1dDogc3RyaW5nIHwgRGF0ZSB8IHVuZGVmaW5lZCk6IERhdGUgfCB1bmRlZmluZWQge1xuICBpZiAoaW5wdXQgIT0gbnVsbCkge1xuICAgIGlmIChpbnB1dCBpbnN0YW5jZW9mIERhdGUpIHtcbiAgICAgIHJldHVybiBpbnB1dDtcbiAgICB9XG4gICAgZm9yIChjb25zdCBwYXJzZSBvZiBkYXRlUGFyc2Vycykge1xuICAgICAgY29uc3QgZGF0ZSA9IHBhcnNlKGlucHV0KTtcbiAgICAgIGlmIChkYXRlKSB7XG4gICAgICAgIHJldHVybiBkYXRlO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICByZXR1cm4gdW5kZWZpbmVkO1xufVxuXG5leHBvcnQgZW51bSBUaW1lR3JhbnVsYXJpdHlLZXkge1xuICBTRUNPTkQgPSAnU0VDT05EJyxcbiAgTUlOVVRFID0gJ01JTlVURScsXG4gIEhPVVIgPSAnSE9VUicsXG4gIERBWSA9ICdEQVknLFxuICBNT05USCA9ICdNT05USCcsXG4gIFlFQVIgPSAnWUVBUicsXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGltZUdyYW51bGFyaXR5IHtcbiAga2V5OiBUaW1lR3JhbnVsYXJpdHlLZXk7XG4gIG9yZGVyOiBudW1iZXI7XG4gIGludGVydmFsOiBUaW1lSW50ZXJ2YWw7XG4gIGZvcm1hdDogKGRhdGU6IERhdGUpID0+IHN0cmluZztcbiAgZm9ybWF0RnVsbDogKGRhdGU6IERhdGUpID0+IHN0cmluZztcbn1cblxuLy8gY29uc3QgcHJlZmVycmVkTG9jYWxlID0gbmF2aWdhdG9yLmxhbmd1YWdlcyA/IG5hdmlnYXRvci5sYW5ndWFnZXNbMF0gOiAnZW4nO1xuXG5jb25zdCBmb3JtYXRNaWxsaXNlY29uZCA9IHRpbWVGb3JtYXQoJy4lTCcpLFxuICBmb3JtYXRTZWNvbmQgPSB0aW1lRm9ybWF0KCc6JVMnKSxcbiAgZm9ybWF0TWludXRlID0gdGltZUZvcm1hdCgnJUk6JU0nKSxcbiAgLy8gZm9ybWF0SG91ciA9IChkOiBEYXRlKSA9PiBkLnRvTG9jYWxlU3RyaW5nKHByZWZlcnJlZExvY2FsZSwgeyBob3VyOiAnbnVtZXJpYycgfSksXG4gIGZvcm1hdEhvdXIgPSB0aW1lRm9ybWF0KCclSSAlcCcpLFxuICBmb3JtYXREYXkgPSB0aW1lRm9ybWF0KCclYSAlZCcpLFxuICBmb3JtYXRXZWVrID0gdGltZUZvcm1hdCgnJWIgJWQnKSxcbiAgZm9ybWF0TW9udGggPSB0aW1lRm9ybWF0KCclYicpLFxuICBmb3JtYXRZZWFyID0gdGltZUZvcm1hdCgnJVknKTtcblxuZXhwb3J0IGZ1bmN0aW9uIHRpY2tNdWx0aUZvcm1hdChkYXRlOiBEYXRlKSB7XG4gIHJldHVybiAoXG4gICAgdGltZVNlY29uZChkYXRlKSA8IGRhdGVcbiAgICAgID8gZm9ybWF0TWlsbGlzZWNvbmRcbiAgICAgIDogdGltZU1pbnV0ZShkYXRlKSA8IGRhdGVcbiAgICAgID8gZm9ybWF0U2Vjb25kXG4gICAgICA6IHRpbWVIb3VyKGRhdGUpIDwgZGF0ZVxuICAgICAgPyBmb3JtYXRNaW51dGVcbiAgICAgIDogdGltZURheShkYXRlKSA8IGRhdGVcbiAgICAgID8gZm9ybWF0SG91clxuICAgICAgOiB0aW1lTW9udGgoZGF0ZSkgPCBkYXRlXG4gICAgICA/IHRpbWVXZWVrKGRhdGUpIDwgZGF0ZVxuICAgICAgICA/IGZvcm1hdERheVxuICAgICAgICA6IGZvcm1hdFdlZWtcbiAgICAgIDogdGltZVllYXIoZGF0ZSkgPCBkYXRlXG4gICAgICA/IGZvcm1hdE1vbnRoXG4gICAgICA6IGZvcm1hdFllYXJcbiAgKShkYXRlKTtcbn1cblxuZXhwb3J0IGNvbnN0IFRJTUVfR1JBTlVMQVJJVElFUzogVGltZUdyYW51bGFyaXR5W10gPSBbXG4gIHtcbiAgICBvcmRlcjogMCxcbiAgICBrZXk6IFRpbWVHcmFudWxhcml0eUtleS5TRUNPTkQsXG4gICAgaW50ZXJ2YWw6IHRpbWVTZWNvbmQsXG4gICAgZm9ybWF0OiBmb3JtYXRTZWNvbmQsXG4gICAgZm9ybWF0RnVsbDogdGltZUZvcm1hdCgnJVktJW0tJWQgJUg6JU06JVMnKSxcbiAgfSxcbiAge1xuICAgIG9yZGVyOiAxLFxuICAgIGtleTogVGltZUdyYW51bGFyaXR5S2V5Lk1JTlVURSxcbiAgICBpbnRlcnZhbDogdGltZU1pbnV0ZSxcbiAgICBmb3JtYXQ6IGZvcm1hdE1pbnV0ZSxcbiAgICBmb3JtYXRGdWxsOiB0aW1lRm9ybWF0KCclWS0lbS0lZCAlSDolTScpLFxuICB9LFxuICB7XG4gICAgb3JkZXI6IDIsXG4gICAga2V5OiBUaW1lR3JhbnVsYXJpdHlLZXkuSE9VUixcbiAgICBpbnRlcnZhbDogdGltZUhvdXIsXG4gICAgLy8gZm9ybWF0OiAoZDogRGF0ZSkgPT4gZC50b0xvY2FsZVN0cmluZyhwcmVmZXJyZWRMb2NhbGUsIHsgaG91cjogJ251bWVyaWMnLCBtaW51dGU6ICcyLWRpZ2l0JyB9KSxcbiAgICBmb3JtYXQ6IGZvcm1hdEhvdXIsXG4gICAgZm9ybWF0RnVsbDogdGltZUZvcm1hdCgnJWEgJWQgJWIgJVksICVJICVwJyksXG4gIH0sXG4gIHtcbiAgICBvcmRlcjogMyxcbiAgICBrZXk6IFRpbWVHcmFudWxhcml0eUtleS5EQVksXG4gICAgaW50ZXJ2YWw6IHRpbWVEYXksXG4gICAgZm9ybWF0OiBmb3JtYXREYXksXG4gICAgZm9ybWF0RnVsbDogdGltZUZvcm1hdCgnJWEgJWQgJWIgJVknKSxcbiAgfSxcbiAge1xuICAgIG9yZGVyOiA0LFxuICAgIGtleTogVGltZUdyYW51bGFyaXR5S2V5Lk1PTlRILFxuICAgIGludGVydmFsOiB0aW1lTW9udGgsXG4gICAgZm9ybWF0OiBmb3JtYXRNb250aCxcbiAgICBmb3JtYXRGdWxsOiB0aW1lRm9ybWF0KCclYiAlWScpLFxuICB9LFxuICB7XG4gICAgb3JkZXI6IDUsXG4gICAga2V5OiBUaW1lR3JhbnVsYXJpdHlLZXkuWUVBUixcbiAgICBpbnRlcnZhbDogdGltZVllYXIsXG4gICAgZm9ybWF0OiBmb3JtYXRZZWFyLFxuICAgIGZvcm1hdEZ1bGw6IHRpbWVGb3JtYXQoJyVZJyksXG4gIH0sXG5dO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGltZUdyYW51bGFyaXR5QnlLZXkoa2V5OiBUaW1lR3JhbnVsYXJpdHlLZXkpIHtcbiAgcmV0dXJuIFRJTUVfR1JBTlVMQVJJVElFUy5maW5kKChzKSA9PiBzLmtleSA9PT0ga2V5KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWVHcmFudWxhcml0eUJ5T3JkZXIob3JkZXI6IG51bWJlcikge1xuICByZXR1cm4gVElNRV9HUkFOVUxBUklUSUVTLmZpbmQoKHMpID0+IHMub3JkZXIgPT09IG9yZGVyKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGdldFRpbWVHcmFudWxhcml0eUZvckRhdGUoZGF0ZTogRGF0ZSk6IFRpbWVHcmFudWxhcml0eSB7XG4gIGxldCBwcmV2ID0gdW5kZWZpbmVkO1xuICBmb3IgKGNvbnN0IGN1cnJlbnQgb2YgVElNRV9HUkFOVUxBUklUSUVTKSB7XG4gICAgY29uc3Qge2ludGVydmFsfSA9IGN1cnJlbnQ7XG4gICAgY29uc3QgZmxvb3JlZCA9IGludGVydmFsKGRhdGUpO1xuICAgIGlmIChmbG9vcmVkIDwgZGF0ZSkge1xuICAgICAgaWYgKCFwcmV2KSByZXR1cm4gY3VycmVudDtcbiAgICAgIHJldHVybiBwcmV2O1xuICAgIH1cbiAgICBwcmV2ID0gY3VycmVudDtcbiAgfVxuICByZXR1cm4gVElNRV9HUkFOVUxBUklUSUVTW1RJTUVfR1JBTlVMQVJJVElFUy5sZW5ndGggLSAxXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGFyZVJhbmdlc0VxdWFsKFxuICBhOiBbRGF0ZSwgRGF0ZV0gfCB1bmRlZmluZWQsXG4gIGI6IFtEYXRlLCBEYXRlXSB8IHVuZGVmaW5lZCxcbik6IGJvb2xlYW4ge1xuICBpZiAoIWEgJiYgIWIpIHJldHVybiB0cnVlO1xuICBpZiAoIWEgfHwgIWIpIHJldHVybiBmYWxzZTtcbiAgcmV0dXJuIGFbMF0gPT09IGJbMF0gJiYgYVsxXSA9PT0gYlsxXTtcbn1cbiJdfQ==